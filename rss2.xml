<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>WONDEROMG</title>
    <link>https://wonderomg.github.io/</link>
    
    <atom:link href="https://wonderomg.github.io/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>wonderomg&#39;s blog</description>
    <pubDate>Thu, 13 Jan 2022 16:04:09 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>mongodbå­¦ä¹ ç¬”è®°--å®ç°è‡ªå¢IDåºåˆ—</title>
      <link>https://wonderomg.github.io/2020/09/25/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%A2%9EID%E5%BA%8F%E5%88%97/</link>
      <guid>https://wonderomg.github.io/2020/09/25/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%A2%9EID%E5%BA%8F%E5%88%97/</guid>
      <pubDate>Fri, 25 Sep 2020 12:46:25 GMT</pubDate>
      
      <description>&lt;p&gt;ã€€ã€€åœ¨æŸäº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åˆ©ç”¨æ•°æ®çš„è‡ªå¢idç‰¹æ€§æ¥ä½œä¸ºæ•°æ®é›†çš„è‡ªå¢æ’åºæŸ¥æ‰¾ç­‰æ“ä½œã€‚æˆ–è€…ç›¸åŒçš„æ•°æ®åˆ†å¸ƒåœ¨å¤šä»½å­˜å‚¨ä¸Šã€‚&lt;/p&gt;
&lt;p&gt;å¹¶ä¸”å­˜åœ¨å¯¹æ¡æ•°æ®éœ€è¦é€šè¿‡è¿™ä¸ªidè¿›è¡Œå…³è”ï¼Œç±»ä¼¼äºå¤–é”®ç‰¹æ€§ï¼Œè¿™å°±éœ€è¦å°†idå’Œæ•°æ®åˆ†ç¦»ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ã€€ã€€åœ¨æŸäº›ç‰¹å®šçš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åˆ©ç”¨æ•°æ®çš„è‡ªå¢idç‰¹æ€§æ¥ä½œä¸ºæ•°æ®é›†çš„è‡ªå¢æ’åºæŸ¥æ‰¾ç­‰æ“ä½œã€‚æˆ–è€…ç›¸åŒçš„æ•°æ®åˆ†å¸ƒåœ¨å¤šä»½å­˜å‚¨ä¸Šã€‚</p><p>å¹¶ä¸”å­˜åœ¨å¯¹æ¡æ•°æ®éœ€è¦é€šè¿‡è¿™ä¸ªidè¿›è¡Œå…³è”ï¼Œç±»ä¼¼äºå¤–é”®ç‰¹æ€§ï¼Œè¿™å°±éœ€è¦å°†idå’Œæ•°æ®åˆ†ç¦»ã€‚</p><span id="more"></span><p>æµç¨‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">id--&gt;DB1</span><br><span class="line">id--&gt;DB2</span><br><span class="line">DB1--&gt;åˆå¹¶æ•°æ®</span><br><span class="line">DB2--&gt;åˆå¹¶æ•°æ®</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ—ä¸¾äº†mysqlã€oracleã€mongodbä¸‰ç§æ•°æ®çš„è‡ªå¢åºåˆ—å®ç°æ–¹å¼ã€‚</p><h2 id="1ã€mysqlçš„è‡ªå¢id"><a href="#1ã€mysqlçš„è‡ªå¢id" class="headerlink" title="1ã€mysqlçš„è‡ªå¢id"></a>1ã€mysqlçš„è‡ªå¢id</h2><p>â€‹        mysqlçš„è‡ªå¢idæ˜¯å’Œæ•°æ®ç»‘å®šåœ¨ä¸€èµ·çš„ï¼Œæ— æ³•åˆ†å¼€ï¼Œç­‰äºä½ idçš„å¢åŠ æ˜¯ä¼´éšç€æ•°æ®åº“çš„æ•°æ®æ–°å¢è€Œæ¥ã€‚</p><p>é‚£æœ‰æ²¡æœ‰åŠæ³•åˆ†å¼€å‘¢ï¼Ÿ</p><p>â€‹        ä¹Ÿæ˜¯æœ‰çš„ï¼Œéœ€è¦å€ŸåŠ©æ•°æ®åº“å‡½æ•°æ¥å®ç°ã€‚ä½†æ˜¯ä¸€èˆ¬ä¸å»ºè®®ä½¿ç”¨ï¼Œéœ€è¦å¯¹å‡½æ•°è¿›è¡Œåˆ†æåŠ å‚æ•°ä¿®é¥°ï¼Œå¦‚å‡½æ•°é‡ŒåŠ å…³é”®å­—<code>READS SQL DATA</code>ï¼ˆåªæŸ¥è¯¢æ—¶ä½¿ç”¨ï¼‰ã€<code>DETERMINISTIC</code>ï¼ˆå­˜åœ¨æ›´æ–°æ—¶ä½¿ç”¨ï¼‰ï¼Œä¸ç„¶æ•°æ®åº“ä¼šå‘Šè­¦ï¼Œä¼šä¸€å®šç¨‹åº¦å½±å“dmlæ€§èƒ½ã€‚</p><p>å…¶åŸç†å°±æ˜¯æ¯æŸ¥è¯¢ä¸€æ¬¡æ›´æ–°sequenceçš„å€¼ã€‚</p><p>å…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1ã€æ–°å»ºåºåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> test_sequence;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_sequence (</span><br><span class="line">seq_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- åºåˆ—åç§°</span></span><br><span class="line">current_val <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>, <span class="comment">-- å½“å‰å€¼</span></span><br><span class="line">increment_val <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>, <span class="comment">-- æ­¥é•¿(è·¨åº¦)</span></span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (seq_name));</span><br><span class="line"> </span><br><span class="line"><span class="comment">--2ã€æ–°å¢ä¸€ä¸ªåºåˆ—</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_sequence <span class="keyword">VALUES</span> (<span class="string">&#x27;user_seq&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_sequence <span class="keyword">VALUES</span> (<span class="string">&#x27;class_seq&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_sequence <span class="keyword">VALUES</span> (<span class="string">&#x27;school_seq&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test_sequence <span class="keyword">VALUES</span> (<span class="string">&#x27;data_seq&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">--3ã€åˆ›å»ºcurrvalå‡½æ•°ï¼Œç”¨äºè·å–åºåˆ—å½“å‰å€¼</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> seq_currval(v_seq_name <span class="type">VARCHAR</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">returns</span> <span class="type">bigint</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">value</span> <span class="type">integer</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">select</span> current_val <span class="keyword">into</span> <span class="keyword">value</span> <span class="keyword">from</span> test_sequence <span class="keyword">where</span> seq_name <span class="operator">=</span> v_seq_name;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">value</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">--4ã€æŸ¥è¯¢å½“å‰å€¼</span></span><br><span class="line"><span class="keyword">select</span> seq_currval(<span class="string">&#x27;ge_rns_user_info_seq&#x27;</span>);</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">--5ã€åˆ›å»ºnextvalå‡½æ•°ï¼Œç”¨äºè·å–åºåˆ—ä¸‹ä¸€ä¸ªå€¼</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> seq_nextval (v_seq_name <span class="type">VARCHAR</span>(<span class="number">50</span>)) <span class="keyword">returns</span> <span class="type">bigint</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">update test_sequence <span class="keyword">set</span> current_val <span class="operator">=</span> current_val <span class="operator">+</span> increment_val <span class="keyword">where</span> seq_name <span class="operator">=</span> v_seq_name;</span><br><span class="line"><span class="keyword">return</span> seq_currval(v_seq_name);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">--6ã€æŸ¥è¯¢ä¸‹ä¸€ä¸ªå€¼</span></span><br><span class="line"><span class="keyword">select</span> seq_nextval(<span class="string">&#x27;user_seq&#x27;</span>);</span><br><span class="line"><span class="comment">--7ã€æŸ¥è¯¢æ‰€æœ‰sequence</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test_sequence;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨</p><h2 id="2ã€oracleçš„è‡ªå¢sequence"><a href="#2ã€oracleçš„è‡ªå¢sequence" class="headerlink" title="2ã€oracleçš„è‡ªå¢sequence"></a>2ã€oracleçš„è‡ªå¢sequence</h2><p>oracleçš„è‡ªå¢sequenceæ˜¯ç‹¬ç«‹äºæ•°æ®çš„ï¼Œå¯¹äºè¿ç§»ç»´æŠ¤æ¯”è¾ƒæ–¹ä¾¿ã€‚å…·ä½“ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--1ã€é¦–å…ˆå»ºä¸€ä¸ªè¡¨TEST</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> TEST</span><br><span class="line">(</span><br><span class="line">  NID <span class="type">int</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  test1 varchar2(<span class="number">20</span>),</span><br><span class="line">  test2 varchar2(<span class="number">20</span>),</span><br><span class="line">  test3 varchar2(<span class="number">20</span>),</span><br><span class="line">  test4 varchar2(<span class="number">20</span>),</span><br><span class="line">  test5 varchar2(<span class="number">20</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">--2ã€å†å»ºä¸€ä¸ªåºåˆ—SEQ_TEST</span></span><br><span class="line"><span class="keyword">create</span> sequence SEQ_TEST</span><br><span class="line">minvalue <span class="number">1</span>        <span class="comment">--æœ€å°å€¼</span></span><br><span class="line">nomaxvalue        <span class="comment">--ä¸è®¾ç½®æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">start</span> <span class="keyword">with</span> <span class="number">1</span>      <span class="comment">--ä»1å¼€å§‹è®¡æ•°</span></span><br><span class="line">increment <span class="keyword">by</span> <span class="number">1</span>    <span class="comment">--æ¯æ¬¡åŠ 1ä¸ª</span></span><br><span class="line">nocycle           <span class="comment">--ä¸€ç›´ç´¯åŠ ï¼Œä¸å¾ªç¯</span></span><br><span class="line">nocache;          <span class="comment">--ä¸å»ºç¼“å†²åŒº</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é¡¹ç›®çš„mybatisä¸­ä½¿ç”¨ä¸‹é¢çš„è¯­å¥èµ‹å€¼åˆ°æ•°æ®<code>id</code>ä¸Šå³å¯ï¼›</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> SEQ_TEST <span class="keyword">FROM</span> DUAL</span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¿™ä¹ˆçš„ç®€å•ï¼Œso easy!</p><h2 id="3ã€mongoå®ç°è‡ªåŠ¨å¢é•¿sequence"><a href="#3ã€mongoå®ç°è‡ªåŠ¨å¢é•¿sequence" class="headerlink" title="3ã€mongoå®ç°è‡ªåŠ¨å¢é•¿sequence"></a>3ã€mongoå®ç°è‡ªåŠ¨å¢é•¿sequence</h2><p>ä¸¥æ ¼æ¥è¯´mongodbæœ¬èº«æ²¡æœ‰è‡ªå¢åºåˆ—ç›¸å…³çš„åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬äº†è§£åˆ°mongodbæä¾›äº†åŸå­æ“ä½œçš„å‡½æ•°<code>$inc</code>ï¼Œæ—¢ç„¶æ˜¯åŸå­æ“ä½œï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨è¿™ä¸Šé¢åšæ–‡ç« ï¼Œè‡ªå¢idä¹Ÿæ˜¯å…¨å±€å”¯ä¸€ï¼Œé‚£ä¹ˆæœ‰äº†åŸå­æ“ä½œï¼Œæˆ‘ä»¬çš„è‡ªå¢æ“ä½œå°±èƒ½å¤Ÿæ»¡è¶³ã€‚åœ¨æ¯æ¬¡è¿›è¡Œæ’å…¥æ“ä½œçš„æ—¶å€™ï¼Œåºåˆ—å€¼åŠ 1ï¼Œä½œä¸ºæœ¬æ¬¡æ“ä½œçš„idã€‚</p><p>å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><h3 id="1ã€å®šä¹‰sequenceå¯¹è±¡"><a href="#1ã€å®šä¹‰sequenceå¯¹è±¡" class="headerlink" title="1ã€å®šä¹‰sequenceå¯¹è±¡"></a>1ã€å®šä¹‰sequenceå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoSequence</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> nextVal;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getNextVal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nextVal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNextVal</span><span class="params">(<span class="keyword">long</span> nextVal)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nextVal = nextVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2ã€åˆ›å»ºè‡ªå¢åºåˆ—å·¥å…·ç±»"><a href="#2ã€åˆ›å»ºè‡ªå¢åºåˆ—å·¥å…·ç±»" class="headerlink" title="2ã€åˆ›å»ºè‡ªå¢åºåˆ—å·¥å…·ç±»"></a>2ã€åˆ›å»ºè‡ªå¢åºåˆ—å·¥å…·ç±»</h3><p>å–å·å·¥å…·ç±»MongoAutoIdUtil.javaï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoAutoIdUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getNextSequenceByCol</span><span class="params">(String collectionName)</span> </span>&#123;</span><br><span class="line">        MongoSequence sequence =</span><br><span class="line">            mongoTemplate.findAndModify(Query.query(where(<span class="string">&quot;_id&quot;</span>).is(collectionName)),</span><br><span class="line">                <span class="keyword">new</span> Update().inc(<span class="string">&quot;nextVal&quot;</span>, <span class="number">1L</span>), options().upsert(<span class="keyword">true</span>).returnNew(<span class="keyword">true</span>),</span><br><span class="line">                MongoSequence.class);</span><br><span class="line">        <span class="keyword">return</span> sequence.getNextVal();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰æ²¡æœ‰å‘ç°è¿™é‡Œçš„updateæ“ä½œå¹¶æ²¡æœ‰é›†åˆåç§°ï¼Œé‚£ä¹ˆå…·ä½“æ˜¯æ›´æ–°å“ªä¸ªé›†åˆå‘¢ï¼Ÿä¼šä¸ä¼šå¤±è´¥ï¼Ÿ</p><p>åˆ«æ‹…å¿ƒï¼Œå¦‚æœä¸è®¾ç½®é›†åˆçš„è¯ï¼Œæ‰§è¡Œçš„æ—¶å€™mongodbè‡ªå·±ä¼šæ–°å¢ä¸€ä¸ªé»˜è®¤é›†åˆåå­—å«<code>mongoSequence</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œä¼ å…¥æˆ‘ä»¬æƒ³è¦çš„åºåˆ—åå³å¯ã€‚ç„¶ååœ¨mongodbæ§åˆ¶å°ä¸­å°±èƒ½çœ‹åˆ°<code>mongoSequence</code>é›†åˆä¸­å­˜åœ¨äº†æˆ‘ä»¬æƒ³è¦çš„éœ€è¦ï¼Œæ¯æ¬¡åªè¦è°ƒç”¨è¿™ä¸ªæ–¹æ³•è·å–çš„å°±æ˜¯è‡ªå¢çš„idã€‚</p><h3 id="3ã€å‡½æ•°æ€§èƒ½"><a href="#3ã€å‡½æ•°æ€§èƒ½" class="headerlink" title="3ã€å‡½æ•°æ€§èƒ½"></a>3ã€å‡½æ•°æ€§èƒ½</h3><p>é‚£è¿™ä¸ªå‡½æ•°çš„æ€§èƒ½æ€æ ·å‘¢ï¼Ÿ</p><p>æ€§èƒ½çš„è¯ï¼Œæˆ‘ç¨å¾®æµ‹è¯•äº†ä¸‹ï¼Œ50~200ä¸ªå¹¶å‘å–idæ²¡æœ‰å‡ºç°idé‡å¤çš„æƒ…å†µï¼Œå¹¶ä¸”è‡ªå¢æ— è¯¯ã€‚å†é«˜çš„å¹¶å‘æœ¬æœº4æ ¸cpuå¤ªå¼±ï¼Œæµ‹è¯•å°±ä¸å†å…·æœ‰å‚è€ƒæ€§ï¼Œå°±ä½œç½¢äº†ã€‚</p><p>å®˜æ–¹çš„è§£é‡Šæ˜¯<code>inc</code>ä¸<code>set</code>æ€§èƒ½ç›¸å½“ï¼Œæ¯”<code>$push</code>å¿«ã€‚</p><p>åœ¨å®é™…è¿ç”¨è¿‡ç¨‹å½“ä¸­ä¹Ÿæ²¡æœ‰å‡ºç°é‡å¤å–å’Œè‡ªå¢å‡ºé”™çš„æƒ…å†µï¼Œè¿è¡Œè‰¯å¥½ã€‚</p><p>ä¸è¿‡æ—¢ç„¶é€‰æ‹©äº†mongodbï¼Œé‚£ä¹ˆæœ€å¥½åˆ©ç”¨éå…³ç³»æ•°æ®åº“çš„ç‰¹æ€§ï¼Œå‘æŒ¥å®ƒæœ€å¤§çš„æ€§èƒ½ï¼Œä¸è¦å°†è‡ªå¢idè¿™æ ·çš„åœºæ™¯æ”¾åœ¨mongodbä¸Šæ“ä½œã€‚</p><p>æ¯”å¦‚å®ƒæœ¬èº«çš„<code>_id</code>å…¶å®å°±æ˜¯ä¸ªå¾ˆå¥½çš„å…¨å±€å”¯ä¸€å¹¶ä¸”æ”¯æŒæ’åºçš„åºåˆ—ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹<code>_id</code>è¿›è¡Œèµ‹å€¼ï¼Œè®¾ç½®æˆ‘ä»¬è‡ªå·±çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚è®¾ç½®ä¸ºä¸Šé¢çš„è‡ªå¢idçš„æ•°å­—ï¼Œä½†æ˜¯ä¸æ¨èã€‚</p><p>å®˜æ–¹é’ˆå¯¹<code>_id</code>çš„æœ‰è§£é‡Šï¼Œå°‘é‡æ•°æ®é‡çš„æƒ…å†µä¸‹ï¼Œå¯¹<code>_id</code>è¿›è¡Œèµ‹å€¼å’Œä¸èµ‹å€¼æ€§èƒ½å·®åˆ«ä¸å¤§ï¼Œä½†è¾¾åˆ°ä¸€å®šæ•°æ®é‡çš„æ—¶å€™ï¼Œ<code>_id</code>è‡ªåŠ¨èµ‹å€¼æ¯”æ‰‹åŠ¨èµ‹å€¼æ€§èƒ½è¦å¥½ï¼Œå› ä¸ºéœ€è¦é¢å¤–å¯¹æˆ‘ä»¬æ‰‹åŠ¨èµ‹çš„å€¼åšä¸€æ¬¡å¤šåˆ†ç‰‡å…¨å±€å”¯ä¸€æ€§çš„æ£€æŸ¥æ“ä½œï¼Œè¿™æ²¡æœ‰mongodbè‡ªå·±çš„ç”Ÿæˆç®—æ³•æ¥å¾—å¿«ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/mongodb/">mongodb</category>
      
      
      <category domain="https://wonderomg.github.io/tags/mongodb/">mongodb</category>
      
      
      <comments>https://wonderomg.github.io/2020/09/25/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%A2%9EID%E5%BA%8F%E5%88%97/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mongodbå­¦ä¹ ç¬”è®°--åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–</title>
      <link>https://wonderomg.github.io/2020/09/13/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/</link>
      <guid>https://wonderomg.github.io/2020/09/13/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/</guid>
      <pubDate>Sun, 13 Sep 2020 13:32:20 GMT</pubDate>
      
      <description>&lt;p&gt;ã€€ã€€æœ‰æ—¶å€™æˆ‘ä»¬åœ¨éå…³ç³»æ•°æ®åº“mongodbåšä¸€äº›ç®€å•çš„åˆ†ææŸ¥è¯¢ï¼Œæ¯”å¦‚åˆ†é¡µã€‚mongodbæœ¬èº«æä¾›äº†åˆ†é¡µçš„apiï¼Œä½†æ˜¯æ¯”è¾ƒæœ‰é™ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ã€€ã€€æœ‰æ—¶å€™æˆ‘ä»¬åœ¨éå…³ç³»æ•°æ®åº“mongodbåšä¸€äº›ç®€å•çš„åˆ†ææŸ¥è¯¢ï¼Œæ¯”å¦‚åˆ†é¡µã€‚mongodbæœ¬èº«æä¾›äº†åˆ†é¡µçš„apiï¼Œä½†æ˜¯æ¯”è¾ƒæœ‰é™ã€‚</p><span id="more"></span><h2 id="1ã€åˆ†é¡µapi"><a href="#1ã€åˆ†é¡µapi" class="headerlink" title="1ã€åˆ†é¡µapi"></a>1ã€åˆ†é¡µapi</h2><p>mongodbè‡ªèº«æä¾›äº†ç±»ä¼¼mysqlçš„åˆ†é¡µå…³é”®å­—ï¼š</p><blockquote><p>æŸ¥è¯¢æ—¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query.skip((pageNum - <span class="number">1</span>)*pageSize).limit(pageSize);</span><br></pre></td></tr></table></figure></blockquote><p>éœ€è¦æ˜¯è·³è·ƒæŸ¥è¯¢ï¼Œä½†æ˜¯è¾¾åˆ°ä¸€å®šæ•°æ®é‡çº§çš„ï¼ŒæŸ¥è¯¢æ•ˆç‡å¾ˆä½ï¼Œç”šè‡³æŸ¥ä¸åŠ¨ã€‚</p><p>skipè¾¾åˆ°ä¸€å®šæ•°æ®é‡æ—¶ï¼Œè¶…è¿‡äº†ç³»ç»Ÿé»˜è®¤çš„32MBå†…å­˜æ’åºï¼Œæ‰€ä»¥mongoé‡æ–°ä½¿ç”¨äº†å…¶ä»–ç®—æ³•æ’åºï¼Œå‡ºç°å¤§é‡æ‰«æï¼Œå¯¼è‡´æ…¢æŸ¥è¯¢ã€‚</p><p>è¿™ä¸ªå†™æ³•å’Œmysqlçš„<code>limit offset,rows</code>ç±»ä¼¼ï¼š</p><blockquote><p>ä¸‹é¢ä¸¤æ¡è¯­å¥æ˜¯ç­‰ä»·çš„ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> <span class="keyword">collect</span> limit <span class="number">1000000</span>,<span class="number">10</span>;</span><br><span class="line">#<span class="operator">*</span><span class="operator">*</span>MySQL5<span class="number">.0</span>ä¹‹åæ”¯æŒè¯¥è¯­æ³•<span class="operator">*</span><span class="operator">*</span></span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> <span class="keyword">collect</span> limit <span class="number">10</span> <span class="keyword">offset</span> <span class="number">1000000</span>;</span><br></pre></td></tr></table></figure></blockquote><p>ç­‰äºæ˜¯ä¸€ç›´å¾€åè¯»å–åˆ°ç¬¬1000000æ¡ï¼Œå¼€å§‹å–10æ¡ï¼Œè¯»å–äº†1000000æ²¡ç”¨çš„æ•°æ®ï¼Œmysqlçš„ä¼˜åŒ–æ–¹å¼æ˜¯æ‰¾åˆ°ç¬¬1000000æ¡æ•°æ®çš„idï¼Œå¼€å§‹è¯»å–10æ¡ï¼Œä¸»è¦æ˜¯åˆ©ç”¨ç´¢å¼•ä½ç½®æ¥å®šä½åˆ†é¡µèµ·å§‹ä½ï¼š</p><blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> <span class="keyword">collect</span> <span class="keyword">where</span> id<span class="operator">&gt;</span><span class="number">1000000</span> limit <span class="number">10</span>;</span><br></pre></td></tr></table></figure></blockquote><p>æŸ¥è¯¢è¿‡ç¨‹ç»è¿‡äº†<code>pageNum*pageSize</code>æ¡æ•°æ®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">web--&gt;pageNum</span><br><span class="line">web--&gt;pageSize</span><br><span class="line">pageNum--&gt;pageNum*pageSize</span><br><span class="line">pageSize--&gt;pageNum*pageSize</span><br><span class="line">pageNum*pageSize--&gt;skip</span><br><span class="line">skip--&gt;limitç¬¬pageNumé¡µçš„æ•°æ®</span><br></pre></td></tr></table></figure><h2 id="2ã€ä¼˜åŒ–æ–¹å‘"><a href="#2ã€ä¼˜åŒ–æ–¹å‘" class="headerlink" title="2ã€ä¼˜åŒ–æ–¹å‘"></a>2ã€ä¼˜åŒ–æ–¹å‘</h2><p>ç­‰å®˜æ–¹ä¼˜åŒ–<code>skip()</code>ç¡®å®šæ—¶é—´ï¼Œæ¯•ç«Ÿmongoä½¿ç”¨åœºæ™¯ä¹Ÿå¤§å¤šä¸æ˜¯ç”¨æ¥åˆ†é¡µï¼Œé‚£ä¹ˆåªèƒ½é¿å…ä½¿ç”¨<code>skip()</code>ã€‚ä¸ä½¿ç”¨<code>skip()</code>é‚£æ€ä¹ˆä¼˜åŒ–å‘¢ï¼Ÿæˆ‘ä»¬å€ŸåŠ©å…¶ä»–å‡½æ•°æ›²çº¿æ•‘å›½ï¼Œæ¯”å¦‚<code>sort()</code>æ’åºå’Œ <code>limit()</code> ï¼Œå’Œmysqlçš„ä¼˜åŒ–æ–¹å‘ä¸€æ ·ï¼ŒçŸ¥é“èµ·å§‹idå†æŸ¥è¯¢å½“å‰é¡µï¼Œç†è®ºä¸Šä¼šå¿«å¾ˆå¤šã€‚ç›¸å½“äºè·³è¿‡äº†<code>pageNum*pageSize</code>æ¡æ•°æ®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">web--&gt;pageNum</span><br><span class="line">web--&gt;pageSize</span><br><span class="line">pageNum--&gt;pageNum*pageSizeçš„æ•°æ®_id</span><br><span class="line">pageSize--&gt;pageNum*pageSizeçš„æ•°æ®_id</span><br><span class="line">pageNum*pageSizeçš„æ•°æ®_id--&gt;ä½¿ç”¨$gtå‡½æ•°å¤§äº_id</span><br><span class="line">pageNum*pageSizeçš„æ•°æ®_id--&gt;skipè·³é¡µpageSize</span><br><span class="line">ä½¿ç”¨$gtå‡½æ•°å¤§äº_id--&gt;ç¬¬pageNumé¡µçš„æ•°æ®</span><br><span class="line">skipè·³é¡µpageSize--&gt;ç¬¬pageNumé¡µçš„æ•°æ®</span><br></pre></td></tr></table></figure><h2 id="3ã€å®ç°"><a href="#3ã€å®ç°" class="headerlink" title="3ã€å®ç°"></a>3ã€å®ç°</h2><p>å¯¹è±¡ä¸­è®¾ç½®<code>id</code>å±æ€§å³å¯å¾—åˆ°<code>_id</code>çš„å€¼ï¼ŒStringçš„è¯å¾—åˆ°ä¸€ä¸²åå…­è¿›åˆ¶çš„å­—ç¬¦æ„æˆçš„å­—ç¬¦ä¸²ï¼Œå…·ä½“æ„æˆå¯æŸ¥çœ‹<code>ObjectId</code>çš„æ„æˆã€‚</p><blockquote><p> å‡è®¾å®ä½“å¯¹è±¡ä¸ºGoodsï¼Œè®¾ç½®idå±æ€§ï¼š</p> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String id;</span><br></pre></td></tr></table></figure></blockquote><p>å°†å¾—åˆ°<code>_id</code>è®¾ç½®ä¸ºåˆ†é¡µçš„èµ·å§‹<code>_id</code>ï¼Œï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Goods&gt; <span class="title">getListByPage</span><span class="params">(<span class="keyword">int</span> pageNum, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">    List&lt;Goods&gt; goodsList;</span><br><span class="line"></span><br><span class="line">    Query query = <span class="keyword">new</span> Query();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡ _id æ­£åºæ’åº</span></span><br><span class="line">    query.with(Sort.by(Sort.Direction.ASC, <span class="string">&quot;_id&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (pageNum != <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// number å‚æ•°æ˜¯ä¸ºäº†æŸ¥ä¸Šä¸€é¡µçš„æœ€åä¸€æ¡æ•°æ®</span></span><br><span class="line">        <span class="keyword">int</span> number = (pageNum - <span class="number">1</span>) * pageSize;</span><br><span class="line">        query.limit(number);</span><br><span class="line"></span><br><span class="line">        List&lt;Goods&gt; goodsListTemp = mongoTemplate.find(query, Goods.class);</span><br><span class="line">        <span class="comment">// å–å‡ºæœ€åä¸€æ¡</span></span><br><span class="line">        Goods goods = goodsListTemp.get(goodsListTemp.size() - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å–åˆ°ä¸Šä¸€é¡µçš„æœ€åä¸€æ¡æ•°æ®_idï¼Œå½“ä½œæ¡ä»¶æŸ¥æ¥ä¸‹æ¥çš„æ•°æ®</span></span><br><span class="line">        String id = goods.getId();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»ä¸Šä¸€é¡µæœ€åä¸€æ¡å¼€å§‹æŸ¥ï¼ˆå¤§äºä¸åŒ…æ‹¬è¿™ä¸€æ¡ï¼‰</span></span><br><span class="line">        query.addCriteria(Criteria.where(<span class="string">&quot;_id&quot;</span>).gt(id));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é¡µå¤§å°é‡æ–°èµ‹å€¼ï¼Œè¦†ç›– number å‚æ•°</span></span><br><span class="line">    query.limit(pageSize);</span><br><span class="line">    <span class="comment">// å³å¯å¾—åˆ°ç¬¬né¡µæ•°æ®</span></span><br><span class="line">    goodsList = mongoTemplate.find(query, Goods.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> goodsList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„é¿å…äº†<code>skip()</code>çš„ä½¿ç”¨ï¼Œé€šè¿‡<code>sort()</code>æ’åºå’Œ <code>limit()</code> é™åˆ¶æ•°æ®å¤§å°ç»“åˆæ’åºï¼Œæ¯ä¸€æ¬¡åˆ†é¡µæŸ¥è¯¢ä»æ•°æ®çš„ä¸Šä¸€é¡µçš„æœ€åä¸€æ¡æ•°æ®ä½œä¸ºèµ·å§‹ä½ç½®ï¼Œå†æŸ¥è¯¢é¡µå¤§å°çš„æ•°æ®é‡ã€‚</p><h2 id="4ã€å»ºè®®"><a href="#4ã€å»ºè®®" class="headerlink" title="4ã€å»ºè®®"></a>4ã€å»ºè®®</h2><p>ä»ä»£ç è¡¨ç°ä¸Šæ¥çœ‹ï¼Œæ¯ä¸€æ¬¡æŸ¥è¯¢éƒ½éœ€è¦é€šè¿‡æŸ¥è¯¢å½“å‰é¡µä¹‹å‰çš„æ‰€æœ‰æ•°æ®æ¥å¾—åˆ°èµ·å§‹ä½ç½®çš„<code>_id</code>ï¼Œç›¸å½“äºæŸ¥è¯¢äº†å¤§é‡æ•°æ®ï¼Œå¯¹å†…å­˜æ¶ˆè€—è¾ƒå¤§ã€‚</p><p>é’ˆå¯¹é¡µæ•°ä¸æ˜¯ç‰¹åˆ«å¤šçš„æƒ…å†µä¸‹ï¼Œè¿™ç§ä¼˜åŒ–æ–¹å¼ä¹Ÿæ˜¯æ¯”<code>skip()</code>æ•ˆç‡è¦é«˜çš„ã€‚</p><p>å¦‚æœé¡µæ•°ç‰¹åˆ«å¤šï¼Œæ¯é¡µsizeä¹Ÿè¾ƒå¤§ï¼Œé‚£ä¹ˆä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®åº“å‹åŠ›ä¹Ÿæ˜¯æ¯”è¾ƒå¤§çš„ï¼Œè¿™ç§æƒ…å†µå°±éœ€è¦ä»ä¸šåŠ¡æ–¹é¢è€ƒé‡ï¼Œä¸é€‚åˆåšåˆ†é¡µï¼Œæˆ–è€…å°†åˆ†æå‹ä¸šåŠ¡ç‹¬ç«‹ï¼Œè¿™æ ·çš„åˆ†æç»Ÿè®¡ç±»æ“ä½œå¯ä»¥æ”¾åˆ°<code>Elasticsearch</code>ç­‰æ›´é€‚åˆçš„å­˜å‚¨ä¸Šã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/mongodb/">mongodb</category>
      
      
      <category domain="https://wonderomg.github.io/tags/mongodb/">mongodb</category>
      
      <category domain="https://wonderomg.github.io/tags/%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/">åˆ†é¡µæŸ¥è¯¢</category>
      
      
      <comments>https://wonderomg.github.io/2020/09/13/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Elasticsearchå®è·µ(3)-apiåˆ†é¡µæŸ¥è¯¢</title>
      <link>https://wonderomg.github.io/2018/05/17/Elasticsearch%E5%AE%9E%E8%B7%B5api%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/</link>
      <guid>https://wonderomg.github.io/2018/05/17/Elasticsearch%E5%AE%9E%E8%B7%B5api%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/</guid>
      <pubDate>Wed, 16 May 2018 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;elasticsearchç³»åˆ—ï¼š&lt;/p&gt;
&lt;p&gt;(1)&lt;a href=&quot;https://wonderomg.github.io/2018/05/15/Elasticsearch%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E5%8F%8AIK%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/&quot;&gt;Elasticsearchå®è·µ(1)-æ­å»ºåŠIKä¸­æ–‡åˆ†è¯&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(2)&lt;a href=&quot;https://wonderomg.github.io/2018/05/16/Elasticsearch%E5%AE%9E%E8%B7%B5%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8Dalias/&quot;&gt;Elasticsearchå®è·µ(2)-ç´¢å¼•åŠç´¢å¼•åˆ«åalias&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;(3)&lt;a href=&quot;https://wonderomg.github.io/2018/05/17/Elasticsearch%E5%AE%9E%E8%B7%B5api%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/&quot;&gt;Elasticsearchå®è·µ(3)-apiåˆ†é¡µæŸ¥è¯¢&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;esåˆ†é¡µæœ‰ä¸¤ç§ï¼Œfrom sizeæµ…åˆ†é¡µå’Œscrollæ·±åˆ†é¡µï¼Œè¿™é‡Œå¯¹è¿™ä¸¤ç§åˆ†é¡µéƒ½åšäº†å®ç°ï¼Œä½¿ç”¨çš„æ˜¯esçš„java apiã€‚from sizeç±»ä¼¼äºmysqlçš„limitåˆ†é¡µï¼Œfromåç§»ï¼Œé»˜è®¤ä¸º0ï¼Œsizeä¸ºè¿”å›çš„ç»“æœæ•°é‡ï¼Œé»˜è®¤ä¸º10ã€‚åœ¨æ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šä½¿ç”¨from sizeï¼Œæ•°æ®é‡å¤§çš„æ—¶å€™æ•ˆç‡æ¯”è¾ƒä½ï¼Œè€Œä¸”å¾ˆè´¹å†…å­˜ï¼Œæ¯æ¬¡ä¼šæŠŠfrom*sizeæ¡è®°å½•å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¯¹ç»“æœè¿”å›å‰è¿›è¡Œå…¨å±€æ’åºï¼Œç„¶åä¸¢å¼ƒæ‰èŒƒå›´å¤–çš„ç»“æœï¼Œé‡å¤è¿™æ ·çš„æ“ä½œä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤§è€Œä½¿esæŒ‚æ‰ï¼Œå¹¶ä¸”å—æ•°æ®æ¡æ•°é™åˆ¶ï¼Œ10000æ¡ï¼Œéœ€ä¿®æ”¹ç´¢å¼•é™åˆ¶ã€‚ğŸ¤”&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>elasticsearchç³»åˆ—ï¼š</p><p>(1)<a href="https://wonderomg.github.io/2018/05/15/Elasticsearch%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E5%8F%8AIK%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/">Elasticsearchå®è·µ(1)-æ­å»ºåŠIKä¸­æ–‡åˆ†è¯</a></p><p>(2)<a href="https://wonderomg.github.io/2018/05/16/Elasticsearch%E5%AE%9E%E8%B7%B5%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8Dalias/">Elasticsearchå®è·µ(2)-ç´¢å¼•åŠç´¢å¼•åˆ«åalias</a></p><p>(3)<a href="https://wonderomg.github.io/2018/05/17/Elasticsearch%E5%AE%9E%E8%B7%B5api%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/">Elasticsearchå®è·µ(3)-apiåˆ†é¡µæŸ¥è¯¢</a></p><p>esåˆ†é¡µæœ‰ä¸¤ç§ï¼Œfrom sizeæµ…åˆ†é¡µå’Œscrollæ·±åˆ†é¡µï¼Œè¿™é‡Œå¯¹è¿™ä¸¤ç§åˆ†é¡µéƒ½åšäº†å®ç°ï¼Œä½¿ç”¨çš„æ˜¯esçš„java apiã€‚from sizeç±»ä¼¼äºmysqlçš„limitåˆ†é¡µï¼Œfromåç§»ï¼Œé»˜è®¤ä¸º0ï¼Œsizeä¸ºè¿”å›çš„ç»“æœæ•°é‡ï¼Œé»˜è®¤ä¸º10ã€‚åœ¨æ•°æ®é‡ä¸å¤§çš„æƒ…å†µä¸‹ä¸€èˆ¬ä¼šä½¿ç”¨from sizeï¼Œæ•°æ®é‡å¤§çš„æ—¶å€™æ•ˆç‡æ¯”è¾ƒä½ï¼Œè€Œä¸”å¾ˆè´¹å†…å­˜ï¼Œæ¯æ¬¡ä¼šæŠŠfrom*sizeæ¡è®°å½•å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¯¹ç»“æœè¿”å›å‰è¿›è¡Œå…¨å±€æ’åºï¼Œç„¶åä¸¢å¼ƒæ‰èŒƒå›´å¤–çš„ç»“æœï¼Œé‡å¤è¿™æ ·çš„æ“ä½œä¼šå¯¼è‡´å†…å­˜å ç”¨è¿‡å¤§è€Œä½¿esæŒ‚æ‰ï¼Œå¹¶ä¸”å—æ•°æ®æ¡æ•°é™åˆ¶ï¼Œ10000æ¡ï¼Œéœ€ä¿®æ”¹ç´¢å¼•é™åˆ¶ã€‚ğŸ¤”</p><span id="more"></span><p>scrollåˆ†é¡µé€šä¿—æ¥è¯´å°±æ˜¯æ»šå±ç¿»é¡µï¼Œè®¾ç½®æ¯é¡µæŸ¥è¯¢æ•°é‡ä¹‹åï¼Œæ¯æ¬¡æŸ¥è¯¢ä¼šè¿”å›ä¸€ä¸ªscroll_idï¼Œå³å½“å‰æ–‡æ¡£çš„ä½ç½®ï¼Œä¸‹æ¬¡æŸ¥è¯¢å†ä¼ è¿™ä¸ªscroll_idç»™esè¿”å›ä¸‹ä¸€é¡µçš„æ•°æ®ä»¥åŠä¸€ä¸ªæ–°çš„scroll_idï¼Œç±»ä¼¼äºæŒ‰ä¹¦é¡µç é¡ºåºç¿»ä¹¦å’Œæ¸¸æ ‡ï¼Œé—æ†¾çš„æ˜¯ä¸æ”¯æŒè·³é¡µã€‚ğŸ¤”é€‚ç”¨äºä¸éœ€è¦è·³é¡µæŒç»­æ‰¹é‡æ‹‰å–ç»“æœã€å¯¹æ‰€æœ‰æ•°æ®åˆ†é¡µæˆ–ä¸€æ¬¡æ€§æŸ¥è¯¢å¤§é‡æ•°æ®çš„åœºæ™¯ï¼Œè¿™ç§è®°å½•æ–‡æ¡£ä½ç½®çš„æŸ¥è¯¢æ–¹å¼æ•ˆç‡éå¸¸é«˜ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„å€’æ’ç´¢å¼•ã€‚ä¸‹é¢ä½¿ç”¨java apiå®ç°è¿™ä¸¤ç§åˆ†é¡µæ•ˆæœã€‚</p><h2 id="1-ä½¿ç”¨from-sizeæŸ¥è¯¢"><a href="#1-ä½¿ç”¨from-sizeæŸ¥è¯¢" class="headerlink" title="1. ä½¿ç”¨from sizeæŸ¥è¯¢"></a>1. ä½¿ç”¨from sizeæŸ¥è¯¢</h2><p>ä½¿ç”¨ from and size çš„æ·±åº¦åˆ†é¡µï¼Œæ¯”å¦‚è¯´ <code>?size=10&amp;from=10000</code> æ˜¯éå¸¸ä½æ•ˆçš„ï¼Œ<br>å› ä¸º 100,000 æ’åºçš„ç»“æœå¿…é¡»ä»æ¯ä¸ªåˆ†ç‰‡ä¸Šå–å‡ºå¹¶é‡æ–°æ’åºæœ€åè¿”å› 10 æ¡ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦å¯¹æ¯ä¸ªè¯·æ±‚é¡µé‡å¤ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H &#x27;Content-Type:application/json&#x27; -d&#x27;</span><br><span class="line">&#123; &quot;from&quot; : 0, &quot;size&quot; : 10,</span><br><span class="line">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;content&quot; : &quot;è¿›å£æ°´æœ&quot; &#125;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure><h2 id="2-ä½¿ç”¨scrollæŸ¥è¯¢"><a href="#2-ä½¿ç”¨scrollæŸ¥è¯¢" class="headerlink" title="2. ä½¿ç”¨scrollæŸ¥è¯¢"></a>2. ä½¿ç”¨scrollæŸ¥è¯¢</h2><p>ä½¿ç”¨scrollæŸ¥è¯¢ï¼Œéœ€è¦è®¾ç½®<code>scroll_id</code>çš„å¤±æ•ˆæ—¶é—´ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;10.10.13.234:9200/index/skuId/_search?scroll=1m&#x27;  -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;name&quot; : &quot;è¿›å£æ°´æœ&quot; &#125;&#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ä¼šè¿”å›<code>scroll_id</code>ï¼Œæ ¹æ®è¿™ä¸ª<code>scroll_id</code>è¿›è¡Œä¸‹ä¸€æ¬¡æŸ¥è¯¢</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET 10.10.13.234:9200/jd_mall_v2/_search?pretty&amp;scroll=2m -d &#123;&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;</span><br><span class="line">curl -XGET &#x27;10.10.13.234:9200/jd_mall_v2/_search?pretty&amp;scroll=2m&amp;search_type=scan&#x27; -d &#x27;&#123;&quot;size&quot;:3,&quot;query&quot;:&#123;&quot;match_all&quot;:&#123;&#125;&#125;&#125;&#x27;</span><br><span class="line">curl â€“XGET &#x27;10.10.13.234:9200/_search/scroll?scroll=2m&amp;pretty</span><br><span class="line">&amp;scroll_id=c2Nhbjs1OzcyNTY6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjYwOjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7NzI1Nzo3VS04THcyaFJBeTZKMWdqbDhuT05ROzcyNTg6N1UtOEx3MmhSQXk2SjFnamw4bk9OUTs3MjU5OjdVLThMdzJoUkF5NkoxZ2psOG5PTlE7MTt0b3RhbF9oaXRzOjUxNTM3MDs=&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1-ä½¿ç”¨esçš„java-apiæ“ä½œ"><a href="#1-ä½¿ç”¨esçš„java-apiæ“ä½œ" class="headerlink" title="1. ä½¿ç”¨esçš„java apiæ“ä½œ"></a>1. ä½¿ç”¨esçš„java apiæ“ä½œ</h2><p>java apiå¯æŸ¥é˜…<a href="https://es.quanke.name/%EF%BC%8C">https://es.quanke.name/ï¼Œ</a></p><p>åˆ›å»ºspringbootå·¥ç¨‹ï¼Œå¯ä»¥åœ¨<a href="http://start.spring.io/">http://start.spring.io/</a></p><p>ä¸‹è½½springbootå·¥ç¨‹æ¨¡æ¿ï¼Œä¹Ÿå¯åœ¨github:<a href="https://github.com/wonderomg/elasticsearch-visual">https://github.com/wonderomg/elasticsearch-visual</a>ä¸‹è½½æœ¬å·¥ç¨‹ã€‚</p><p>(1)å¯¼å…¥esçš„mavenä¾èµ–ï¼Œpom.xmlå†…å®¹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Elasticsearchæ ¸å¿ƒä¾èµ–åŒ… --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.elasticsearch/elasticsearch --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-1-åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨"><a href="#1-1-åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨" class="headerlink" title="1.1  åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨"></a>1.1  åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨</h3><p>æ£€éªŒç´¢å¼•æ˜¯å¦åˆ›å»ºæˆåŠŸï¼Œæ˜¯å¦å­˜åœ¨ï¼Œé€šè¿‡prepareExistsæŸ¥è¯¢æŒ‡å®šç´¢å¼•ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> client</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isIndexExists</span><span class="params">(Client client, String index)</span> </span>&#123;</span><br><span class="line">        IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">        IndicesExistsResponse response = indicesAdminClient.prepareExists(index).get();</span><br><span class="line">        <span class="keyword">return</span> response.isExists();</span><br><span class="line">        <span class="comment">/* å¦ä¸€ç§æ–¹å¼</span></span><br><span class="line"><span class="comment">        IndicesExistsRequest indicesExistsRequest = new IndicesExistsRequest(index);</span></span><br><span class="line"><span class="comment">        IndicesExistsResponse response = client.admin().indices().exists(indicesExistsRequest).actionGet();*/</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-åˆ¤æ–­ç±»å‹æ˜¯å¦å­˜åœ¨"><a href="#1-2-åˆ¤æ–­ç±»å‹æ˜¯å¦å­˜åœ¨" class="headerlink" title="1.2 åˆ¤æ–­ç±»å‹æ˜¯å¦å­˜åœ¨"></a>1.2 åˆ¤æ–­ç±»å‹æ˜¯å¦å­˜åœ¨</h3><p>ç±»å‹å­˜åœ¨çš„æ£€æŸ¥ä¸ç´¢å¼•çš„æ£€æŸ¥ç±»ä¼¼ï¼Œåªä¸è¿‡ç±»å‹åªæŒ‚åœ¨ç´¢å¼•ä¸‹ï¼Œæ‰€ä»¥éœ€è¦å…ˆæŒ‡å®šç´¢å¼•åï¼Œç„¶åå†æŸ¥è¯¢ç±»å‹æ˜¯å¦å­˜åœ¨ï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2.åˆ¤æ–­ç±»å‹æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> client</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isTypeExists</span><span class="params">(Client client, String index, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!isIndexExists(client, index)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">        TypesExistsResponse response = indicesAdminClient.prepareTypesExists(index).setTypes(type).get();</span><br><span class="line">        <span class="keyword">return</span> response.isExists();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-åˆ›å»ºå¤æ‚ç´¢å¼•"><a href="#1-3-åˆ›å»ºå¤æ‚ç´¢å¼•" class="headerlink" title="1.3 åˆ›å»ºå¤æ‚ç´¢å¼•"></a>1.3 åˆ›å»ºå¤æ‚ç´¢å¼•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3.åˆ›å»ºå¤æ‚ç´¢å¼•ï¼Œå³æœ‰æ˜ å°„</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> indices</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clusterName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> port</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">createYxMapping</span><span class="params">(String indices, String type, String clusterName, String host, <span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Settings settings = Settings.settingsBuilder()</span><br><span class="line">                    .put(<span class="string">&quot;cluster.name&quot;</span>, clusterName)</span><br><span class="line">                    .put(<span class="string">&quot;client.transport.sniff&quot;</span>, <span class="keyword">true</span>)</span><br><span class="line">                    .build();</span><br><span class="line">            Client client = TransportClient.builder().settings(settings).build()</span><br><span class="line">                    .addTransportAddress(<span class="keyword">new</span> InetSocketTransportAddress(InetAddress.getByName(host), port));</span><br><span class="line">            client.admin().indices().prepareCreate(indices).execute().actionGet();</span><br><span class="line">            <span class="keyword">new</span> XContentFactory();</span><br><span class="line">            XContentBuilder builder = XContentFactory.jsonBuilder()</span><br><span class="line">                    .startObject()</span><br><span class="line">                    .startObject(type)</span><br><span class="line">                    .startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">                    .startObject(<span class="string">&quot;name&quot;</span>).field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;string&quot;</span>).field(<span class="string">&quot;store&quot;</span>, <span class="string">&quot;yes&quot;</span>).field(<span class="string">&quot;analyzer&quot;</span>, <span class="string">&quot;ik&quot;</span>).field(<span class="string">&quot;index&quot;</span>, <span class="string">&quot;analyzed&quot;</span>).endObject()</span><br><span class="line">                    .startObject(<span class="string">&quot;num&quot;</span>).field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;long&quot;</span>).endObject()</span><br><span class="line">                    .startObject(<span class="string">&quot;sex&quot;</span>).field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;string&quot;</span>).field(<span class="string">&quot;index&quot;</span>, <span class="string">&quot;not_analyzed&quot;</span>).endObject()</span><br><span class="line">                    .endObject()</span><br><span class="line">                    .endObject()</span><br><span class="line">                    .endObject();</span><br><span class="line">            PutMappingRequest mapping = Requests.putMappingRequest(indices).type(type).source(builder);</span><br><span class="line"></span><br><span class="line">            client.admin().indices().putMapping(mapping).actionGet();</span><br><span class="line">            client.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;createMapping error &quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-åˆ›å»ºç©ºç´¢å¼•"><a href="#1-4-åˆ›å»ºç©ºç´¢å¼•" class="headerlink" title="1.4 åˆ›å»ºç©ºç´¢å¼•"></a>1.4 åˆ›å»ºç©ºç´¢å¼•</h3><p>åˆ›å»ºä¸€ä¸ªç©ºç´¢å¼•ï¼Œæ— æ˜ å°„mappingï¼Œå½“æˆ‘ä»¬è®¾è®¡å¥½mappingçš„ç›¸å…³è®¾ç½®å†æ˜ å°„å³å¯ï¼Œç©ºç´¢å¼•åˆ›å»ºå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 4.åˆ›å»ºç©ºç´¢å¼•  é»˜è®¤setting æ— mapping</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">createSimpleIndex</span><span class="params">(Client client, String index)</span></span>&#123;</span><br><span class="line">    IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">    CreateIndexResponse response = indicesAdminClient.prepareCreate(index).get();</span><br><span class="line">    <span class="keyword">return</span> response.isAcknowledged();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5-ä¸ºç©ºç´¢å¼•æ˜ å°„mapping"><a href="#1-5-ä¸ºç©ºç´¢å¼•æ˜ å°„mapping" class="headerlink" title="1.5 ä¸ºç©ºç´¢å¼•æ˜ å°„mapping"></a>1.5 ä¸ºç©ºç´¢å¼•æ˜ å°„mapping</h3><p>å¯ä»¥ä¸ºç©ºç´¢å¼•åˆ›å»ºæˆ–ä¿®æ”¹ç´¢å¼•çš„æ˜ å°„ï¼Œéœ€è¦ç¡®ä¿ç´¢å¼•å­˜åœ¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 5.è®¾ç½®æ˜ å°„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">putIndexMapping</span><span class="params">(Client client, String index, String type)</span></span>&#123;</span><br><span class="line">    <span class="comment">// mapping</span></span><br><span class="line">    XContentBuilder mappingBuilder;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        mappingBuilder = XContentFactory.jsonBuilder()</span><br><span class="line">                .startObject()</span><br><span class="line">                .startObject(type)</span><br><span class="line">                .startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">                .startObject(<span class="string">&quot;name&quot;</span>).field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;string&quot;</span>).field(<span class="string">&quot;store&quot;</span>, <span class="string">&quot;yes&quot;</span>).field(<span class="string">&quot;analyzer&quot;</span>, <span class="string">&quot;ik&quot;</span>).field(<span class="string">&quot;index&quot;</span>, <span class="string">&quot;analyzed&quot;</span>).endObject()</span><br><span class="line">                 .startObject(<span class="string">&quot;num&quot;</span>).field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;long&quot;</span>).endObject()</span><br><span class="line">                 .startObject(<span class="string">&quot;sex&quot;</span>).field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;string&quot;</span>).field(<span class="string">&quot;index&quot;</span>, <span class="string">&quot;not_analyzed&quot;</span>).endObject()</span><br><span class="line">                 .endObject()</span><br><span class="line">                 .endObject()</span><br><span class="line">                 .endObject();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;--------- createIndex åˆ›å»º mapping å¤±è´¥ï¼š&quot;</span>, e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">    PutMappingResponse response = indicesAdminClient.preparePutMapping(index).setType(type).setSource(mappingBuilder).get();</span><br><span class="line">    <span class="keyword">return</span> response.isAcknowledged();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-6-åˆ é™¤ç´¢å¼•"><a href="#1-6-åˆ é™¤ç´¢å¼•" class="headerlink" title="1.6 åˆ é™¤ç´¢å¼•"></a>1.6 åˆ é™¤ç´¢å¼•</h3><p>åˆ é™¤ç´¢å¼•apiï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 6.åˆ é™¤ç´¢å¼•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> client</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteIndex</span><span class="params">(Client client, String index)</span> </span>&#123;</span><br><span class="line">        IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">        DeleteIndexResponse response = indicesAdminClient.prepareDelete(index).execute().actionGet();</span><br><span class="line">        <span class="keyword">return</span> response.isAcknowledged();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="1-7-å…³é—­ç´¢å¼•"><a href="#1-7-å…³é—­ç´¢å¼•" class="headerlink" title="1.7 å…³é—­ç´¢å¼•"></a>1.7 å…³é—­ç´¢å¼•</h3><p>å¦‚æœæˆ‘ä»¬ä¸æƒ³ç›´æ¥åˆ é™¤ç´¢å¼•ï¼Œè€Œæ˜¯ä»…ä»…çŸ­æš‚åœæ­¢æŸä¸ªç´¢å¼•çš„ä½¿ç”¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…³é—­ç´¢å¼•çš„è¿™ä¸ªåŠŸèƒ½ï¼Œåªæ˜¯çŸ­æš‚ä½¿ç”¨ä¹‹ï¼Œåç»­å¯èƒ½æœ‰æ¢å¤çš„éœ€æ±‚ï¼Œå…³é—­ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 7.å…³é—­ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">closeIndex</span><span class="params">(Client client, String index)</span></span>&#123;</span><br><span class="line">    IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">    CloseIndexResponse response = indicesAdminClient.prepareClose(index).get();</span><br><span class="line">    <span class="keyword">return</span> response.isAcknowledged();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-8-æ‰“å¼€ç´¢å¼•"><a href="#1-8-æ‰“å¼€ç´¢å¼•" class="headerlink" title="1.8 æ‰“å¼€ç´¢å¼•"></a>1.8 æ‰“å¼€ç´¢å¼•</h3><p>æ—¢ç„¶æœ‰å…³é—­ç´¢å¼•ï¼Œé‚£ä¹ˆè‚¯å®šä¹Ÿæœ‰é‡æ–°æ‰“å¼€ç´¢å¼•çš„æ“ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 8.å¼€å¯ç´¢å¼•</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> client</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> index</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">openIndex</span><span class="params">(Client client, String index)</span></span>&#123;</span><br><span class="line">    IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">    OpenIndexResponse response = indicesAdminClient.prepareOpen(index).get();</span><br><span class="line">    <span class="keyword">return</span> response.isAcknowledged();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-9-åˆ¤æ–­åˆ«åæ˜¯å¦å­˜åœ¨"><a href="#1-9-åˆ¤æ–­åˆ«åæ˜¯å¦å­˜åœ¨" class="headerlink" title="1.9 åˆ¤æ–­åˆ«åæ˜¯å¦å­˜åœ¨"></a>1.9 åˆ¤æ–­åˆ«åæ˜¯å¦å­˜åœ¨</h3><p>ä¸Šä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ äº†ç´¢å¼•åˆ«åçš„é‡è¦ï¼Œæ‰€ä»¥apiä¹Ÿä¸èƒ½è½ä¸‹ï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 9.åˆ¤æ–­åˆ«åæ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAliasExist</span><span class="params">(Client client, String... aliases)</span> </span>&#123;</span><br><span class="line">        IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">        AliasesExistResponse response = indicesAdminClient.prepareAliasesExist(aliases).get();</span><br><span class="line">        <span class="keyword">return</span> response.isExists();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="1-10-æ·»åŠ åˆ«å"><a href="#1-10-æ·»åŠ åˆ«å" class="headerlink" title="1.10 æ·»åŠ åˆ«å"></a>1.10 æ·»åŠ åˆ«å</h3><p>åˆ«åæ˜¯æ˜ å°„åˆ°å®é™…ç´¢å¼•ä¸Šï¼Œæ‰€ä»¥éœ€è¦ä¼ å…¥å®é™…ç´¢å¼•åä»¥åŠè¦è®¾ç½®çš„åˆ«åaliasï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 10.æ·»åŠ åˆ«å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAlias</span><span class="params">(TransportClient client, String index, String alias)</span> </span>&#123;</span><br><span class="line">        IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().addAlias(index, alias).get();</span><br><span class="line">        <span class="keyword">return</span> response.isAcknowledged();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="1-11-ç§»é™¤åˆ«å"><a href="#1-11-ç§»é™¤åˆ«å" class="headerlink" title="1.11 ç§»é™¤åˆ«å"></a>1.11 ç§»é™¤åˆ«å</h3><p>å½“ç„¶ï¼Œæ·»åŠ çš„åˆ«åä¹Ÿå¯ä»¥åˆ é™¤ï¼Œæ–¹ä¾¿è®¾ç½®æ–°çš„åˆ«åå’Œåˆ‡æ¢ç´¢å¼•åˆ«åï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 11.ç§»é™¤åˆ«å</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAlias</span><span class="params">(TransportClient client, String index, String alias)</span> </span>&#123;</span><br><span class="line">        IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(index, alias).get();</span><br><span class="line">        <span class="keyword">return</span> response.isAcknowledged();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="1-12-åˆ é™¤ä¸€ä¸ªåˆ«ååå†æ·»åŠ ä¸€ä¸ªåˆ«å"><a href="#1-12-åˆ é™¤ä¸€ä¸ªåˆ«ååå†æ·»åŠ ä¸€ä¸ªåˆ«å" class="headerlink" title="1.12 åˆ é™¤ä¸€ä¸ªåˆ«ååå†æ·»åŠ ä¸€ä¸ªåˆ«å"></a>1.12 åˆ é™¤ä¸€ä¸ªåˆ«ååå†æ·»åŠ ä¸€ä¸ªåˆ«å</h3><p>è¿™é‡Œå®é™…ä¸Šå°†åˆ é™¤ä¸æ·»åŠ åˆ«åæ”¾åœ¨ä¸€èµ·æ“ä½œï¼Œæ‰€ä»¥éœ€è¦ä¼ å°±åˆ«åå’Œæ–°åˆ«åï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 12.åˆ é™¤ä¸€ä¸ªåˆ«ååå†æ·»åŠ ä¸€ä¸ª</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeAndCreateAlias</span><span class="params">(TransportClient client, String indexOld, String indexNew, String alias)</span> </span>&#123;</span><br><span class="line">        IndicesAdminClient indicesAdminClient = client.admin().indices();</span><br><span class="line">        IndicesAliasesResponse response = indicesAdminClient.prepareAliases().removeAlias(indexOld, alias)</span><br><span class="line">                .addAlias(indexNew, alias).get();</span><br><span class="line">        <span class="keyword">return</span> response.isAcknowledged();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="2-åˆ›å»ºæµ‹è¯•åŸºç±»è¿æ¥es"><a href="#2-åˆ›å»ºæµ‹è¯•åŸºç±»è¿æ¥es" class="headerlink" title="2. åˆ›å»ºæµ‹è¯•åŸºç±»è¿æ¥es"></a>2. åˆ›å»ºæµ‹è¯•åŸºç±»è¿æ¥es</h2><p>åˆ›å»ºtestç±»æµ‹è¯•è¿æ¥ã€æ’å…¥ã€æŸ¥è¯¢æ•°æ®æ˜¯å¦æ­£å¸¸ã€‚</p><p>è¿™é‡Œå¯ä»¥æ¨¡æ‹Ÿä¸€æ‰¹æ•°æ®æ’å…¥esï¼Œåé¢çš„åˆ†é¡µæ“ä½œå¯¹å¤§é‡æ•°æ®æ‰çœ‹å¾—å‡ºæ•ˆæœï¼Œæˆ‘è¿™é‡Œæœ‰çš„40ä¸‡æ•°æ®åŠ å…¥åˆ°esä¸­ï¼Œæ–¹ä¾¿åé¢çš„åˆ†é¡µæµ‹è¯•ã€‚</p><p>ElasticsearchTest.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.sun.controller.DateUtils;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.mapping.put.PutMappingRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.delete.DeleteResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.get.GetResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchType;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.update.UpdateResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.Client;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.Requests;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.TransportClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.transport.InetSocketTransportAddress;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.unit.TimeValue;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.xcontent.XContentFactory;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.*;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHits;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.elasticsearch.common.xcontent.XContentFactory.jsonBuilder;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç±»åŠŸèƒ½æè¿°:Elasticsearchçš„åŸºæœ¬æµ‹è¯•</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018/5/24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElasticsearchTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(ElasticsearchTest.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HOST = <span class="string">&quot;10.10.13.234&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** httpè¯·æ±‚çš„ç«¯å£æ˜¯9200ï¼Œå®¢æˆ·ç«¯æ˜¯9300 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> PORT = <span class="number">9300</span>;</span><br><span class="line"></span><br><span class="line">    Client client;</span><br><span class="line">    <span class="comment">/** ç´¢å¼•åº“å */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String index = <span class="string">&quot;my_index&quot;</span>;</span><br><span class="line">    <span class="comment">/** ç±»å‹åç§° */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String type = <span class="string">&quot;skuId&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String clusterName = <span class="string">&quot;my-application&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºmappingï¼Œæ³¨æ„ï¼šæ¯æ¬¡åªèƒ½åˆ›å»ºä¸€æ¬¡</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºmapping(field(&quot;indexAnalyzer&quot;,&quot;ik&quot;)è¯¥å­—æ®µåˆ†è¯IKç´¢å¼• ï¼›field(&quot;searchAnalyzer&quot;,&quot;ik&quot;)è¯¥å­—æ®µåˆ†è¯ikæŸ¥è¯¢ï¼›å…·ä½“åˆ†è¯æ’ä»¶è¯·çœ‹IKåˆ†è¯æ’ä»¶è¯´æ˜)</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºmapping(field(&quot;analyzer&quot;,&quot;ik&quot;)è¯¥å­—æ®µåˆ†è¯IKç´¢å¼• ï¼›field(&quot;index&quot;,&quot;analyzed&quot;)è¯¥å­—æ®µåˆ†è¯ikæŸ¥è¯¢ï¼›å…·ä½“åˆ†è¯æ’ä»¶è¯·çœ‹IKåˆ†è¯æ’ä»¶è¯´æ˜)2.xç‰ˆ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> indices ç´¢å¼•åç§°ï¼›</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> mappingType ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createMapping</span><span class="params">()</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String indices = <span class="string">&quot;jd_mall_v2&quot;</span>;</span><br><span class="line">        String mappingType = <span class="string">&quot;goods&quot;</span>;</span><br><span class="line"></span><br><span class="line">        Settings settings = Settings.settingsBuilder()</span><br><span class="line">                .put(<span class="string">&quot;cluster.name&quot;</span>, clusterName)</span><br><span class="line">                .put(<span class="string">&quot;client.transport.sniff&quot;</span>, <span class="keyword">true</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        Client client = TransportClient.builder().settings(settings).build()</span><br><span class="line">                .addTransportAddress(<span class="keyword">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</span><br><span class="line"></span><br><span class="line">        client.admin().indices().prepareCreate(indices).execute().actionGet();</span><br><span class="line">        <span class="keyword">new</span> XContentFactory();</span><br><span class="line">        XContentBuilder builder=XContentFactory.jsonBuilder()</span><br><span class="line">                .startObject()</span><br><span class="line">                .startObject(mappingType)</span><br><span class="line">                .startObject(<span class="string">&quot;properties&quot;</span>)</span><br><span class="line">                .startObject(<span class="string">&quot;name&quot;</span>).field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;string&quot;</span>).field(<span class="string">&quot;store&quot;</span>, <span class="string">&quot;yes&quot;</span>).field(<span class="string">&quot;analyzer&quot;</span>,<span class="string">&quot;ik&quot;</span>).field(<span class="string">&quot;index&quot;</span>,<span class="string">&quot;analyzed&quot;</span>).endObject()</span><br><span class="line">                .startObject(<span class="string">&quot;price&quot;</span>).field(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;long&quot;</span>).endObject()</span><br><span class="line">                .endObject()</span><br><span class="line">                .endObject()</span><br><span class="line">                .endObject();</span><br><span class="line">        PutMappingRequest mapping = Requests.putMappingRequest(indices).type(mappingType).source(builder);</span><br><span class="line"></span><br><span class="line">        client.admin().indices().putMapping(mapping).actionGet();</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1:é€šè¿‡ settingå¯¹è±¡æ¥æŒ‡å®šé›†ç¾¤é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * //æŒ‡å®šé›†ç¾¤åç§°</span></span><br><span class="line"><span class="comment">         * //å¯åŠ¨å—…æ¢åŠŸèƒ½</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Settings settings = Settings.settingsBuilder()</span><br><span class="line">                .put(<span class="string">&quot;cluster.name&quot;</span>, clusterName)</span><br><span class="line">                .put(<span class="string">&quot;client.transport.sniff&quot;</span>, <span class="keyword">true</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 2ï¼šåˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">         * é€šè¿‡settingæ¥åˆ›å»ºï¼Œè‹¥ä¸æŒ‡å®šåˆ™é»˜è®¤é“¾æ¥çš„é›†ç¾¤åä¸ºelasticsearch</span></span><br><span class="line"><span class="comment">         * é“¾æ¥ä½¿ç”¨tcpåè®®å³9300</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client = TransportClient.builder().settings(settings).build()</span><br><span class="line">                    .addTransportAddress(<span class="keyword">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</span><br><span class="line">            System.out.println(<span class="string">&quot;Elasticsearch connect info:&quot;</span> + client.toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*transportClient = new TransportClient(setting);</span></span><br><span class="line"><span class="comment">        TransportAddress transportAddress = new InetSocketTransportAddress(&quot;192.168.79.131&quot;, 9300);</span></span><br><span class="line"><span class="comment">        transportClient.addTransportAddresses(transportAddress);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 3ï¼šæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * æ³¨æ„æˆ‘çš„é›†ç¾¤ç»“æ„æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">         *   131çš„elasticsearch.ymlä¸­æŒ‡å®šä¸ºä¸»èŠ‚ç‚¹ä¸èƒ½å­˜å‚¨æ•°æ®ï¼Œ</span></span><br><span class="line"><span class="comment">         *   128çš„elasticsearch.ymlä¸­æŒ‡å®šä¸ä¸ºä¸»èŠ‚ç‚¹åªèƒ½å­˜å‚¨æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">         * æ‰€æœ‰æ§åˆ¶å°åªæ‰“å°äº†192.168.79.128,åªèƒ½è·å–æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">/*ImmutableList&lt;DiscoveryNode&gt; connectedNodes = client.connectedNodes();</span></span><br><span class="line"><span class="comment">        for(DiscoveryNode node : connectedNodes)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            System.out.println(node.getHostAddress());</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æµ‹è¯•Elasticsearchå®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Title</span>: test1</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> sunt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span> 2017å¹´11æœˆ22æ—¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UnknownHostException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;resource&quot;)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="comment">/*TransportClient client = new PreBuiltTransportClient(Settings.EMPTY).addTransportAddresses(</span></span><br><span class="line"><span class="comment">                new InetSocketTransportAddress(InetAddress.getByName(HOST),PORT));*/</span></span><br><span class="line">        TransportClient client = TransportClient.builder().build().addTransportAddress(<span class="keyword">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</span><br><span class="line"></span><br><span class="line">        logger.debug(<span class="string">&quot;Elasticsearch connect info:&quot;</span> + client.toString());</span><br><span class="line">        System.out.println(<span class="string">&quot;Elasticsearch connect info:&quot;</span> + client.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…³é—­å®¢æˆ·ç«¯</span></span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        String skuId = <span class="string">&quot;3724941&quot;</span>;</span><br><span class="line">        String skuName = <span class="string">&quot;åç››é¡¿è‹¹æœç¤¼ç›’ 8ä¸ªè£…ï¼ˆ4ä¸ªçº¢è›‡æœ+4ä¸ªé’è‹¹æœï¼‰å•æœé‡çº¦145g-180g æ–°é²œæ°´æœç¤¼ç›’&quot;</span>;</span><br><span class="line">        String skuPrice = <span class="string">&quot;4990&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–_idä¸º1çš„ç±»å‹</span></span><br><span class="line">        <span class="comment">/*GetResponse response1 = client.prepareGet(index, &quot;person&quot;, &quot;9&quot;).get();</span></span><br><span class="line"><span class="comment">        response1.getSourceAsMap();//è·å–å€¼è½¬æ¢æˆmap</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;æŸ¥è¯¢ä¸€æ¡æ•°æ®:&quot; + JSON.toJSON(response1.getSourceAsMap()));*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–åˆ†è¯</span></span><br><span class="line">        List&lt;String&gt; listAnalysis = getIkAnalyzeSearchTerms(<span class="string">&quot;è¿›å£æ°´æœ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//List&lt;Map&lt;String, Object&gt;&gt; resultList6 = testMultiQueryStringQuery(index, type, &quot;name&quot;, listAnalysis);</span></span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; resultList3 = testQueryStringQuery(index, type, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;è¿›å£æ°´æœ&quot;</span>);</span><br><span class="line">        <span class="comment">//List&lt;Map&lt;String, Object&gt;&gt; resultList4 = getDataByWildcard(index, type, &quot;name&quot;, &quot;*æ°´æœ*&quot;);</span></span><br><span class="line">        <span class="comment">//List&lt;Map&lt;String, Object&gt;&gt; resultList5 = getDataByMatch(index, type, &quot;name&quot;, &quot;è¿›å£ æ°´æœ&quot;);</span></span><br><span class="line">        <span class="comment">//List&lt;Map&lt;String, Object&gt;&gt; resultList = getQueryDataBySingleField(index, type, &quot;name&quot;, &quot;è¿›å£æ°´æœ&quot;);</span></span><br><span class="line">        <span class="comment">//List&lt;Map&lt;String, Object&gt;&gt; resultList2 = testSearchByPrefix(index, &quot;name&quot;, &quot;è¿›å£æ°´æœ&quot;);</span></span><br><span class="line">        <span class="comment">//System.out.println();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¢æŸ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCreate</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String[] skuIds = &#123;<span class="string">&quot;2246904&quot;</span>, <span class="string">&quot;2138027&quot;</span>, <span class="string">&quot;3724941&quot;</span>, <span class="string">&quot;5664705&quot;</span>, <span class="string">&quot;3711635&quot;</span>&#125;;</span><br><span class="line">        String[] skuNames = &#123;<span class="string">&quot;æœèŠ± çç å²© æ— åœŸæ ½åŸ¹åŸºè´¨ é¢—ç²’çŠ¶ ä¿æ¸©æ€§èƒ½å¥½ å›­è‰ºç”¨å“&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;è¿›å£åç››é¡¿çº¢è›‡æœ è‹¹æœ4ä¸ªè£… å•æœé‡çº¦180g æ–°é²œæ°´æœ&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;åç››é¡¿è‹¹æœç¤¼ç›’ 8ä¸ªè£…ï¼ˆ4ä¸ªçº¢è›‡æœ+4ä¸ªé’è‹¹æœï¼‰å•æœé‡çº¦145g-180g æ–°é²œæ°´æœç¤¼ç›’&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;æ–°ç–†é˜¿å…‹è‹å†°ç³–å¿ƒ çº¦5kg å•æœ200-250gï¼ˆ7Fresh ä¸“ä¾›ï¼‰&quot;</span>,</span><br><span class="line">                            <span class="string">&quot;æ±Ÿè¥¿åç‰Œ æ¨æ°ç²¾å“è„æ©™ 5kgè£… é“‚é‡‘æœ æ°´æœæ©™å­ç¤¼ç›’ 2ç§åŒ…è£…éšæœºå‘è´§&quot;</span>&#125;;</span><br><span class="line">        String[] skuPrices = &#123;<span class="string">&quot;500&quot;</span>, <span class="string">&quot;3800&quot;</span>, <span class="string">&quot;4990&quot;</span>, <span class="string">&quot;8500&quot;</span>, <span class="string">&quot;5880&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;skuIds.length; i++) &#123;</span><br><span class="line">            String skuId = skuIds[i];</span><br><span class="line">            String skuName = skuNames[i];</span><br><span class="line">            String skuPrice = skuPrices[i];</span><br><span class="line"></span><br><span class="line">            String jsonStr = <span class="string">&quot;&#123;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;\&quot;skuId\&quot;:\&quot;&quot;</span>+skuId+<span class="string">&quot;\&quot;,&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;\&quot;skuName\&quot;:\&quot;&quot;</span>+skuName+<span class="string">&quot;\&quot;,&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;\&quot;skuPrice\&quot;:\&quot;&quot;</span>+skuPrice+<span class="string">&quot;\&quot;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//å‚æ•°è¯´æ˜ï¼š ç´¢å¼•ï¼Œç±»å‹ ï¼Œ_idï¼›//setSourceå¯ä»¥ä¼ ä»¥ä¸Šmap string  byte[] å‡ ç§æ–¹å¼</span></span><br><span class="line">            IndexResponse response = client.prepareIndex(index, type, skuId)</span><br><span class="line">                    .setSource(jsonStr,XContentType.JSON)</span><br><span class="line">                    .get();</span><br><span class="line">            <span class="keyword">boolean</span> created = response.isCreated();</span><br><span class="line">            System.out.println(<span class="string">&quot;åˆ›å»ºä¸€æ¡è®°å½•:&quot;</span> + created);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å–_idä¸º1çš„ç±»å‹</span></span><br><span class="line">            GetResponse response1 = client.prepareGet(index, type, skuId).get();</span><br><span class="line">            response1.getSourceAsMap();<span class="comment">//è·å–å€¼è½¬æ¢æˆmap</span></span><br><span class="line">            System.out.println(<span class="string">&quot;æŸ¥è¯¢ä¸€æ¡æ•°æ®:&quot;</span> + JSON.toJSON(response1.getSourceAsMap()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ æŸ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String skuId = <span class="string">&quot;3724941&quot;</span>;</span><br><span class="line">        String skuName = <span class="string">&quot;åç››é¡¿è‹¹æœç¤¼ç›’ 8ä¸ªè£…ï¼ˆ4ä¸ªçº¢è›‡æœ+4ä¸ªé’è‹¹æœï¼‰å•æœé‡çº¦145g-180g æ–°é²œæ°´æœç¤¼ç›’&quot;</span>;</span><br><span class="line">        String skuPrice = <span class="string">&quot;4990&quot;</span>;</span><br><span class="line">        String skuImage = <span class="string">&quot;jfs/t16450/249/461724533/219792/7f204d7a/5a321ecbN4526f7d3.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ é™¤_idä¸º1çš„ç±»å‹</span></span><br><span class="line">        DeleteResponse response2 = client.prepareDelete(index, type, skuId).get();</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤ä¸€æ¡æ•°æ®ï¼š&quot;</span> + response2.isFound());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–_idä¸º1çš„ç±»å‹</span></span><br><span class="line">        GetResponse response1 = client.prepareGet(index, type, skuId).get();</span><br><span class="line">        response1.getSourceAsMap();<span class="comment">//è·å–å€¼è½¬æ¢æˆmap</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æŸ¥è¯¢ä¸€æ¡æ•°æ®:&quot;</span> + JSON.toJSON(response1.getSourceAsMap()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ”¹æŸ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String skuId = <span class="string">&quot;3724941&quot;</span>;</span><br><span class="line">        String skuName = <span class="string">&quot;åç››é¡¿è‹¹æœç¤¼ç›’ 8ä¸ªè£…ï¼ˆ4ä¸ªçº¢è›‡æœ+4ä¸ªé’è‹¹æœï¼‰å•æœé‡çº¦145g-180g æ–°é²œæ°´æœç¤¼ç›’&quot;</span>;</span><br><span class="line">        String skuPrice = <span class="string">&quot;4990&quot;</span>;</span><br><span class="line">        String skuName2 = <span class="string">&quot;ååœ£ é™•è¥¿ç²¾å“çº¢å¯Œå£«è‹¹æœ 12ä¸ªè£… æœå¾„75mm çº¦2.1kg æ–°é²œæ°´æœ&quot;</span>;</span><br><span class="line">        <span class="comment">//æ›´æ–°</span></span><br><span class="line">        UpdateResponse updateResponse = client.prepareUpdate(index, type, skuId).setDoc(jsonBuilder()</span><br><span class="line">                .startObject()</span><br><span class="line">                .field(<span class="string">&quot;name&quot;</span>, skuName2)</span><br><span class="line">                .endObject())</span><br><span class="line">                .get();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ›´æ–°ä¸€æ¡æ•°æ®:&quot;</span> + updateResponse.isCreated());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–_idä¸º1çš„ç±»å‹</span></span><br><span class="line">        GetResponse response1 = client.prepareGet(index, type, skuId).get();</span><br><span class="line">        response1.getSourceAsMap();<span class="comment">//è·å–å€¼è½¬æ¢æˆmap</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æŸ¥è¯¢ä¸€æ¡æ•°æ®:&quot;</span> + JSON.toJSON(response1.getSourceAsMap()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†å¯¹è±¡é€šè¿‡jackson.databindè½¬æ¢æˆbyte[]</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ä¸€ä¸‹dateç±»å‹éœ€è¦æ ¼å¼åŒ–å¤„ç†  é»˜è®¤æ˜¯ æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">byte</span>[] convertByteArray(Object obj) &#123;</span><br><span class="line">        <span class="comment">// create once, reuse</span></span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] json = mapper.writeValueAsBytes(obj);</span><br><span class="line">            <span class="keyword">return</span> json;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†å¯¹è±¡é€šè¿‡JSONtoStringè½¬æ¢æˆJSONå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨fastjson æ ¼å¼åŒ–æ³¨è§£  åœ¨å±æ€§ä¸ŠåŠ å…¥ <span class="doctag">@JSONField</span>(format=&quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">jsonStr</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*****************************/</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * æ ¹æ®æ–‡æ¡£åã€å­—æ®µåã€å­—æ®µå€¼æŸ¥è¯¢æŸä¸€æ¡è®°å½•çš„è¯¦ç»†ä¿¡æ¯ï¼›queryæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type  æ–‡æ¡£åï¼Œç›¸å½“äºoracleä¸­çš„è¡¨åï¼Œä¾‹å¦‚ï¼šql_xzï¼›</span></span><br><span class="line"><span class="comment">            * <span class="doctag">@param</span> key å­—æ®µåï¼Œä¾‹å¦‚ï¼šbdcqzh</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value  å­—æ®µå€¼ï¼Œå¦‚ï¼šâ€œâ€</span></span><br><span class="line"><span class="comment">            * <span class="doctag">@return</span>  List</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Lixin</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getQueryDataBySingleField</span><span class="params">(String index, String type, String key, String value)</span></span>&#123;</span><br><span class="line">        <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">        QueryBuilder qb = QueryBuilders.termQuery(key, value);</span><br><span class="line">        SearchResponse response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(qb)</span><br><span class="line">                .setFrom(<span class="number">0</span>).setSize(<span class="number">10000</span>).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                .execute()</span><br><span class="line">                .actionGet();</span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤šæ¡ä»¶  æ–‡æ¡£åã€å­—æ®µåã€å­—æ®µå€¼ï¼ŒæŸ¥è¯¢æŸä¸€æ¡è®°å½•çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type æ–‡æ¡£åï¼Œç›¸å½“äºoracleä¸­çš„è¡¨åï¼Œä¾‹å¦‚ï¼šql_xz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map å­—æ®µåï¼šå­—æ®µå€¼ çš„map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> List</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Lixin</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getBoolDataByMuchField</span><span class="params">(String index, String type, Map&lt;String,String&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">        <span class="keyword">for</span> (String in : map.keySet()) &#123;</span><br><span class="line">            <span class="comment">//map.keySet()è¿”å›çš„æ˜¯æ‰€æœ‰keyçš„å€¼</span></span><br><span class="line">            String str = map.get(in);<span class="comment">//å¾—åˆ°æ¯ä¸ªkeyå¤šå¯¹ç”¨valueçš„å€¼</span></span><br><span class="line">            boolQueryBuilder.must(QueryBuilders.termQuery(in,str));</span><br><span class="line">        &#125;</span><br><span class="line">        SearchResponse response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(boolQueryBuilder)</span><br><span class="line">                .setFrom(<span class="number">0</span>).setSize(<span class="number">10000</span>).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                .execute()</span><br><span class="line">                .actionGet();</span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å•æ¡ä»¶ é€šé…ç¬¦æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type æ–‡æ¡£åï¼Œç›¸å½“äºoracleä¸­çš„è¡¨åï¼Œä¾‹å¦‚ï¼šql_xz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key å­—æ®µåï¼Œä¾‹å¦‚ï¼šbdcqzh</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å­—æ®µåæ¨¡ç³Šå€¼ï¼šå¦‚ *123* ;?123*;?123?;*123?;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> List</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Lixin</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getDataByWildcard</span><span class="params">(String index, String type, String key, String value)</span></span>&#123;</span><br><span class="line">        <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">        WildcardQueryBuilder wBuilder = QueryBuilders.wildcardQuery(key, value);</span><br><span class="line">        SearchResponse response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(wBuilder)</span><br><span class="line">                .setFrom(<span class="number">0</span>).setSize(<span class="number">10000</span>).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                .execute()</span><br><span class="line">                .actionGet();</span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤šæ¡ä»¶ é€šé…ç¬¦æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type  type æ–‡æ¡£åï¼Œç›¸å½“äºoracleä¸­çš„è¡¨åï¼Œä¾‹å¦‚ï¼šql_xz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map   åŒ…å«key:value æ¨¡ç³Šå€¼é”®å€¼å¯¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> List</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Lixin</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getDataByMuchWildcard</span><span class="params">(String index, String type, Map&lt;String,String&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">        <span class="keyword">for</span> (String in : map.keySet()) &#123;</span><br><span class="line">            <span class="comment">//map.keySet()è¿”å›çš„æ˜¯æ‰€æœ‰keyçš„å€¼</span></span><br><span class="line">            String str = map.get(in);<span class="comment">//å¾—åˆ°æ¯ä¸ªkeyå¤šå¯¹ç”¨valueçš„å€¼</span></span><br><span class="line">            boolQueryBuilder.must(QueryBuilders.wildcardQuery(in,str));</span><br><span class="line">        &#125;</span><br><span class="line">        SearchResponse response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(boolQueryBuilder)</span><br><span class="line">                .setFrom(<span class="number">0</span>).setSize(<span class="number">10000</span>).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                .execute()</span><br><span class="line">                .actionGet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å•æ¡ä»¶ æ¨¡ç³Šæ‹†åˆ†æŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type æ–‡æ¡£åï¼Œç›¸å½“äºoracleä¸­çš„è¡¨åï¼Œä¾‹å¦‚ï¼šql_xz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key å­—æ®µåï¼Œä¾‹å¦‚ï¼šbdcqzh</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å­—æ®µåæ¨¡ç³Šå€¼ï¼šå¦‚ *123* ;?123*;?123?;*123?;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> List</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Lixin</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getDataByMatch</span><span class="params">(String index, String type, String key, String value)</span></span>&#123;</span><br><span class="line">        <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">        MatchQueryBuilder mBuilder = QueryBuilders.matchQuery(key, value);</span><br><span class="line">        SearchResponse response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(mBuilder)</span><br><span class="line">                .setFrom(<span class="number">0</span>).setSize(<span class="number">10000</span>).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                .execute()</span><br><span class="line">                .actionGet();</span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å•æ¡ä»¶ ä¸­æ–‡åˆ†è¯æ¨¡ç³ŠæŸ¥è¯¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type æ–‡æ¡£åï¼Œç›¸å½“äºoracleä¸­çš„è¡¨åï¼Œä¾‹å¦‚ï¼šql_xz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key å­—æ®µåï¼Œä¾‹å¦‚ï¼šbdcqzh</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value å­—æ®µåæ¨¡ç³Šå€¼ï¼šå¦‚ *123* ;?123*;?123?;*123?;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> List</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> Lixin</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">getDataByPrefix</span><span class="params">(String index, String type, String key, String value)</span></span>&#123;</span><br><span class="line">        <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">        PrefixQueryBuilder pBuilder = QueryBuilders.prefixQuery(key, value);</span><br><span class="line">        SearchResponse response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(pBuilder)</span><br><span class="line">                .setFrom(<span class="number">0</span>).setSize(<span class="number">10000</span>).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                .execute()</span><br><span class="line">                .actionGet();</span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸­æ–‡åˆ†è¯çš„æ“ä½œ</span></span><br><span class="line"><span class="comment">     * 1.æŸ¥è¯¢ä»¥&quot;ä¸­&quot;å¼€å¤´çš„æ•°æ®ï¼Œæœ‰ä¸¤æ¡</span></span><br><span class="line"><span class="comment">     * 2.æŸ¥è¯¢ä»¥â€œä¸­å›½â€å¼€å¤´çš„æ•°æ®ï¼Œæœ‰0æ¡</span></span><br><span class="line"><span class="comment">     * 3.æŸ¥è¯¢åŒ…å«â€œçƒ‚â€çš„æ•°æ®ï¼Œæœ‰1æ¡</span></span><br><span class="line"><span class="comment">     * 4.æŸ¥è¯¢åŒ…å«â€œçƒ‚æ‘Šå­â€çš„æ•°æ®ï¼Œæœ‰0æ¡</span></span><br><span class="line"><span class="comment">     * åˆ†è¯ï¼š</span></span><br><span class="line"><span class="comment">     *      ä¸ºä»€ä¹ˆæˆ‘ä»¬æœç´¢China is the greatest country~</span></span><br><span class="line"><span class="comment">     *                 ä¸­æ–‡ï¼šä¸­å›½æœ€ç‰›é€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *                 Ã—Ã—Ã—</span></span><br><span class="line"><span class="comment">     *                      ä¸­å</span></span><br><span class="line"><span class="comment">     *                      äººæ°‘</span></span><br><span class="line"><span class="comment">     *                      å…±å’Œå›½</span></span><br><span class="line"><span class="comment">     *                      ä¸­åäººæ°‘</span></span><br><span class="line"><span class="comment">     *                      äººæ°‘å…±å’Œå›½</span></span><br><span class="line"><span class="comment">     *                      åäºº</span></span><br><span class="line"><span class="comment">     *                      å…±å’Œ</span></span><br><span class="line"><span class="comment">     *      ç‰¹æ®Šçš„ä¸­æ–‡åˆ†è¯æ³•ï¼š</span></span><br><span class="line"><span class="comment">     *          åº–ä¸è§£ç‰›</span></span><br><span class="line"><span class="comment">     *          IKåˆ†è¯æ³•</span></span><br><span class="line"><span class="comment">     *          æœç‹—åˆ†è¯æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">testSearchByPrefix</span><span class="params">(String index, String key, String value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// åœ¨prepareSearch()çš„å‚æ•°ä¸ºç´¢å¼•åº“åˆ—è¡¨ï¼Œæ„ä¸ºè¦ä»å“ªäº›ç´¢å¼•åº“ä¸­è¿›è¡ŒæŸ¥è¯¢</span></span><br><span class="line">        SearchResponse response = client.prepareSearch(index)</span><br><span class="line">                .setSearchType(SearchType.DEFAULT)  <span class="comment">// è®¾ç½®æŸ¥è¯¢ç±»å‹ï¼Œæœ‰QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH</span></span><br><span class="line">                <span class="comment">//.setSearchType(SearchType.DEFAULT)  // è®¾ç½®æŸ¥è¯¢ç±»å‹ï¼Œæœ‰QUERY_AND_FETCH  QUERY_THEN_FETCH  DFS_QUERY_AND_FETCH  DFS_QUERY_THEN_FETCH</span></span><br><span class="line">                <span class="comment">//.setQuery(QueryBuilders.prefixQuery(&quot;content&quot;, &quot;çƒ‚æ‘Šå­&quot;))// è®¾ç½®ç›¸åº”çš„queryï¼Œç”¨äºæ£€ç´¢ï¼ŒtermQueryçš„å‚æ•°è¯´æ˜ï¼šnameæ˜¯docä¸­çš„å…·ä½“çš„fieldï¼Œvalueå°±æ˜¯è¦æ‰¾çš„å…·ä½“çš„å€¼</span></span><br><span class="line"><span class="comment">//                .setQuery(QueryBuilders.regexpQuery(&quot;content&quot;, &quot;.*çƒ‚æ‘Šå­.*&quot;))</span></span><br><span class="line">                .setQuery(QueryBuilders.prefixQuery(key, value))</span><br><span class="line">                .get();</span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">testFuzzyQuery</span><span class="params">(String index, String type, String key, String value)</span></span>&#123;</span><br><span class="line">        <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">        FuzzyQueryBuilder fBuilder = QueryBuilders.fuzzyQuery(key, value);</span><br><span class="line">        SearchResponse response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(fBuilder)</span><br><span class="line">                .setFrom(<span class="number">0</span>).setSize(<span class="number">10000</span>).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                .execute()</span><br><span class="line">                .actionGet();</span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">testQueryStringQuery</span><span class="params">(String index, String type, String key, String value)</span></span>&#123;</span><br><span class="line">        <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">        QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);</span><br><span class="line">        SearchResponse response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(fBuilder)</span><br><span class="line">                .setFrom(<span class="number">0</span>).setSize(<span class="number">10000</span>).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                .execute()</span><br><span class="line">                .actionGet();</span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">testMultiQueryStringQuery</span><span class="params">(String index, String type, String key, List&lt;String&gt; listAnalysis)</span></span>&#123;</span><br><span class="line">        <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">        <span class="keyword">for</span> (String term : listAnalysis) &#123;</span><br><span class="line">            boolQueryBuilder.should(QueryBuilders.queryStringQuery(term).field(key));</span><br><span class="line">            <span class="comment">//è¿™é‡Œå¯ä»¥ç”¨must æˆ–è€… should è§†æƒ…å†µè€Œå®š</span></span><br><span class="line">        &#125;</span><br><span class="line">        SearchResponse response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(boolQueryBuilder)</span><br><span class="line">                .setFrom(<span class="number">0</span>).setSize(<span class="number">10000</span>).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                .execute()</span><br><span class="line">                .actionGet();</span><br><span class="line">        <span class="keyword">return</span> responseToList(client,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æŸ¥è¯¢åè·å¾—çš„responseè½¬æˆlist</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> client</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">responseToList</span><span class="params">(Client client, SearchResponse response)</span></span>&#123;</span><br><span class="line">        SearchHits hits = response.getHits();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;Map&lt;String,Object&gt;&gt;();</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.getHits().length; i++) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; map = hits.getAt(i).getSource();</span><br><span class="line">            System.out.println(map.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">            list.add(map);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line">        <span class="comment">//client.close();</span></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è°ƒç”¨ ES è·å– IK åˆ†è¯åç»“æœ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> searchContent</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;String&gt; <span class="title">getIkAnalyzeSearchTerms</span><span class="params">(String searchContent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨ IK åˆ†è¯åˆ†è¯</span></span><br><span class="line">        AnalyzeRequestBuilder ikRequest = <span class="keyword">new</span> AnalyzeRequestBuilder(client,</span><br><span class="line">                AnalyzeAction.INSTANCE, index, searchContent);</span><br><span class="line">        <span class="comment">//ikRequest.setAnalyzer(&quot;ik&quot;);</span></span><br><span class="line">        ikRequest.setTokenizer(<span class="string">&quot;ik&quot;</span>);</span><br><span class="line">        List&lt;AnalyzeResponse.AnalyzeToken&gt; ikTokenList = ikRequest.execute().actionGet().getTokens();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾ªç¯èµ‹å€¼</span></span><br><span class="line">        List&lt;String&gt; searchTermList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//ikTokenList.forEach(ikToken -&gt; &#123; searchTermList.add(ikToken.getTerm()); &#125;);</span></span><br><span class="line">        <span class="keyword">for</span> (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) &#123;</span><br><span class="line">            System.out.println(ikToken.getTerm());</span><br><span class="line">            searchTermList.add(ikToken.getTerm());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> searchTermList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç„¶åå°±æ˜¯åˆ›å»ºä¸¤ä¸ªæŸ¥è¯¢è¿‡ç¨‹äº† ï¼Œä¸‹é¢æ˜¯from-sizeåˆ†é¡µçš„æ‰§è¡Œä»£ç ï¼š</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFromSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;from size æ¨¡å¼å¯åŠ¨ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> begin = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">long</span> count = client.prepareCount(index).setTypes(type).execute()</span><br><span class="line">                .actionGet().getCount();</span><br><span class="line">        <span class="comment">//QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);</span></span><br><span class="line">        SearchRequestBuilder requestBuilder = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                .setQuery(QueryBuilders.queryStringQuery(<span class="string">&quot;è¿›å£æ°´æœ&quot;</span>).field(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>,sum=<span class="number">0</span>; sum&lt;count; i++) &#123;</span><br><span class="line">            SearchResponse response = requestBuilder.setFrom(i).setSize(<span class="number">3</span>).execute().actionGet();</span><br><span class="line">            sum += response.getHits().hits().length;</span><br><span class="line">            responseToList(client,response);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ€»é‡&quot;</span>+count+<span class="string">&quot;, å·²ç»æŸ¥åˆ°&quot;</span>+sum);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;elapsed&lt;&quot;</span>+(System.currentTimeMillis()-begin)+<span class="string">&quot;&gt;ms.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹é¢æ˜¯scrollåˆ†é¡µçš„æ‰§è¡Œä»£ç ï¼Œæ³¨æ„å•Šï¼scrollé‡Œé¢çš„sizeæ˜¯ç›¸å¯¹äºæ¯ä¸ªåˆ†ç‰‡æ¥è¯´çš„ï¼Œ</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥å®é™…è¿”å›çš„æ•°é‡æ˜¯ï¼šåˆ†ç‰‡çš„æ•°é‡*size</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testScroll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//String index, String type,String key,String value</span></span><br><span class="line">        System.out.println(<span class="string">&quot;scroll æ¨¡å¼å¯åŠ¨ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">long</span> begin = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//QueryBuilder qBuilder = QueryBuilders.queryStringQuery(value).field(key);</span></span><br><span class="line">        <span class="comment">//è·å–Clientå¯¹è±¡,è®¾ç½®ç´¢å¼•åç§°,æœç´¢ç±»å‹(SearchType.SCAN),æœç´¢æ•°é‡,å‘é€è¯·æ±‚</span></span><br><span class="line">        SearchResponse scrollResponse = client.prepareSearch(index)</span><br><span class="line">                .setTypes(type)</span><br><span class="line">                .setQuery(QueryBuilders.queryStringQuery(<span class="string">&quot;è¿›å£æ°´æœ&quot;</span>).field(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">                .setSearchType(SearchType.SCAN).setSize(<span class="number">3</span>).setScroll(TimeValue.timeValueMinutes(<span class="number">1</span>))</span><br><span class="line">                .execute().actionGet();</span><br><span class="line">        <span class="comment">//æ³¨æ„:é¦–æ¬¡æœç´¢å¹¶ä¸åŒ…å«æ•°æ®ï¼Œç¬¬ä¸€æ¬¡ä¸è¿”å›æ•°æ®ï¼Œè·å–æ€»æ•°é‡</span></span><br><span class="line">        <span class="keyword">long</span> count = scrollResponse.getHits().getTotalHits();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>,sum=<span class="number">0</span>; sum&lt;count; i++) &#123;</span><br><span class="line">            scrollResponse = client.prepareSearchScroll(scrollResponse.getScrollId())</span><br><span class="line">                    .setScroll(TimeValue.timeValueMinutes(<span class="number">8</span>)).execute().actionGet();</span><br><span class="line">            sum += scrollResponse.getHits().hits().length;</span><br><span class="line">            responseToList(client,scrollResponse);</span><br><span class="line">            System.out.println(<span class="string">&quot;æ€»é‡&quot;</span>+count+<span class="string">&quot;, å·²ç»æŸ¥åˆ°&quot;</span>+sum);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;elapsed&lt;&quot;</span>+(System.currentTimeMillis()-begin)+<span class="string">&quot;&gt;ms.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-åˆ†é¡µä»£ç "><a href="#3-åˆ†é¡µä»£ç " class="headerlink" title="3. åˆ†é¡µä»£ç "></a>3. åˆ†é¡µä»£ç </h2><p>åˆ›å»ºTestControllerç±»ï¼Œåœ¨ä¸Šè¿°æµ‹è¯•éƒ½æ— é—®é¢˜ä¹‹åï¼Œå†è¿›è¡Œä¸‹é¢çš„åˆ†é¡µæ“ä½œã€‚</p><p>TestController.javaï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sun.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchScrollRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHit;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeAction;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeRequestBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.admin.indices.analyze.AnalyzeResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchResponse;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.search.SearchType;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.Client;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.transport.TransportClient;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.settings.Settings;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.transport.InetSocketTransportAddress;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.common.unit.TimeValue;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.index.query.QueryBuilders;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.SearchHits;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.search.sort.SortOrder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicLong;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç±»åŠŸèƒ½æè¿°:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liu</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018/2/22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="keyword">this</span>.getClass());</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String HOST = <span class="string">&quot;10.10.13.234&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** httpè¯·æ±‚çš„ç«¯å£æ˜¯9200ï¼Œå®¢æˆ·ç«¯æ˜¯9300 */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> PORT = <span class="number">9300</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** ç´¢å¼•åº“å */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String index = <span class="string">&quot;my_index&quot;</span>;</span><br><span class="line">    <span class="comment">/** ç±»å‹åç§° */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String type = <span class="string">&quot;skuId&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String clusterName = <span class="string">&quot;my-application&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String template = <span class="string">&quot;Hello, %s!&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicLong counter = <span class="keyword">new</span> AtomicLong();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/greeting&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Greeting <span class="title">greeting</span><span class="params">(<span class="meta">@RequestParam(value=&quot;name&quot;, defaultValue=&quot;World&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Greeting(counter.incrementAndGet(),</span><br><span class="line">                String.format(template, name));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getTotalRows</span><span class="params">(String keyword, TransportClient client)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> totalRows;</span><br><span class="line">        BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">        boolQueryBuilder.must(QueryBuilders.termQuery(<span class="string">&quot;isShow&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                .must(QueryBuilders.termQuery(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                .must(QueryBuilders.termQuery(<span class="string">&quot;deleteStatus&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                .must(QueryBuilders.termQuery(<span class="string">&quot;salesStatus&quot;</span>, <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span> (keyword == <span class="keyword">null</span> || keyword.isEmpty()) &#123;</span><br><span class="line">            totalRows = client.prepareCount(index).setTypes(type)</span><br><span class="line">                    .execute()</span><br><span class="line">                    .actionGet().getCount();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            QueryBuilder fBuilder = QueryBuilders.queryStringQuery(keyword).field(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            boolQueryBuilder.must(fBuilder);</span><br><span class="line">            totalRows = client.prepareCount(index).setTypes(type)</span><br><span class="line">                    .setQuery(boolQueryBuilder)</span><br><span class="line">                    .execute()</span><br><span class="line">                    .actionGet().getCount();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> totalRows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/searchFromSize&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">testSearchByFromSize</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> Integer pageIndex, <span class="meta">@RequestParam(required = false)</span> Integer pageSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="meta">@RequestParam(required = false)</span> String keyword, <span class="meta">@RequestParam(required = false)</span> String priceSort)</span></span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;op&lt;testSearchByFromSize&gt; pageIndex&lt;&quot;</span>+pageIndex+<span class="string">&quot;&gt; pageSize&lt;&quot;</span>+pageSize+<span class="string">&quot;&gt; &quot;</span> +</span><br><span class="line">                <span class="string">&quot;keyword&lt;&quot;</span>+keyword+<span class="string">&quot;&gt; priceSort&lt;&quot;</span>+priceSort+<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">        JSONObject result = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        JSONObject goodsResult = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        <span class="keyword">long</span> begin = System.currentTimeMillis();</span><br><span class="line">        TransportClient client = getClient();</span><br><span class="line">        <span class="keyword">long</span> totalRows = getTotalRows(keyword, client);</span><br><span class="line">        getIkAnalyzeSearchTerms(client, keyword);</span><br><span class="line">        <span class="keyword">int</span> from = (pageIndex - <span class="number">1</span>) * pageSize;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; goodsExportList = testQueryStringQueryFromSize(client, index, type, <span class="string">&quot;name&quot;</span>,</span><br><span class="line">                keyword, from, pageSize, priceSort);</span><br><span class="line">        goodsResult.put( <span class="string">&quot;goods&quot;</span>, goodsExportList );</span><br><span class="line">        goodsResult.put( <span class="string">&quot;pageIndex&quot;</span>, pageIndex );</span><br><span class="line">        goodsResult.put( <span class="string">&quot;pageSize&quot;</span>, pageSize );</span><br><span class="line">        goodsResult.put( <span class="string">&quot;totalRows&quot;</span>, totalRows );</span><br><span class="line"></span><br><span class="line">        result.put( <span class="string">&quot;success&quot;</span>, <span class="keyword">true</span> );</span><br><span class="line">        result.put( <span class="string">&quot;resultMessage&quot;</span>, <span class="string">&quot;&quot;</span> );</span><br><span class="line">        result.put( <span class="string">&quot;resultCode&quot;</span>, <span class="string">&quot;0000&quot;</span> );</span><br><span class="line">        result.put( <span class="string">&quot;result&quot;</span>, goodsResult );</span><br><span class="line">        System.out.println(<span class="string">&quot;---op&lt;searchFromSize&gt; elapsed&lt;&quot;</span>+(System.currentTimeMillis()-begin)+<span class="string">&quot;&gt;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String scrollIdTemp = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/searchScroll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">testSearchByScroll</span><span class="params">(<span class="meta">@RequestParam(required = false)</span> String scrollId, <span class="meta">@RequestParam(required = false)</span> Integer pageSize,</span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="meta">@RequestParam(required = false)</span> String keyword, <span class="meta">@RequestParam(required = false)</span> String priceSort)</span></span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;op&lt;testSearchByScroll&gt; scrollId&lt;&quot;</span>+scrollId+<span class="string">&quot;&gt; pageSize&lt;&quot;</span>+pageSize+<span class="string">&quot;&gt; &quot;</span> +</span><br><span class="line">                <span class="string">&quot;keyword&lt;&quot;</span>+keyword+<span class="string">&quot;&gt; priceSort&lt;&quot;</span>+priceSort+<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">        JSONObject result = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        JSONObject goodsResult = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        <span class="keyword">long</span> begin = System.currentTimeMillis();</span><br><span class="line">        scrollIdTemp = scrollId;</span><br><span class="line">        TransportClient client = getClient();</span><br><span class="line">        <span class="keyword">long</span> totalRows = getTotalRows(keyword, client);</span><br><span class="line">        getIkAnalyzeSearchTerms(client, keyword);</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; goodsExportList = testQueryStringQueryScroll(client, index, type, <span class="string">&quot;name&quot;</span>,</span><br><span class="line">                keyword, scrollIdTemp, pageSize, priceSort);</span><br><span class="line">        client.close();</span><br><span class="line"></span><br><span class="line">        goodsResult.put( <span class="string">&quot;goods&quot;</span>, goodsExportList );</span><br><span class="line">        goodsResult.put( <span class="string">&quot;scrollId&quot;</span>, scrollIdTemp );</span><br><span class="line">        goodsResult.put( <span class="string">&quot;pageSize&quot;</span>, pageSize );</span><br><span class="line">        goodsResult.put( <span class="string">&quot;totalRows&quot;</span>, totalRows );</span><br><span class="line"></span><br><span class="line">        result.put( <span class="string">&quot;success&quot;</span>, <span class="keyword">true</span> );</span><br><span class="line">        result.put( <span class="string">&quot;resultMessage&quot;</span>, <span class="string">&quot;&quot;</span> );</span><br><span class="line">        result.put( <span class="string">&quot;resultCode&quot;</span>, <span class="string">&quot;0000&quot;</span> );</span><br><span class="line">        result.put( <span class="string">&quot;result&quot;</span>, goodsResult );</span><br><span class="line">        System.out.println(<span class="string">&quot;---op&lt;searchScroll&gt; elapsed&lt;&quot;</span>+(System.currentTimeMillis()-begin)+<span class="string">&quot;&gt;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç„¶åå°±æ˜¯åˆ›å»ºä¸¤ä¸ªæŸ¥è¯¢è¿‡ç¨‹äº† ï¼Œä¸‹é¢æ˜¯from-sizeåˆ†é¡µçš„æ‰§è¡Œä»£ç ï¼š</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">testQueryStringQueryFromSize</span><span class="params">(TransportClient client, String index, String type, String key,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     String value, Integer pageIndex, Integer pageSize ,String priceSort)</span></span>&#123;</span><br><span class="line">        SearchResponse response = <span class="keyword">null</span>;</span><br><span class="line">        List resultList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">            <span class="keyword">if</span> (value == <span class="keyword">null</span> || value.isEmpty()) &#123;</span><br><span class="line">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class="string">&quot;isShow&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;deleteStatus&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;salesStatus&quot;</span>, <span class="number">1</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);</span><br><span class="line">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class="string">&quot;isShow&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;deleteStatus&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;salesStatus&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(fBuilder);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (priceSort == <span class="keyword">null</span> || priceSort.isEmpty()) &#123;</span><br><span class="line">                response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                        .setQuery(boolQueryBuilder)</span><br><span class="line">                        .setFrom(pageIndex).setSize(pageSize).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                        .execute()</span><br><span class="line">                        .actionGet();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> ((<span class="string">&quot;desc&quot;</span>).equals(priceSort)) &#123;</span><br><span class="line">                    response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                            .setQuery(boolQueryBuilder)</span><br><span class="line">                            .setFrom(pageIndex).setSize(pageSize).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                            .addSort(<span class="string">&quot;price&quot;</span>, SortOrder.DESC)</span><br><span class="line">                            .execute()</span><br><span class="line">                            .actionGet();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    response = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                            .setQuery(boolQueryBuilder)</span><br><span class="line">                            .setFrom(pageIndex).setSize(pageSize).setExplain(<span class="keyword">true</span>)</span><br><span class="line">                            .addSort(<span class="string">&quot;price&quot;</span>, SortOrder.ASC)</span><br><span class="line">                            .execute()</span><br><span class="line">                            .actionGet();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            resultList = responseToList(response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultList;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹é¢æ˜¯scrollåˆ†é¡µçš„æ‰§è¡Œä»£ç ï¼Œæ³¨æ„å•Šï¼scrollé‡Œé¢çš„sizeæ˜¯ç›¸å¯¹äºæ¯ä¸ªåˆ†ç‰‡æ¥è¯´çš„ï¼Œ</span></span><br><span class="line"><span class="comment">     * æ‰€ä»¥å®é™…è¿”å›çš„æ•°é‡æ˜¯ï¼šåˆ†ç‰‡çš„æ•°é‡*size</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Scroll-Scan æ–¹å¼ä¸æ™®é€š scroll æœ‰å‡ ç‚¹ä¸åŒï¼š</span></span><br><span class="line"><span class="comment">     * 1.Scroll-Scan ç»“æœæ²¡æœ‰æ’åºï¼ŒæŒ‰ index é¡ºåºè¿”å›ï¼Œæ²¡æœ‰æ’åºï¼Œå¯ä»¥æé«˜å–æ•°æ®æ€§èƒ½ã€‚</span></span><br><span class="line"><span class="comment">     * 2.åˆå§‹åŒ–æ—¶åªè¿”å› _scroll_idï¼Œæ²¡æœ‰å…·ä½“çš„ hits ç»“æœã€‚</span></span><br><span class="line"><span class="comment">     * 3.size æ§åˆ¶çš„æ˜¯æ¯ä¸ªåˆ†ç‰‡çš„è¿”å›çš„æ•°æ®é‡è€Œä¸æ˜¯æ•´ä¸ªè¯·æ±‚è¿”å›çš„æ•°æ®é‡ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">testQueryStringQueryScroll</span><span class="params">(TransportClient client, String index, String type, String key,</span></span></span><br><span class="line"><span class="params"><span class="function">                                     String value, String scrollId, Integer pageSize ,String priceSort)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (pageSize != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//é»˜è®¤æœ‰5ä¸ªåˆ†ç‰‡ï¼Œ</span></span><br><span class="line">            pageSize = pageSize/<span class="number">5</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        SearchResponse scrollResponse = <span class="keyword">null</span>;</span><br><span class="line">        List resultList = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//TransportClient client = getClient();</span></span><br><span class="line">            BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();</span><br><span class="line">            <span class="keyword">if</span> (value == <span class="keyword">null</span> || value.isEmpty()) &#123;</span><br><span class="line">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class="string">&quot;isShow&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;deleteStatus&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;salesStatus&quot;</span>, <span class="number">1</span>));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                QueryBuilder fBuilder = QueryBuilders.queryStringQuery(value).field(key);</span><br><span class="line">                boolQueryBuilder.must(QueryBuilders.termQuery(<span class="string">&quot;isShow&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;deleteStatus&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(QueryBuilders.termQuery(<span class="string">&quot;salesStatus&quot;</span>, <span class="number">1</span>))</span><br><span class="line">                        .must(fBuilder);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (scrollId == <span class="keyword">null</span> || scrollId.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (priceSort == <span class="keyword">null</span> || priceSort.isEmpty()) &#123;</span><br><span class="line">                    scrollResponse = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                            .setQuery(boolQueryBuilder)</span><br><span class="line">                            .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(<span class="number">5</span>))</span><br><span class="line">                            .execute()</span><br><span class="line">                            .actionGet();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((<span class="string">&quot;desc&quot;</span>).equals(priceSort)) &#123;</span><br><span class="line">                        scrollResponse = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                                .setQuery(boolQueryBuilder)</span><br><span class="line">                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(<span class="number">5</span>))</span><br><span class="line">                                .addSort(<span class="string">&quot;price&quot;</span>, SortOrder.DESC)</span><br><span class="line">                                .execute()</span><br><span class="line">                                .actionGet();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        scrollResponse = client.prepareSearch(index).setTypes(type)</span><br><span class="line">                                .setQuery(boolQueryBuilder)</span><br><span class="line">                                .setSearchType(SearchType.SCAN).setSize(pageSize).setScroll(TimeValue.timeValueMinutes(<span class="number">5</span>))</span><br><span class="line">                                .addSort(<span class="string">&quot;price&quot;</span>, SortOrder.ASC)</span><br><span class="line">                                .execute()</span><br><span class="line">                                .actionGet();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//æ³¨æ„:é¦–æ¬¡æœç´¢å¹¶ä¸åŒ…å«æ•°æ®ï¼Œç¬¬ä¸€æ¬¡ä¸è¿”å›æ•°æ®ï¼Œæ‰€ä»¥å…ˆæŸ¥ä¸€æ¬¡è·å–scrollIdï¼Œåœ¨è¿›è¡Œç¬¬äºŒæ¬¡scrollæŸ¥è¯¢</span></span><br><span class="line">                scrollId = scrollResponse.getScrollId();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            scrollResponse = client.prepareSearchScroll(scrollId)</span><br><span class="line">                    .setScroll(TimeValue.timeValueMinutes(<span class="number">5</span>))</span><br><span class="line">                    .execute()</span><br><span class="line">                    .actionGet();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//æ³¨æ„:é¦–æ¬¡æœç´¢å¹¶ä¸åŒ…å«æ•°æ®ï¼Œç¬¬ä¸€æ¬¡ä¸è¿”å›æ•°æ®ï¼Œè·å–æ€»æ•°é‡</span></span><br><span class="line">            <span class="keyword">long</span> count = scrollResponse.getHits().getTotalHits();</span><br><span class="line">            System.out.println(<span class="string">&quot;scrollResponse.getHits().getHits().length:&quot;</span>+scrollResponse.getHits().hits().length);</span><br><span class="line">            System.out.println(<span class="string">&quot;scroll count:&quot;</span>+count);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//è·å–æœ¬æ¬¡æŸ¥è¯¢çš„scrollId</span></span><br><span class="line">            scrollIdTemp = scrollResponse.getScrollId();</span><br><span class="line">            System.out.println(<span class="string">&quot;--------- searchByScroll scrollID:&quot;</span>+scrollIdTemp);</span><br><span class="line">            logger.info(<span class="string">&quot;--------- searchByScroll scrollID &#123;&#125;&quot;</span>, scrollIdTemp);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æœç´¢ç»“æœ</span></span><br><span class="line">            SearchHit[] searchHits = scrollResponse.getHits().hits();</span><br><span class="line">            <span class="keyword">for</span> (SearchHit searchHit : searchHits) &#123;</span><br><span class="line">                String source = searchHit.getSource().toString();</span><br><span class="line">                logger.info(<span class="string">&quot;--------- searchByScroll source &#123;&#125;&quot;</span>, source);</span><br><span class="line">            &#125;</span><br><span class="line">            resultList = responseToList(scrollResponse);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°†æŸ¥è¯¢åè·å¾—çš„responseè½¬æˆlist</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List <span class="title">responseToList</span><span class="params">(SearchResponse response)</span></span>&#123;</span><br><span class="line">        SearchHits hits = response.getHits();</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        System.out.println(<span class="string">&quot;hits.hits().length:&quot;</span>+hits.hits().length);</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; hits.hits().length; i++) &#123;</span><br><span class="line">            Map&lt;String, Object&gt; map = hits.getAt(i).getSource();</span><br><span class="line">            Map&lt;String, Object&gt; resultMap = <span class="keyword">new</span> HashMap&lt;&gt;(<span class="number">16</span>);</span><br><span class="line">            System.out.println(map.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">            resultMap.put(<span class="string">&quot;skuId&quot;</span>, map.get(<span class="string">&quot;skuId&quot;</span>));</span><br><span class="line">            resultMap.put(<span class="string">&quot;name&quot;</span>, map.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">            resultMap.put(<span class="string">&quot;image&quot;</span>, map.get(<span class="string">&quot;primaryImage&quot;</span>));</span><br><span class="line">            resultMap.put(<span class="string">&quot;price&quot;</span>, map.get(<span class="string">&quot;luckyPrice&quot;</span>));</span><br><span class="line">            list.add(resultMap);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------------&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TransportClient <span class="title">getClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 1:é€šè¿‡ settingå¯¹è±¡æ¥æŒ‡å®šé›†ç¾¤é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * //æŒ‡å®šé›†ç¾¤åç§°</span></span><br><span class="line"><span class="comment">         * //å¯åŠ¨å—…æ¢åŠŸèƒ½</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Settings settings = Settings.settingsBuilder()</span><br><span class="line">                .put(<span class="string">&quot;cluster.name&quot;</span>, clusterName)</span><br><span class="line">                .put(<span class="string">&quot;client.transport.sniff&quot;</span>, <span class="keyword">true</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 2ï¼šåˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment">         * é€šè¿‡settingæ¥åˆ›å»ºï¼Œè‹¥ä¸æŒ‡å®šåˆ™é»˜è®¤é“¾æ¥çš„é›†ç¾¤åä¸ºelasticsearch</span></span><br><span class="line"><span class="comment">         * é“¾æ¥ä½¿ç”¨tcpåè®®å³9300</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        TransportClient client = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            client = TransportClient.builder().settings(settings).build()</span><br><span class="line">                    .addTransportAddress(<span class="keyword">new</span> InetSocketTransportAddress(InetAddress.getByName(HOST), PORT));</span><br><span class="line">            System.out.println(<span class="string">&quot;Elasticsearch connect info:&quot;</span> + client.toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*transportClient = new TransportClient(setting);</span></span><br><span class="line"><span class="comment">        TransportAddress transportAddress = new InetSocketTransportAddress(&quot;192.168.79.131&quot;, 9300);</span></span><br><span class="line"><span class="comment">        transportClient.addTransportAddresses(transportAddress);*/</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 3ï¼šæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯</span></span><br><span class="line"><span class="comment">         * æ³¨æ„æˆ‘çš„é›†ç¾¤ç»“æ„æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">         *   131çš„elasticsearch.ymlä¸­æŒ‡å®šä¸ºä¸»èŠ‚ç‚¹ä¸èƒ½å­˜å‚¨æ•°æ®ï¼Œ</span></span><br><span class="line"><span class="comment">         *   128çš„elasticsearch.ymlä¸­æŒ‡å®šä¸ä¸ºä¸»èŠ‚ç‚¹åªèƒ½å­˜å‚¨æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment">         * æ‰€æœ‰æ§åˆ¶å°åªæ‰“å°äº†192.168.79.128,åªèƒ½è·å–æ•°æ®èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">/*ImmutableList&lt;DiscoveryNode&gt; connectedNodes = client.connectedNodes();</span></span><br><span class="line"><span class="comment">        for(DiscoveryNode node : connectedNodes)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            System.out.println(node.getHostAddress());</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è°ƒç”¨ ES è·å– IK åˆ†è¯åç»“æœ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> searchContent</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;String&gt; <span class="title">getIkAnalyzeSearchTerms</span><span class="params">(Client client, String searchContent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨ IK åˆ†è¯åˆ†è¯</span></span><br><span class="line">        AnalyzeRequestBuilder ikRequest = <span class="keyword">new</span> AnalyzeRequestBuilder(client,</span><br><span class="line">                AnalyzeAction.INSTANCE, index, searchContent);</span><br><span class="line">        <span class="comment">//ikRequest.setAnalyzer(&quot;ik&quot;);</span></span><br><span class="line">        ikRequest.setTokenizer(<span class="string">&quot;ik&quot;</span>);</span><br><span class="line">        List&lt;AnalyzeResponse.AnalyzeToken&gt; ikTokenList = ikRequest.execute().actionGet().getTokens();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¾ªç¯èµ‹å€¼</span></span><br><span class="line">        List&lt;String&gt; searchTermList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//ikTokenList.forEach(ikToken -&gt; &#123; searchTermList.add(ikToken.getTerm()); &#125;);</span></span><br><span class="line">        <span class="keyword">for</span> (AnalyzeResponse.AnalyzeToken ikToken: ikTokenList) &#123;</span><br><span class="line">            System.out.println(ikToken.getTerm());</span><br><span class="line">            searchTermList.add(ikToken.getTerm());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> searchTermList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-å‰ç«¯æ•°æ®"><a href="#4-å‰ç«¯æ•°æ®" class="headerlink" title="4. å‰ç«¯æ•°æ®"></a>4. å‰ç«¯æ•°æ®</h2><p>ä¸ºä¸Šè¿°çš„åˆ†é¡µçš„æ•°æ®å¯è§†åŒ–ï¼ŒåŠ å…¥å‰ç«¯å±•ç¤ºé¡µï¼Œå¯æŒ‰ä¸­æ–‡å…³é”®è¯æœç´¢åˆ†é¡µç­‰æ“ä½œã€‚</p><p>index.htmlï¼Œä»¥åŠjsæ“ä½œéƒ¨åˆ†ï¼Œdata.jsï¼Œç”±äºç¯‡å¹…é—®é¢˜ï¼Œä¸‹è½½å¯ç§»æ­¥è‡³github:</p><p><a href="https://github.com/wonderomg/elasticsearch-visual%E4%B8%8B%E8%BD%BD%E8%AF%A6%E7%BB%86%E5%86%85%E5%AE%B9%EF%BC%8C">https://github.com/wonderomg/elasticsearch-visualä¸‹è½½è¯¦ç»†å†…å®¹ï¼Œ</a></p><p>å‰åç«¯é¡µç¼–å†™å®Œä¹‹åï¼Œå¯åŠ¨springbootå·¥ç¨‹ï¼Œè®¿é—®<code>http://localhost:8080/</code>è¯¥å·¥ç¨‹ç«¯å£ã€‚</p><p>å¯ä»¥çœ‹åˆ°æ“ä½œ é¡µé¢ï¼Œç±»ä¼¼ä¸‹å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/wonderomg/elasticsearch-visual/master/search.png" alt="search"></p><p>from sizeå’Œscrolléƒ½å¯é€šè¿‡è¯¥é¡µé¢è¿›è¡Œæµ‹è¯•ã€‚</p><h2 id="5-æ•°æ®é™åˆ¶é—®é¢˜"><a href="#5-æ•°æ®é™åˆ¶é—®é¢˜" class="headerlink" title="5. æ•°æ®é™åˆ¶é—®é¢˜"></a>5. æ•°æ®é™åˆ¶é—®é¢˜</h2><p>æµ‹è¯•from sizeæ—¶å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œå½“æ•°æ®è¶…è¿‡10000æ¡ä¼šæŠ¥é”™ï¼Œæç¤ºå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Caused by: QueryPhaseExecutionException[Result window is too large, </span><br><span class="line">from + size must be less than or equal to: [10000] but was [10001]. </span><br><span class="line">See the scroll api for a more efficient way to request large data sets. </span><br><span class="line">This limit can be set by changing the [index.max_result_window] index level parameter.]</span><br></pre></td></tr></table></figure><p>åŸå› æ˜¯esç´¢å¼•è¢«é™åˆ¶äº†å¯æŸ¥å‰10000æ¡æ•°æ®ï¼Œå‚æ•°æ˜¯<code>max_result_window</code>ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä¿®æ”¹è¿™ä¸ªé™åˆ¶ã€‚</p><p>(1)æŸ¥è¯¢index.max_result_window</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET &quot;10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true&quot;</span><br></pre></td></tr></table></figure><p>(2)æ›´æ”¹index.max_result_window</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT &quot;10.10.13.234:9200/jd_mall_v2/_settings?preserve_existing=true&quot; -d &#x27;&#123; &quot;index&quot; : &#123; &quot;max_result_window&quot; : 100000000&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure><p>è®¾ç½®max_result_windowçš„æ—¶å€™éœ€è¦å…ˆå…³é—­ç´¢å¼•ï¼Œä¸ç„¶ä¼šæŠ¥é”™<code>Can&#39;t update non dynamic settings[[index.preserve_existing]] for open indices</code>çš„é”™è¯¯ï¼Œå¯ä»¥é€šè¿‡æŒ‡ä»¤å…³é—­ï¼Œä¹Ÿå¯ä»¥é€šè¿‡headå¯è§†åŒ–ç•Œé¢å…³é—­å’Œå¼€å¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸Šè¿°æ­¥éª¤1.7å’Œ1.8çš„apiå…³é—­å’Œå¼€å¯ã€‚</p><h2 id="6-æ’åº"><a href="#6-æ’åº" class="headerlink" title="6. æ’åº"></a>6. æ’åº</h2><p>åˆ†é¡µçš„æ—¶å€™æˆ‘ä»¬å¯ä»¥è¿˜æœ‰æ’åºçš„åœºæ™¯ï¼Œjava apiçš„è¯å¢åŠ ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchRequestBuilder.addSort(<span class="string">&quot;publish_time&quot;</span>, SortOrder.DESC);</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§æŸä¸ªå­—æ®µæ’åºçš„è¯ï¼Œhit.getScore()å°†ä¼šå¤±æ•ˆ<br>å¦‚æœæ˜¯scrollåˆ†é¡µæ— æ³•è¿›è¡Œæ’åºã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/elasticsearch/">elasticsearch</category>
      
      
      <category domain="https://wonderomg.github.io/tags/elasticsearch/">elasticsearch</category>
      
      <category domain="https://wonderomg.github.io/tags/ik%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/">ikä¸­æ–‡åˆ†è¯</category>
      
      <category domain="https://wonderomg.github.io/tags/%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/">åˆ†é¡µæŸ¥è¯¢</category>
      
      
      <comments>https://wonderomg.github.io/2018/05/17/Elasticsearch%E5%AE%9E%E8%B7%B5api%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Elasticsearchå®è·µ(2)-ç´¢å¼•åŠç´¢å¼•åˆ«åalias</title>
      <link>https://wonderomg.github.io/2018/05/16/Elasticsearch%E5%AE%9E%E8%B7%B5%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8Dalias/</link>
      <guid>https://wonderomg.github.io/2018/05/16/Elasticsearch%E5%AE%9E%E8%B7%B5%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8Dalias/</guid>
      <pubDate>Tue, 15 May 2018 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;æˆ‘ä»¬éƒ½çŸ¥é“esæ•ˆç‡å¦‚æ­¤é«˜ä¸»è¦å’Œç´¢å¼•æ˜¯åˆ†ä¸å¼€çš„ï¼Œéœ€è¦å°†æ¯ä¸€æ¡æ•°æ®å»ºç«‹ç´¢å¼•ï¼Œåˆ›å»ºç´¢å¼•æ—¶æ•°æ®å­—æ®µä¹Ÿæ˜¯ä½ æ’å…¥æ—¶çš„æ ·å­ï¼Œç´¢å¼•ä¸­åŒ…å«äº†æ•°æ®çš„å±æ€§å­—æ®µã€‚è€Œä¸”åˆ›å»ºç´¢å¼•ä¹Ÿæ¯”è¾ƒè€—æ—¶ï¼ˆå½“ç„¶äº†ï¼Œè‚¯å®šæ¯”æ’å…¥å…³ç³»å‹æ•°æ®åº“ä¸­æ›´å¿«ğŸ˜ï¼‰ï¼Œä½†æ˜¯æ¯•ç«Ÿæ¯ä¸€æ¡æ•°æ®éƒ½è¦å»ºä¸€æ¬¡ï¼Œæ•°æ®é‡åˆ°è¾¾åƒä¸‡çº§äº¿çº§æ—¶ï¼Œæ—¶é—´ä¸æ˜¯å¾ˆä¹è§‚ã€‚ğŸ¤”&lt;/p&gt;
&lt;p&gt;ğŸ’¡æƒ³åƒè¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œäº§å“ä¸Šçº¿ä¸€æ®µæ—¶é—´åï¼Œç”±äºäº§å“éœ€è¦ï¼Œè¦å°†æŸä¸ªå­—æ®µç±»å‹æ”¹å˜ï¼Œæ¯”å¦‚éœ€è¦å°†æŸä¸ªlongå‹å­—æ®µæ”¹æˆstringç±»å‹ï¼Œç›´æ¥æ”¹ä¼šç±»å‹æŠ¥é”™ï¼ŒæŸ¥é˜…å®˜æ–¹æ–‡æ¡£å¯çŸ¥ï¼Œesæ˜¯ä¸æ”¯æŒç´¢å¼•çš„æ›´æ–°æ“ä½œçš„ï¼Œéœ€è¦å¯¹æ‰€æœ‰å·²æœ‰æ•°æ®çš„æ‰€æœ‰fieldè¿›è¡Œreindexï¼Œè¿™æ„å‘³ç€ï¼Œéœ€è¦åœæ­¢æœåŠ¡è¿›è¡Œé‡å»ºç´¢å¼•æ“ä½œï¼Œåœæœæ˜¯æœ€ä¸æƒ³çœ‹åˆ°ğŸ˜­ï¼Œè¿™æ—¶å¦‚æœä½ å½“åˆå»ºäº†ç´¢å¼•åˆ«åï¼Œä½ ä¼šæ„Ÿè°¢ä½ å½“åˆä½¿ç”¨åˆ«åçš„å†³å®šï¼Œä¸ºä½•è¦ç”¨åˆ«åaliasï¼ŸğŸ¤·&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>æˆ‘ä»¬éƒ½çŸ¥é“esæ•ˆç‡å¦‚æ­¤é«˜ä¸»è¦å’Œç´¢å¼•æ˜¯åˆ†ä¸å¼€çš„ï¼Œéœ€è¦å°†æ¯ä¸€æ¡æ•°æ®å»ºç«‹ç´¢å¼•ï¼Œåˆ›å»ºç´¢å¼•æ—¶æ•°æ®å­—æ®µä¹Ÿæ˜¯ä½ æ’å…¥æ—¶çš„æ ·å­ï¼Œç´¢å¼•ä¸­åŒ…å«äº†æ•°æ®çš„å±æ€§å­—æ®µã€‚è€Œä¸”åˆ›å»ºç´¢å¼•ä¹Ÿæ¯”è¾ƒè€—æ—¶ï¼ˆå½“ç„¶äº†ï¼Œè‚¯å®šæ¯”æ’å…¥å…³ç³»å‹æ•°æ®åº“ä¸­æ›´å¿«ğŸ˜ï¼‰ï¼Œä½†æ˜¯æ¯•ç«Ÿæ¯ä¸€æ¡æ•°æ®éƒ½è¦å»ºä¸€æ¬¡ï¼Œæ•°æ®é‡åˆ°è¾¾åƒä¸‡çº§äº¿çº§æ—¶ï¼Œæ—¶é—´ä¸æ˜¯å¾ˆä¹è§‚ã€‚ğŸ¤”</p><p>ğŸ’¡æƒ³åƒè¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œäº§å“ä¸Šçº¿ä¸€æ®µæ—¶é—´åï¼Œç”±äºäº§å“éœ€è¦ï¼Œè¦å°†æŸä¸ªå­—æ®µç±»å‹æ”¹å˜ï¼Œæ¯”å¦‚éœ€è¦å°†æŸä¸ªlongå‹å­—æ®µæ”¹æˆstringç±»å‹ï¼Œç›´æ¥æ”¹ä¼šç±»å‹æŠ¥é”™ï¼ŒæŸ¥é˜…å®˜æ–¹æ–‡æ¡£å¯çŸ¥ï¼Œesæ˜¯ä¸æ”¯æŒç´¢å¼•çš„æ›´æ–°æ“ä½œçš„ï¼Œéœ€è¦å¯¹æ‰€æœ‰å·²æœ‰æ•°æ®çš„æ‰€æœ‰fieldè¿›è¡Œreindexï¼Œè¿™æ„å‘³ç€ï¼Œéœ€è¦åœæ­¢æœåŠ¡è¿›è¡Œé‡å»ºç´¢å¼•æ“ä½œï¼Œåœæœæ˜¯æœ€ä¸æƒ³çœ‹åˆ°ğŸ˜­ï¼Œè¿™æ—¶å¦‚æœä½ å½“åˆå»ºäº†ç´¢å¼•åˆ«åï¼Œä½ ä¼šæ„Ÿè°¢ä½ å½“åˆä½¿ç”¨åˆ«åçš„å†³å®šï¼Œä¸ºä½•è¦ç”¨åˆ«åaliasï¼ŸğŸ¤·</p><span id="more"></span><p>Elasticsearchçš„ç´¢å¼•åˆ«åaliasï¼Œç±»ä¼¼äºæ•°æ®åº“çš„è§†å›¾ã€‚å› ä¸ºç´¢å¼•åˆ«åaliasæ˜¯æ˜ å°„åˆ°ä¹‹å‰å·²åˆ›å»ºçš„ç´¢å¼•ä¸Šçš„ï¼Œå¯¹ä½ è¦åˆ›å»ºæ–°çš„ç´¢å¼•æ¯«æ— å½±å“ã€‚åœ¨åˆ›å»ºå¥½æ–°ç´¢å¼•ä¹‹åï¼Œæˆ‘ä»¬åªéœ€å°†è¿™åˆ«åaliasæ˜ å°„åˆ°æ–°åˆ›å»ºçš„åˆ«åä¸Šå³å¯ï¼Œè¿™äº›æ“ä½œåªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šé€šè¿‡æŒ‡ä»¤æ“ä½œå³å¯ï¼Œå®Œå…¨ä¸å½±å“çº¿ä¸ŠæœåŠ¡ï¼Œå®ç°æ— ç¼åˆ‡æ¢ç´¢å¼•ã€‚ç„¶åå†å°†è€çš„ç´¢å¼•åˆ æ‰å³å¯ï¼Œä»¥èŠ‚çœç©ºé—´ã€‚</p><h2 id="1-åˆ›å»ºä¸€ä¸ªç´¢å¼•"><a href="#1-åˆ›å»ºä¸€ä¸ªç´¢å¼•" class="headerlink" title="1. åˆ›å»ºä¸€ä¸ªç´¢å¼•"></a>1. åˆ›å»ºä¸€ä¸ªç´¢å¼•</h2><p>åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œåä¸º<code>goods</code>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XPUT 10.10.13.234:9200/goods</span></span><br></pre></td></tr></table></figure><h2 id="2-ä¸ºç´¢å¼•åˆ›å»ºmapping"><a href="#2-ä¸ºç´¢å¼•åˆ›å»ºmapping" class="headerlink" title="2. ä¸ºç´¢å¼•åˆ›å»ºmapping"></a>2. ä¸ºç´¢å¼•åˆ›å»ºmapping</h2><p>ä¸ºç´¢å¼•<code>goods</code>åˆ›å»º<code>mapping</code>ï¼Œè¿™é‡Œåˆ¶å®š<code>content</code>å­—æ®µå±æ€§ä½¿ç”¨ikä¸­æ–‡åˆ†è¯å™¨ï¼Œåªè¦åˆ¶å®šæœç´¢<code>content</code>å†…å®¹å°±ä¼šæŸ¥è¯¢å‡ºåˆ†è¯ä¹‹åçš„å…³è”ç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XPOST 10.10.13.234:9200/goods/fulltext/_mapping -d<span class="string">&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">    &quot;fulltext&quot;: &#123;</span><br><span class="line">             &quot;_all&quot;: &#123;</span><br><span class="line">            &quot;analyzer&quot;: &quot;ik&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;content&quot;: &#123;</span><br><span class="line">                &quot;type&quot; : &quot;string&quot;,</span><br><span class="line">                &quot;boost&quot; : 8.0,</span><br><span class="line">                &quot;term_vector&quot; : &quot;with_positions_offsets&quot;,</span><br><span class="line">                &quot;analyzer&quot; : &quot;ik&quot;,</span><br><span class="line">                &quot;include_in_all&quot; : true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ›å»ºçš„ç´¢å¼•<code>goods</code>ï¼Œå¦‚æœæœªä½¿ç”¨åˆ«åï¼Œç¨‹åºä¸­ä¹Ÿæ˜¯ç”¨<code>goods</code>è¿™ä¸ªç´¢å¼•åï¼Œå¦‚æœå»ºäº†æ–°çš„ç´¢å¼•ï¼Œé‚£ä¹ˆç¨‹åºä¹Ÿè¦ç”¨æ–°çš„ç´¢å¼•åç§°ï¼Œè¿™æ˜¯ä¸å‹å¥½çš„ï¼Œå¦‚æœç”¨äº†ç´¢å¼•åˆ«åaliaså°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç»§ç»­çœ‹åé¢çš„æ“ä½œã€‚</p><h2 id="3-æ’å…¥æ•°æ®"><a href="#3-æ’å…¥æ•°æ®" class="headerlink" title="3. æ’å…¥æ•°æ®"></a>3. æ’å…¥æ•°æ®</h2><p>æ’å…¥ä¸€äº›æµ‹è¯•æ•°æ®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XPOST 10.10.13.234:9200/goods/fulltext/1 -H <span class="string">&#x27;Content-Type:application/json&#x27;</span> -d<span class="string">&#x27;</span></span></span><br><span class="line">&#123; &quot;content&quot;: &quot;è¿›å£åç››é¡¿çº¢è›‡æœ è‹¹æœ4ä¸ªè£… å•æœé‡çº¦180g æ–°é²œæ°´æœ&quot; &#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="string"> curl -XPOST 10.10.13.234:9200/goods/fulltext/2 -H &#x27;</span>Content-Type:application/json<span class="string">&#x27; -d&#x27;</span></span></span><br><span class="line">&#123; &quot;content&quot;: &quot;åç››é¡¿è‹¹æœç¤¼ç›’ 8ä¸ªè£…ï¼ˆ4ä¸ªçº¢è›‡æœ+4ä¸ªé’è‹¹æœï¼‰å•æœé‡çº¦145g-180g æ–°é²œæ°´æœç¤¼ç›’&quot; &#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -XPOST 10.10.13.234:9200/goods/fulltext/4 -H <span class="string">&#x27;Content-Type:application/json&#x27;</span> -d<span class="string">&#x27;</span></span></span><br><span class="line">&#123; &quot;content&quot;: &quot;æ–°ç–†é˜¿å…‹è‹å†°ç³–å¿ƒ çº¦5kg å•æœ200-250gï¼ˆ7Fresh ä¸“ä¾›ï¼‰&quot; &#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="string"> curl -XPOST 10.10.13.234:9200/goods/fulltext/5 -H &#x27;</span>Content-Type:application/json<span class="string">&#x27; -d&#x27;</span></span></span><br><span class="line">&#123; &quot;content&quot;: &quot;æœèŠ± çç å²© æ— åœŸæ ½åŸ¹åŸºè´¨ é¢—ç²’çŠ¶ ä¿æ¸©æ€§èƒ½å¥½ å›­è‰ºç”¨å“&quot; &#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹goodsçš„mppingï¼Œåé¢éœ€è¦ä¸ç´¢å¼•åˆ«åçš„mappingå¯¹æ¯”</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -XGET <span class="string">&quot;10.10.13.234:9200/goods/_mapping?pretty&quot;</span></span> </span><br></pre></td></tr></table></figure><h2 id="4-æµ‹è¯•åˆ†è¯é«˜äº®"><a href="#4-æµ‹è¯•åˆ†è¯é«˜äº®" class="headerlink" title="4. æµ‹è¯•åˆ†è¯é«˜äº®"></a>4. æµ‹è¯•åˆ†è¯é«˜äº®</h2><p>æµ‹è¯•å‘½ä¸­åˆ†è¯é«˜äº®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XPOST 10.10.13.234:9200/goods/fulltext/_search -H <span class="string">&#x27;Content-Type:application/json&#x27;</span> -d<span class="string">&#x27;</span></span></span><br><span class="line">&#123; &quot;query&quot; : &#123; &quot;match&quot; : &#123; &quot;content&quot; : &quot;è¿›å£æ°´æœ&quot; &#125;&#125;,</span><br><span class="line">    &quot;highlight&quot; : &#123;</span><br><span class="line">        &quot;pre_tags&quot; : [&quot;&lt;tag1&gt;&quot;, &quot;&lt;tag2&gt;&quot;],</span><br><span class="line">        &quot;post_tags&quot; : [&quot;&lt;/tag1&gt;&quot;, &quot;&lt;/tag2&gt;&quot;],</span><br><span class="line">        &quot;fields&quot; : &#123;</span><br><span class="line">            &quot;content&quot; : &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure><h2 id="5-åˆ›å»ºç´¢å¼•åˆ«å"><a href="#5-åˆ›å»ºç´¢å¼•åˆ«å" class="headerlink" title="5. åˆ›å»ºç´¢å¼•åˆ«å"></a>5. åˆ›å»ºç´¢å¼•åˆ«å</h2><p>æ–°å»ºåŒä¹‰è¯mappingï¼š</p><p>(1) åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•çš„åç§°æœ€å¥½å¸¦ä¸Šç‰ˆæœ¬å·ï¼Œæ¯”å¦‚my_index_v1,my_index_v2ç­‰;</p><p>(2) åˆ›å»ºä¸€ä¸ªæŒ‡å‘æœ¬ç´¢å¼•çš„åŒä¹‰è¯ã€‚ä¸ºçš„æ˜¯ä»¥åä¸åœæœæ›´æ–°mappingã€‚</p><p>æ­¥éª¤(1)çš„ç´¢å¼•æˆ‘ä»¬ä»¥åˆšåˆšåˆ›å»ºçš„<code>goods</code>æ‰€ä»¥ä¸ºä¾‹ï¼Œåˆ›å»ºåˆ«åæ˜ å°„åˆ°<code>goods</code>æ‰€ä»¥ä¸Šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XPOST 10.10.13.234:9200/_aliases -d <span class="string">&#x27;</span></span>  </span><br><span class="line">&#123;  </span><br><span class="line">    &quot;actions&quot;: [  </span><br><span class="line">        &#123; &quot;add&quot;: &#123;  </span><br><span class="line">            &quot;alias&quot;: &quot;my_index&quot;,  </span><br><span class="line">            &quot;index&quot;: &quot;goods&quot;  </span><br><span class="line">        &#125;&#125;  </span><br><span class="line">    ]  </span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure><p>ç„¶åæŸ¥çœ‹ç´¢å¼•<code>my_index</code>çš„mappingï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XGET <span class="string">&quot;10.10.13.234:9200/my_index/_mapping?pretty&quot;</span></span> </span><br></pre></td></tr></table></figure><p>ç´¢å¼•<code>my_index</code>ä¸<code>goods</code>çš„<code>mapping</code>ä¸€è‡´ã€‚</p><h2 id="6-åˆ‡æ¢ç´¢å¼•"><a href="#6-åˆ‡æ¢ç´¢å¼•" class="headerlink" title="6. åˆ‡æ¢ç´¢å¼•"></a>6. åˆ‡æ¢ç´¢å¼•</h2><p>å†åˆ›å»ºä¸€ä¸ªç´¢å¼•<code>goods_v2</code>ï¼Œé‡å¤æ­¥éª¤1ã€2ï¼Œåç§°æ¢æˆ<code>goods_v2</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XPUT 10.10.13.234:9200/goods_v2</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/_mapping -d<span class="string">&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">    &quot;fulltext&quot;: &#123;</span><br><span class="line">             &quot;_all&quot;: &#123;</span><br><span class="line">            &quot;analyzer&quot;: &quot;ik&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;content&quot;: &#123;</span><br><span class="line">                &quot;type&quot; : &quot;string&quot;,</span><br><span class="line">                &quot;boost&quot; : 8.0,</span><br><span class="line">                &quot;term_vector&quot; : &quot;with_positions_offsets&quot;,</span><br><span class="line">                &quot;analyzer&quot; : &quot;ik&quot;,</span><br><span class="line">                &quot;include_in_all&quot; : true</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æ’å…¥æµ‹è¯•æ•°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XPOST 10.10.13.234:9200/goods_v2/fulltext/1 -H <span class="string">&#x27;Content-Type:application/json&#x27;</span> -d<span class="string">&#x27;</span></span></span><br><span class="line">&#123; &quot;content&quot;: &quot;è¿›å£åç››é¡¿çº¢è›‡æœ è‹¹æœ4ä¸ªè£… å•æœé‡çº¦180g æ–°é²œæ°´æœ&quot;,</span><br><span class="line">&quot;number&quot;: 21&#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">æŸ¥çœ‹goods_v2çš„mppingï¼Œåé¢éœ€è¦ä¸ç´¢å¼•åˆ«åçš„mappingå¯¹æ¯”</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="string"> curl -XGET &quot;10.10.13.234:9200/goods_v2/_mapping?pretty&quot;</span></span></span><br></pre></td></tr></table></figure><p><strong>é‡ç‚¹æ˜¯æ›´æ¢ç´¢å¼•çš„æ“ä½œ</strong>ï¼Œå°†<code>my_index</code>åˆ«ååˆ‡æ¢æ˜ å°„åˆ°<code>goods_v2</code>ä¸Šï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -XPOST 10.10.13.234:9200/_aliases -d <span class="string">&#x27;</span></span></span><br><span class="line">&#123;</span><br><span class="line">    &quot;actions&quot;: [</span><br><span class="line">        &#123; &quot;remove&quot;: &#123;</span><br><span class="line">            &quot;alias&quot;: &quot;my_index&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;goods&quot;</span><br><span class="line">        &#125;&#125;,</span><br><span class="line">        &#123; &quot;add&quot;: &#123;</span><br><span class="line">            &quot;alias&quot;: &quot;my_index&quot;,</span><br><span class="line">            &quot;index&quot;: &quot;goods_v2&quot;</span><br><span class="line">        &#125;&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">æŸ¥çœ‹my_indexçš„mppingï¼Œä¸å‰é¢goods_v2çš„mappingå¯¹æ¯”</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"><span class="string"> curl -XGET &quot;10.10.13.234:9200/my_index/_mapping?pretty&quot;</span></span> </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å¯¹æ¯”ç´¢å¼•<code>my_index</code>ä¸<code>goods_v2</code>çš„<code>mapping</code>æ˜¯ä¸€è‡´çš„ï¼Œç´¢å¼•åˆ‡æ¢æˆåŠŸã€‚</p><p>åˆ›å»ºäº†ç´¢å¼•åˆ«åaliasçš„è¯ï¼Œç¨‹åºä¸­åˆ¶å®šè¿™ä¸ª<code>my_index</code>è¿™ä¸ªåˆ«åå³å¯ï¼Œåéœ€è¦åˆ›å»ºæ–°ç´¢å¼•ï¼Œåªéœ€åˆ‡æ¢ç´¢å¼•æ˜ å°„åˆ°æ–°ç´¢å¼•ä¸Šå³å¯ï¼Œå®ç°ä¸åœæœæ›´æ–°mappingã€‚</p><p>ä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥è¯´ä¸‹é€šè¿‡<strong>åˆ›å»ºspring bootå·¥ç¨‹ï¼Œé€šè¿‡esçš„java apiæ“ä½œesï¼Œå®ç°åˆ†é¡µæŸ¥è¯¢å’Œä¸­æ–‡åˆ†è¯æ£€ç´¢</strong>çš„åŠŸèƒ½ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/elasticsearch/">elasticsearch</category>
      
      
      <category domain="https://wonderomg.github.io/tags/elasticsearch/">elasticsearch</category>
      
      <category domain="https://wonderomg.github.io/tags/ik%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/">ikä¸­æ–‡åˆ†è¯</category>
      
      <category domain="https://wonderomg.github.io/tags/alias/">alias</category>
      
      
      <comments>https://wonderomg.github.io/2018/05/16/Elasticsearch%E5%AE%9E%E8%B7%B5%E7%B4%A2%E5%BC%95%E5%8F%8A%E7%B4%A2%E5%BC%95%E5%88%AB%E5%90%8Dalias/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Elasticsearchå®è·µ(1)-æ­å»ºåŠIKä¸­æ–‡åˆ†è¯</title>
      <link>https://wonderomg.github.io/2018/05/15/Elasticsearch%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E5%8F%8AIK%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/</link>
      <guid>https://wonderomg.github.io/2018/05/15/Elasticsearch%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E5%8F%8AIK%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/</guid>
      <pubDate>Mon, 14 May 2018 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ğŸ”è¿‘æœŸåœ¨åšå•†å“æœç´¢ä¼˜åŒ–ï¼Œå¯¹æ¯”äº†Solrä¸Elasticsearchçš„åŒºåˆ«ï¼Œä¸¤è€…éƒ½æ˜¯åŸºäºLuceneå®ç°çš„å°è£…ï¼Œä½†esåœ¨æ•°æ®é‡è¶Šå¤§çš„æƒ…å†µä¸‹å®æ—¶æ£€ç´¢æ€§èƒ½ä¼˜äºsolrï¼Œæ›´é€‚ç”¨äºå®æ—¶å•†å“æœç´¢ï¼Œäºæ˜¯é€‰ç”¨äº†esï¼Œä¸‹é¢ä»‹ç»elasticsearchæœç´¢å¼•æ“çš„æ­å»ºåŠä½¿ç”¨ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯2.2.1çš„esç‰ˆæœ¬ï¼Œä»¥åŠ1.8.1çš„ikåˆ†è¯ç‰ˆæœ¬ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ğŸ”è¿‘æœŸåœ¨åšå•†å“æœç´¢ä¼˜åŒ–ï¼Œå¯¹æ¯”äº†Solrä¸Elasticsearchçš„åŒºåˆ«ï¼Œä¸¤è€…éƒ½æ˜¯åŸºäºLuceneå®ç°çš„å°è£…ï¼Œä½†esåœ¨æ•°æ®é‡è¶Šå¤§çš„æƒ…å†µä¸‹å®æ—¶æ£€ç´¢æ€§èƒ½ä¼˜äºsolrï¼Œæ›´é€‚ç”¨äºå®æ—¶å•†å“æœç´¢ï¼Œäºæ˜¯é€‰ç”¨äº†esï¼Œä¸‹é¢ä»‹ç»elasticsearchæœç´¢å¼•æ“çš„æ­å»ºåŠä½¿ç”¨ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯2.2.1çš„esç‰ˆæœ¬ï¼Œä»¥åŠ1.8.1çš„ikåˆ†è¯ç‰ˆæœ¬ã€‚</p><span id="more"></span><h1 id="å®‰è£…esåŠIKä¸­æ–‡åˆ†è¯"><a href="#å®‰è£…esåŠIKä¸­æ–‡åˆ†è¯" class="headerlink" title="å®‰è£…esåŠIKä¸­æ–‡åˆ†è¯"></a>å®‰è£…esåŠIKä¸­æ–‡åˆ†è¯</h1><h2 id="1-ä¸‹è½½å®‰è£…åŒ…"><a href="#1-ä¸‹è½½å®‰è£…åŒ…" class="headerlink" title="1. ä¸‹è½½å®‰è£…åŒ…"></a>1. ä¸‹è½½å®‰è£…åŒ…</h2><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##æˆ‘çš„ç¯å¢ƒæ˜¯Redhat6.4ï¼Œæ­¤å¤„ä½¿ç”¨çš„æ˜¯es2.2.1ç‰ˆæœ¬</span></span><br><span class="line"><span class="comment">##ï¼ˆ1ï¼‰å¯ä»¥ä½¿ç”¨æŒ‡ä»¤å®‰è£…</span></span><br><span class="line"><span class="meta">$</span> <span class="string">yum install https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/rpm/elasticsearch/2.2.1/elasticsearch-2.2.1.rpm</span></span><br><span class="line"><span class="comment">##ï¼ˆ2ï¼‰ä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½æ–‡ä»¶ï¼Œç„¶åä¸Šä¼ è‡³linuxç›®å½•ä¸‹</span></span><br><span class="line"><span class="attr">https</span>:<span class="string">//download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/tar/elasticsearch/2.2.1/elasticsearch-2.2.1.tar.gz</span></span><br></pre></td></tr></table></figure><h2 id="2-ä¸Šä¼ å®‰è£…æ–‡ä»¶åˆ°linuxç›®å½•å¹¶è§£å‹"><a href="#2-ä¸Šä¼ å®‰è£…æ–‡ä»¶åˆ°linuxç›®å½•å¹¶è§£å‹" class="headerlink" title="2. ä¸Šä¼ å®‰è£…æ–‡ä»¶åˆ°linuxç›®å½•å¹¶è§£å‹"></a>2. ä¸Šä¼ å®‰è£…æ–‡ä»¶åˆ°linuxç›®å½•å¹¶è§£å‹</h2><p>æˆ‘è¿™é‡Œå°†<code>elasticsearch-2.2.1.tar.gz</code>æ–‡ä»¶æ”¾è‡³<code>/opt/elasticsearch</code>ç›®å½•ä¸‹ã€‚</p><p>è§£å‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /opt/elasticsearch</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -zxvf elasticsearch-2.2.1.tar.gz</span></span><br></pre></td></tr></table></figure><p><strong>æ­¤æ—¶åˆ‡è®°ä¸èƒ½ç”¨ <code>./bin/elasticsearch</code>å¯åŠ¨ï¼Œå› ä¸ºåœ¨rootæƒé™ä¸‹ä¼šæç¤ºé”™è¯¯</strong>ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.RuntimeException: don&#x27;t run elasticsearch as root.</span><br></pre></td></tr></table></figure><h2 id="3-æ–°æ·»åŠ ä¸€ä¸ªelasticsearchç”¨æˆ·"><a href="#3-æ–°æ·»åŠ ä¸€ä¸ªelasticsearchç”¨æˆ·" class="headerlink" title="3. æ–°æ·»åŠ ä¸€ä¸ªelasticsearchç”¨æˆ·"></a>3. æ–°æ·»åŠ ä¸€ä¸ªelasticsearchç”¨æˆ·</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æ·»åŠ elasticsearchç”¨æˆ·ï¼š</span></span><br><span class="line">$ useradd elasticsearch</span><br><span class="line"><span class="comment">#ç»™ç”¨æˆ·elasticsearchè®¾ç½®å¯†ç ï¼Œè¿ç»­è¾“å…¥2æ¬¡ï¼š</span></span><br><span class="line">$ passwd elasticsearch</span><br><span class="line"><span class="comment">#åˆ›å»ºä¸€ä¸ªç”¨æˆ·ç»„es:</span></span><br><span class="line">$ groupadd es</span><br><span class="line"><span class="comment">#åˆ†é…elasticsearchåˆ°esç»„:</span></span><br><span class="line">$ usermod -G es elasticsearch</span><br><span class="line"><span class="comment">#åœ¨elasticsearch æ ¹ç›®å½•ä¸‹ï¼Œç»™å®šç”¨æˆ·æƒé™ã€‚-Rè¡¨ç¤ºé€çº§ï¼ˆNå±‚ç›®å½•ï¼‰ ï¼Œ * è¡¨ç¤º ä»»ä½•æ–‡ä»¶:</span></span><br><span class="line">$ chown -R elasticsearch:es *</span><br><span class="line"><span class="comment">#åˆ‡æ¢åˆ°elasticsearchç”¨æˆ·:</span></span><br><span class="line">$ su elasticsearch</span><br></pre></td></tr></table></figure><h2 id="4-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#4-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="4. ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>4. ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vi config/elasticsearch.yml</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#cluster name</span></span><br><span class="line"><span class="meta">cluster.name</span>: <span class="string">my-application</span></span><br><span class="line"><span class="comment">#èŠ‚ç‚¹åç§°</span></span><br><span class="line"><span class="meta">node.name</span>: <span class="string">node-1</span></span><br><span class="line"><span class="meta">path.data</span>: <span class="string">/opt/elasticsearch/elasticsearch-2.2.1/data</span></span><br><span class="line"><span class="meta">path.logs</span>: <span class="string">/opt/elasticsearch/elasticsearch-2.2.1/logs</span></span><br><span class="line"><span class="comment">#ç»‘å®šIPå’Œç«¯å£</span></span><br><span class="line"><span class="meta">network.host</span>: <span class="string">0.0.0.0</span></span><br><span class="line"><span class="meta">http.port</span>: <span class="string">9200</span></span><br></pre></td></tr></table></figure><h2 id="5-å®‰è£…head"><a href="#5-å®‰è£…head" class="headerlink" title="5. å®‰è£…head"></a>5. å®‰è£…head</h2><p>headæ˜¯elasticsearchçš„å¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥ä¸ç”¨å®‰è£…headï¼Œå¦‚æœä¸éœ€è¦å®‰è£…ï¼Œè·³è¿‡æ­¤æ­¥éª¤ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œes2.xçš„ç‰ˆæœ¬headå¯ç›´æ¥å®‰è£…ï¼Œes5.xä»¥ä¸Šçš„ç‰ˆæœ¬éœ€è¦å…ˆå®‰è£…nodejsã€‚</p><h3 id="5-1-ES2-x-xç‰ˆæœ¬å®‰è£…head"><a href="#5-1-ES2-x-xç‰ˆæœ¬å®‰è£…head" class="headerlink" title="5.1. ES2.x.xç‰ˆæœ¬å®‰è£…head"></a>5.1. ES2.x.xç‰ˆæœ¬å®‰è£…head</h3><p>åœ¨<code>/opt/elasticsearch/elasticsearch-2.2.1/</code>ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹ï¼šplugins</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /opt/elasticsearch/elasticsearch-2.2.1/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir plugins</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> elasticsearch/bin</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./plugin install mobz/elasticsearch-head</span></span><br></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸå³å¯ã€‚å¯åŠ¨esä¹‹åï¼Œè®¿é—®<code>http://ip:9200/_plugin/head/</code>å³å¯çœ‹åˆ°å¯è§†åŒ–ç•Œé¢ã€‚</p><h3 id="5-2-ES5-x-xç‰ˆæœ¬å®‰è£…head"><a href="#5-2-ES5-x-xç‰ˆæœ¬å®‰è£…head" class="headerlink" title="5.2 ES5.x.xç‰ˆæœ¬å®‰è£…head"></a>5.2 ES5.x.xç‰ˆæœ¬å®‰è£…head</h3><p>ES5.xç‰ˆæœ¬æš‚æ—¶ä¸æ”¯æŒç›´æ¥å®‰è£…ï¼Œä½†æ˜¯headä½œè€…æä¾›äº†å¦ä¸€ç§å®‰è£…æ–¹æ³•ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> git://github.com/mobz/elasticsearch-head.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> elasticsearch-head</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm run start</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ‰“å¼€<code>http://localhost:9100/</code>è®¿é—®å³å¯ã€‚</p><p>å¦‚æœæç¤ºæœªå®‰è£…node.jsï¼Œå…ˆå®‰è£…node.jsï¼Œ</p><p>node.jså®˜ç½‘ï¼š<a href="http://nodejs.cn/download/">http://nodejs.cn/download/</a></p><p>é€‰æ‹©å®‰è£…åŒ…ï¼Œæˆ‘è¿™è¾¹æ˜¯64ä½linuxï¼Œä¸‹è½½çš„æ˜¯<a href="https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz">https://nodejs.org/dist/v8.11.3/node-v8.11.3-linux-x64.tar.xz</a></p><p>è§£å‹ï¼ˆæ³¨ï¼šå¦‚æœæ˜¯è™šæ‹Ÿæœºï¼Œä¸è¦åœ¨å…±äº«æ–‡ä»¶å¤¹ä¸­è§£å‹ï¼Œä¼šæŠ¥<code>Cannot create symlink to</code>åˆ›å»ºè½¯é“¾çš„é”™ï¼Œè¯·æ”¾è‡³linuxä¸‹è§£å‹ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> xz -d node-v8.11.3-linux-x64.tar.xz</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> tar -xvf node-v8.11.3-linux-x64.tar</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv node-v8.11.3-linux-x64 nodejs</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ç¡®è®¤ä¸€ä¸‹nodejsä¸‹binç›®å½•æ˜¯å¦æœ‰node å’Œnpmæ–‡ä»¶ï¼Œå¦‚æœæœ‰æ‰§è¡Œè½¯è¿æ¥ï¼Œå¦‚æœæ²¡æœ‰é‡æ–°ä¸‹è½½æ‰§è¡Œä¸Šè¾¹æ­¥éª¤ï¼›å»ºç«‹è½¯è¿æ¥ï¼Œå˜ä¸ºå…¨å±€:</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ln -s /opt/nodejs/bin/npm /usr/<span class="built_in">local</span>/bin/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ln -s /opt/nodejs/bin/node /usr/<span class="built_in">local</span>/bin/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> node -v</span></span><br></pre></td></tr></table></figure><h2 id="6-å¯åŠ¨ES"><a href="#6-å¯åŠ¨ES" class="headerlink" title="6. å¯åŠ¨ES"></a>6. å¯åŠ¨ES</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /opt/elasticsearch/elasticsearch-2.2.1</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> su elasticsearch</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ./bin/elasticsearch</span></span><br></pre></td></tr></table></figure><p>å†è®¿é—®<code>http://ip:9200/_plugin/head/</code>å³å¯ã€‚</p><h2 id="7-å®‰è£…IKåˆ†è¯å™¨"><a href="#7-å®‰è£…IKåˆ†è¯å™¨" class="headerlink" title="7. å®‰è£…IKåˆ†è¯å™¨"></a>7. å®‰è£…IKåˆ†è¯å™¨</h2><p>åœ¨<a href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p><p>æ­¤å¤„é€‰æ‹©ä¸esç‰ˆæœ¬å¯¹åº”çš„ikåˆ†è¯ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯<a href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v1.8.1/elasticsearch-analysis-ik-1.8.1.zip">elasticsearch-analysis-ik-1.8.1.zip</a>ï¼Œåœ¨ <code>/opt/elasticsearch/elasticsearch-2.2.1/plugins</code>ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹ï¼š<code>ik</code>;å°†<code>elasticsearch-analysis-ik-1.8.1.zip</code>çš„è§£å‹æ–‡ä»¶æ”¾å…¥<code>ik</code>ç›®å½•ä¸‹ï¼Œå¹¶å°†è§£å‹åçš„<code>config</code>ä¸‹çš„<code>ik</code>æ–‡ä»¶å¤¹æ”¾å…¥ <code>/opt/elasticsearch/elasticsearch-2.2.1/config</code>ä¸‹é¢;</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> unzip elasticsearch-analysis-ik-1.8.1.zip</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /opt/elasticsearch/elasticsearch-2.2.1/plugins</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir ik</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> cp -rf /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/ ik/</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mv /opt/elasticsearch/elasticsearch-analysis-ik-1.8.1/config/ik /opt/elasticsearch/elasticsearch-2.2.1/config</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> /opt/elasticsearch/elasticsearch-2.2.1/config</span></span><br></pre></td></tr></table></figure><p>åœ¨<code>/config/elasticsearch.yml</code>æ–‡ä»¶çš„æœ€ååŠ ä¸Šä¸€å¥è¯ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">index.analysis.analyzer.ik.type</span> : <span class="string">&quot;ik&quot;</span></span><br></pre></td></tr></table></figure><p>ç„¶åå¯åŠ¨esï¼Œæµ‹è¯•åˆ†è¯æ•ˆæœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;10.10.13.234:9200/index/_analyze?analyzer=ik&amp;pretty=true&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">&quot;text&quot;:&quot;ä¸–ç•Œå¦‚æ­¤ä¹‹å¤§ è¿›å£æ°´æœ&quot;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure><p>æˆ–è€…æµè§ˆå™¨è®¿é—®<code>http://ip:9200/_analyze?analyzer=ik&amp;pretty=true&amp;text=sojsonåœ¨çº¿å·¥å…·æµ‹è¯•åˆ†è¯</code>ï¼Œå³å¯çœ‹åˆ°ä¸­æ–‡åˆ†è¯æ•ˆæœã€‚</p><p>è‡³æ­¤ï¼Œelasticsearchæ­å»ºå®Œæˆï¼Œä¸‹ä¸€ç¯‡æˆ‘ä»¬æ¥è¯´ä¸‹<strong>ç´¢å¼•çš„åˆ›å»º</strong>ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/elasticsearch/">elasticsearch</category>
      
      
      <category domain="https://wonderomg.github.io/tags/elasticsearch/">elasticsearch</category>
      
      <category domain="https://wonderomg.github.io/tags/ik%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/">ikä¸­æ–‡åˆ†è¯</category>
      
      
      <comments>https://wonderomg.github.io/2018/05/15/Elasticsearch%E5%AE%9E%E8%B7%B5%E6%90%AD%E5%BB%BA%E5%8F%8AIK%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Packet for query is too large (84 &gt; -1).</title>
      <link>https://wonderomg.github.io/2018/03/15/Packet%20for%20query%20is%20too%20large/</link>
      <guid>https://wonderomg.github.io/2018/03/15/Packet%20for%20query%20is%20too%20large/</guid>
      <pubDate>Wed, 14 Mar 2018 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ibatiså·¥ç¨‹ä½¿ç”¨resiné…ç½®mysqlå‡ºç°&lt;code&gt;Packet for query is too large (84 &amp;gt; -1).&lt;/code&gt;é”™è¯¯ã€‚&lt;/p&gt;
&lt;p&gt;windowsä¸‹çš„resiné…ç½®è¿æ¥mysqlï¼Œå¸¸ç”¨çš„å®‰å…¨çš„åšæ³•æ˜¯å°†æ•°æ®åº“ä¿¡æ¯é…ç½®åˆ°confç›®å½•ä¸‹çš„resin.xmlæ–‡ä»¶ä¸­ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<p>ibatiså·¥ç¨‹ä½¿ç”¨resiné…ç½®mysqlå‡ºç°<code>Packet for query is too large (84 &gt; -1).</code>é”™è¯¯ã€‚</p><p>windowsä¸‹çš„resiné…ç½®è¿æ¥mysqlï¼Œå¸¸ç”¨çš„å®‰å…¨çš„åšæ³•æ˜¯å°†æ•°æ®åº“ä¿¡æ¯é…ç½®åˆ°confç›®å½•ä¸‹çš„resin.xmlæ–‡ä»¶ä¸­ã€‚<span id="more"></span></p><p>å› ä¸ºresinè¿æ¥mysqlä¸æ˜¯å¿…é¡»çš„ï¼Œæ‰€ä»¥resinæœ¬èº«æ²¡æœ‰æä¾›mysql-connectorçš„jaråŒ…ï¼Œéœ€è¦è‡ªå·±åŠ åˆ°resinç›®å½•ä¸‹çš„libé‡Œé¢ï¼Œæˆ‘åŠ äº†ä¸ª<code>mysql-connector-java-5.1.45-bin.jar</code>è¿›å»ï¼Œç„¶è€Œåœ¨è¿è¡Œå·¥ç¨‹æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢æ“ä½œçš„æ—¶å€™ï¼Œå´å‡ºç°äº†é—®é¢˜ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.dao.TransientDataAccessResourceException: SqlMapClient operation; SQL [];   </span><br><span class="line">--- The error occurred while applying a parameter map.  </span><br><span class="line">--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  </span><br><span class="line">--- Check the statement (query failed).  </span><br><span class="line">--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 &gt; -1). You can change this value on the server by setting the max_allowed_packet&#x27; variable.; nested exception is com.ibatis.common.jdbc.exception.NestedSQLException:   </span><br><span class="line">--- The error occurred while applying a parameter map.  </span><br><span class="line">--- Check the T_USER_INFO.selectByMap-InlineParameterMap.  </span><br><span class="line">--- Check the statement (query failed).  </span><br><span class="line">--- Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (84 &gt; -1). You can change this value on the server by setting the max_allowed_packet&#x27; variable.</span><br></pre></td></tr></table></figure><p>åªè¿›è¡ŒæŸ¥è¯¢å´å‡ºç°<code>Packet for query is too large</code>ï¼Œè€Œä¸”æŸ¥è¯¢çš„æ¡ä»¶åªæœ‰å‡ ä¸ªå­—æ¯ï¼Œç½‘ä¸Šæœäº†å¾ˆå¤šè§£ç­”ï¼Œéƒ½æ˜¯è¯´éœ€è¦æŠŠmysqlçš„<code>max_allowed_packet</code>å‚æ•°è°ƒå¤§ï¼Œä½†æ˜¯æˆ‘é€šè¿‡<code>show VARIABLES like &#39;%max_allowed_packet%&#39;;</code>æŸ¥è¯¢çš„ç»“æœä¹Ÿå¾ˆå¤§ï¼Œå¦‚æœæ˜¯å‚æ•°è¿‡å°ï¼Œåº”è¯¥æ˜¯æç¤ºå¤§äºæ•°æ®åº“ä¸­è®¾ç½®çš„packetçš„å€¼ï¼Œè€Œä¸åº”è¯¥æŠ¥-1ã€‚</p><p>æœ€åå‘ç°æœ‰ä¸ªå¸–å­è¯´æ˜¯<code>mysql-connector-java</code>jaråŒ…çš„ç‰ˆæœ¬é—®é¢˜ï¼Œç‰ˆæœ¬ä¸èƒ½å¤ªé«˜ï¼Œéšåæˆ‘å°†<code>mysql-connector-java-5.1.45-bin.jar</code>æ¢æˆ<code>mysql-connector-java-5.1.26-bin.jar</code>ï¼Œä¸å†å‡ºç°packeté”™è¯¯ï¼Œé—®é¢˜è§£å†³ã€‚</p><p>å¯èƒ½æ˜¯å› ä¸ºæˆ‘<strong>ç”¨çš„æ˜¯<code>ibatis2.0</code>ç‰ˆæœ¬çš„ç¼˜æ•…ï¼Œä¸æ”¯æŒå¤ªé«˜çš„mysqlè¿æ¥jarç‰ˆæœ¬</strong>ï¼Œæ¢æˆ<code>mysql-connector-java-5.1.40</code>ä»¥ä¸‹ç‰ˆæœ¬å³å¯è§£å†³<code>Packet for query is too large (84 &gt; -1)</code>é—®é¢˜ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/ibatis/">ibatis</category>
      
      <category domain="https://wonderomg.github.io/categories/ibatis/mysql/">mysql</category>
      
      <category domain="https://wonderomg.github.io/categories/ibatis/mysql/resin/">resin</category>
      
      
      <category domain="https://wonderomg.github.io/tags/zookeeper/">zookeeper</category>
      
      <category domain="https://wonderomg.github.io/tags/mysql/">mysql</category>
      
      <category domain="https://wonderomg.github.io/tags/ibatis/">ibatis</category>
      
      <category domain="https://wonderomg.github.io/tags/resin/">resin</category>
      
      
      <comments>https://wonderomg.github.io/2018/03/15/Packet%20for%20query%20is%20too%20large/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>zookeeperæç¤ºUnable to read additional data from server sessionid 0x</title>
      <link>https://wonderomg.github.io/2017/09/15/zookeeper%E6%8F%90%E7%A4%BAUnable%20to%20read%20additional%20data%20from%20server%20sessionid%200x/</link>
      <guid>https://wonderomg.github.io/2017/09/15/zookeeper%E6%8F%90%E7%A4%BAUnable%20to%20read%20additional%20data%20from%20server%20sessionid%200x/</guid>
      <pubDate>Thu, 14 Sep 2017 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;é…ç½®zookeeperé›†ç¾¤ï¼Œä¸€å¼€å§‹é…ç½®äº†ä¸¤å°æœºå™¨server.1å’Œserver.2ã€‚&lt;/p&gt;
&lt;p&gt;é…ç½®å‚æ•°ï¼Œåœ¨zoo.cfgä¸­æŒ‡å®šäº†æ•´ä¸ªzookeeperé›†ç¾¤çš„serverç¼–å·ã€åœ°å€å’Œç«¯å£ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;server.1=10.10.16.151:2888:3888&lt;br&gt;server.2=10.10.16.234:2888:3888&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç„¶åä¸ºè¿™ä¸¤ä¸ªä¸ªèŠ‚ç‚¹åˆ›å»ºå¯¹åº”çš„ç¼–å·æ–‡ä»¶ï¼Œåœ¨/tmp/zookeeper/data/myidæ–‡ä»¶ä¸­ã€‚å¦‚ä¸‹ï¼š</description>
      
      
      
      <content:encoded><![CDATA[<p>é…ç½®zookeeperé›†ç¾¤ï¼Œä¸€å¼€å§‹é…ç½®äº†ä¸¤å°æœºå™¨server.1å’Œserver.2ã€‚</p><p>é…ç½®å‚æ•°ï¼Œåœ¨zoo.cfgä¸­æŒ‡å®šäº†æ•´ä¸ªzookeeperé›†ç¾¤çš„serverç¼–å·ã€åœ°å€å’Œç«¯å£ï¼š</p><blockquote><p>server.1=10.10.16.151:2888:3888<br>server.2=10.10.16.234:2888:3888</p></blockquote><p>ç„¶åä¸ºè¿™ä¸¤ä¸ªä¸ªèŠ‚ç‚¹åˆ›å»ºå¯¹åº”çš„ç¼–å·æ–‡ä»¶ï¼Œåœ¨/tmp/zookeeper/data/myidæ–‡ä»¶ä¸­ã€‚å¦‚ä¸‹ï¼š<span id="more"></span></p><p>åœ¨server.1=10.10.16.151æœºå™¨ä¸Šæ‰§è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /tmp/zookeeper/data/myid</span><br></pre></td></tr></table></figure><p>åœ¨server.1=10.10.16.234æœºå™¨ä¸Šæ‰§è¡Œï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 2 &gt; /tmp/zookeeper/data/myid</span><br></pre></td></tr></table></figure><p>å¯åŠ¨server.1æµ‹è¯•dubboæœåŠ¡ï¼Œä½¿ç”¨<code>zkServer.sh start</code>å¯åŠ¨äº†server.1ï¼Œç„¶åä½¿ç”¨<code>zkServer.sh status</code>æŸ¥çœ‹å·¥ä½œçŠ¶æ€ï¼Œæ˜¾ç¤º</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error contacting service. It is probably not running.</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>zkCli.sh -server 10.10.16.151:2181</code>æŸ¥çœ‹æœåŠ¡è¯¦ç»†ï¼Œå‘ç°æœåŠ¡æç¤ºäº†ä¸‹é¢çš„é”™è¯¯ä¿¡æ¯ã€‚</p><p>å¯åŠ¨æ—¶æç¤ºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2017-09-15 14:57:27,139 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn<span class="variable">$SendThread</span>@1035] - Opening socket connection to server 10.10.16.151/10.10.16.151:2181. Will not attempt to authenticate using SASL (java.lang.SecurityException: ÏÂ·Â¨Â¶Â¨Î»ÂµÈ‚Â¼Æ¤×ƒ)</span><br><span class="line">2017-09-15 14:57:27,140 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn<span class="variable">$SendThread</span>@877] - Socket connection established to 10.10.16.151/10.10.16.151:2181, initiating session</span><br><span class="line">2017-09-15 14:57:27,143 [myid:] - INFO  [main-SendThread(10.10.16.151:2181):ClientCnxn<span class="variable">$SendThread</span>@1161] - Unable to <span class="built_in">read</span> additional data from server sessionid 0x0, likely server has closed socket, closing socket connection and attempting reconnect</span><br></pre></td></tr></table></figure><p>åæ¥æ‰ææ˜ç™½ï¼Œç”±äºæˆ‘åœ¨zoo.cfgä¸­é…ç½®äº†2å°æœºå™¨ï¼Œä½†æ˜¯åªå¯åŠ¨äº†1å°ï¼Œzookeeperå°±ä¼šè®¤ä¸ºæœåŠ¡å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</p><p><strong>é€šè¿‡zookeeperçš„é€‰ä¸¾ç®—æ³•å¾—çŸ¥ï¼Œå½“æ•´ä¸ªé›†ç¾¤è¶…è¿‡åŠæ•°æœºå™¨å®•æœºï¼Œzookeeperä¼šè®¤ä¸ºé›†ç¾¤å¤„äºä¸å¯ç”¨çŠ¶æ€ã€‚</strong>æ‰€ä»¥å¯åŠ¨2å°æœåŠ¡æ­£å¸¸ã€‚</p><p>ç„¶åæˆ‘åˆå¢åŠ äº†1å°<code>server.3=10.10.16.241:2888:3888</code>æœºå™¨èŠ‚ç‚¹ï¼Œåœ¨3å°éƒ½å¯åŠ¨çš„æƒ…å†µä¸‹ï¼Œå…³æ‰å…¶ä¸­1å°ï¼ŒæœåŠ¡æ­£å¸¸ï¼Œå…³æ‰2å°ï¼ŒæœåŠ¡ä¸å¯ç”¨ã€‚</p><p>æ‰€ä»¥ï¼Œzookeeperé›†ç¾¤åªå¯åŠ¨ä¸€å°æ— æ³•è¿æ¥ï¼Œå¦‚æœå¯åŠ¨æœºå™¨æ•°ä¸ºåŠæ•°åŠä»¥ä¸Šå°±å¯ä»¥è¿æ¥äº†ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/zookeeper/">zookeeper</category>
      
      
      <category domain="https://wonderomg.github.io/tags/zookeeper/">zookeeper</category>
      
      <category domain="https://wonderomg.github.io/tags/%E9%9B%86%E7%BE%A4/">é›†ç¾¤</category>
      
      
      <comments>https://wonderomg.github.io/2017/09/15/zookeeper%E6%8F%90%E7%A4%BAUnable%20to%20read%20additional%20data%20from%20server%20sessionid%200x/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>æ’å¤§ VS ä¸Šæ¸¯</title>
      <link>https://wonderomg.github.io/2017/09/12/%E6%81%92%E5%A4%A7%E4%B8%BB%E4%B8%8A%E6%B8%AF%E5%AE%A2/</link>
      <guid>https://wonderomg.github.io/2017/09/12/%E6%81%92%E5%A4%A7%E4%B8%BB%E4%B8%8A%E6%B8%AF%E5%AE%A2/</guid>
      <pubDate>Mon, 11 Sep 2017 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;âš½å¾ˆå°‘çœ‹ä¸­è¶…ï¼Œä¸‰çº¿ä¼ªçƒè¿·ï¼Œå¶å¾—ä¸€å¼ æ’å¤§å¯¹æˆ˜ä¸Šæ¸¯çš„ç¥¨ï¼Œäºšå† è”èµ›1/4å†³èµ›â€œä¸­å›½å¾·æ¯”â€ç¬¬äºŒå›åˆï¼Œéå¸¸å€¼å¾—ä¸€çœ‹ã€‚äºæ˜¯å’Œå³°å“¥å®ˆæƒ…çªç€å°äºŒè½®å„¿å°±å¾€å¤©æ²³ä½“è‚²ä¸­å¿ƒèµ¶ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>âš½å¾ˆå°‘çœ‹ä¸­è¶…ï¼Œä¸‰çº¿ä¼ªçƒè¿·ï¼Œå¶å¾—ä¸€å¼ æ’å¤§å¯¹æˆ˜ä¸Šæ¸¯çš„ç¥¨ï¼Œäºšå† è”èµ›1/4å†³èµ›â€œä¸­å›½å¾·æ¯”â€ç¬¬äºŒå›åˆï¼Œéå¸¸å€¼å¾—ä¸€çœ‹ã€‚äºæ˜¯å’Œå³°å“¥å®ˆæƒ…çªç€å°äºŒè½®å„¿å°±å¾€å¤©æ²³ä½“è‚²ä¸­å¿ƒèµ¶ã€‚</p><span id="more"></span><p>â€‹        é¦–å›åˆä¸Šæ¸¯ä¸»åœºåœ¨ä¸Šæµ·ï¼Œæ‰€ä»¥è¿™ä¸€å›åˆæ˜¯æ’å¤§å¹¿å·ä¸»åœºï¼Œç¬¬ä¸€å›åˆä¸Šæ¸¯4-0æ’å¤§ï¼Œæ‰€ä»¥è¿™ä¸€å›æ’å¤§åŠ¿å¿…ä¼šæ”»åŠ¿å¼ºåŠ²ã€‚è¿™å›è¦5-0ä¸Šæ¸¯æ‰èƒ½èµ¢å¾—è¿™æ¬¡æ¯”èµ›ã€‚</p><p>åœºå¤–ä¹°äº†ä»¶é˜¿å…°çš„7å·çƒè¡£ã€‚</p><p><img src="https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/7th.jpg" alt="7th"></p><p>æ¯”èµ›å¼€å§‹äº†ã€‚</p><p><img src="https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/start.jpg" alt="start"></p><p>å¤´ä¸€å›é çƒè¿·åä¼šè¿™ä¹ˆè¿‘ï¼Œæ•´åœºçƒè¿·åä¼šéƒ½åœ¨èµ·åŠ¿åŠ©å¨ï¼Œæ„Ÿå—åˆ°äº†ä»–ä»¬çœŸçš„å¾ˆçˆ±æ’å¤§ï¼Œçƒ­çˆ±è¶³çƒã€‚</p><p>æˆ‘ç­‰åå…«çº¿çƒè¿·ä¹Ÿå°±æ˜¯åœ¨è¿›çƒæ—¶äº¢å¥‹åç§’ï¼Œä¸¢ï¼</p><p><img src="https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/fans.jpg" alt="fans"></p><p>æ•´åœºä¸‹æ¥ï¼Œä¸Šæ¸¯é˜Ÿé˜Ÿå‘˜å—ä¼¤æ¢ä¸‹çš„çƒå‘˜ä¸ä¸‹4ä¸ªï¼Œä¸€ä¸ªæ˜¯éƒ¨åˆ†çƒå‘˜çŠ¶æ€ä¸å¤ªå¥½ï¼ŒäºŒæ˜¯æ’å¤§é˜Ÿå‘˜å¤„äºå‹åŠ›è¸¢çš„å¤ªæ¿€è¿›ã€‚</p><p>ç¬¬90åˆ†é’Ÿï¼Œæå­¦é¹å¤´çƒç ´é—¨ï¼Œå¹¿å·æ’å¤§4-0ä¸Šæµ·ä¸Šæ¸¯ï¼</p><p>çƒè¿·ä»¬åˆæ˜¯ä¸€é˜µäº¢å¥‹ï¼æˆ‘ä¹Ÿç‰¹æ¿€åŠ¨ï¼Œæ„Ÿè§‰ä¸»åœºæ¥ä¸ª5-0å°±èµ¢äº†ï¼Œçœ‹æ¥èƒœåˆ©ä¸è¿œäº†ï¼Œé‚£ä¸ªæ¿€åŠ¨å•Šï¼ŒçœŸåˆ‡æ„Ÿå—åˆ°äº†è¶³çƒçš„é­…åŠ›ã€‚</p><p>å¯æ˜¯ï¼Œæœ€æ€•è¿™ä¸ªå¯æ˜¯äº†ã€‚</p><p>ç¬¬109åˆ†é’Ÿï¼Œä¸Šæ¸¯é˜Ÿèƒ¡å°”å…‹ä¸»ç½šçš„çˆ†å°„ç›´é’»ç½‘çªæ­»è§’ï¼Œå¹¿å·æ’å¤§4-1ä¸Šæµ·ä¸Šæ¸¯ï¼æ’å¤§å‹åŠ›å¾ˆå¤§ï¼Œç©†é‡Œå¥‡è¢«ä¸Šæ¸¯é˜Ÿå‘˜æ‹‰å€’ï¼Œè¢«ç½šç‚¹çƒï¼Œé«˜æ‹‰ç‰¹ä¸»ç½šå‘½ä¸­ï¼Œ5-1æ‰“å¹³äº†ï¼Œæ‚¬çš„å¿ƒåˆæ”¾ä¸‹äº†ã€‚</p><p>å¸¸è§„èµ›ç»“æŸï¼Œæ¯”èµ›è¿›å…¥åŠ æ—¶ï¼Œ5-1ï¼Œé˜¿å…°è¿›ä¿©çƒï¼Œé«˜æ‹‰ç‰¹è¿›3çƒã€‚å‹åŠ›å·²ç»åœ¨æ’å¤§é˜Ÿè¿™è¾¹äº†ï¼ŒåŠ æ—¶èµ›5:1ï¼Œæ€»æ¯”åˆ†æ’å¤§5-5æˆ˜å¹³ä¸Šæ¸¯ï¼Œæœªåˆ†èƒœè´Ÿï¼Œæ‰€ä»¥å‘¢ï¼Œå°±åˆ°äº†ç²¾å½©çš„ç‚¹çƒå¤§æˆ˜ã€‚åˆæ˜¯åŠ æ—¶ï¼Œåˆæ˜¯ç‚¹çƒï¼ŒåŒæ–¹éƒ½ç´§å’¬æ¯”åˆ†ã€‚</p><p><img src="https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/penaltykick.jpg" alt="penaltykick"></p><p>ä¸å¹¸çš„æ˜¯ï¼Œç‚¹çƒä¸Šæ¸¯é˜Ÿ5ç½š5ä¸­ï¼Œæ’å¤§é˜Ÿ5ç½š4ä¸­ï¼Œå…¨åœºæ¯”èµ›ç»“æŸï¼Œæ€»æ¯”åˆ†ä¸Šæµ·ä¸Šæ¸¯10-9æ·˜æ±°å¹¿å·æ’å¤§ã€‚</p><p>ä¸€æ³¢ä¸‰æŠ˜ï¼Œå¸¸è§„èµ›ä»¥ä¸ºè¦è¾“äº†ï¼Œç„¶ååˆèµ¢äº†ï¼ŒåŠ æ—¶åŠ ä¸Šç‚¹çƒï¼Œä»¥ä¸ºè¦èµ¢äº†ï¼Œç»“æœè¿˜æ˜¯è¾“äº†ã€‚æ’å¤§çƒå‘˜çš„æ‹¼åŠ²æœ‰ç›®å…±ç¹ï¼Œæ•´åœºçƒçœŸçš„å¾ˆç²¾å½©ï¼Œç°åœºçœ‹çƒï¼Œä¸ç®¡æ˜¯çƒå‘˜è¿˜æ˜¯çƒè¿·å¸¦ç»™äººçš„éƒ½æ˜¯ç‰¹åˆ«æ„ŸåŠ¨æ¿€æ˜‚çš„æ„Ÿå—ï¼Œå°½ç®¡å¹¿å·å¾ˆçƒ­ï¼Œç°åœºçš„çƒ­æƒ…å®Œå…¨æ©ç›–äº†çƒåœºå†…çš„çƒ­æµªã€‚</p><p>æœ€åå›è°¢çƒè¿·ã€‚</p><p><img src="https://raw.githubusercontent.com/wonderomg/wonderomg.github.io/master/img/thank.jpg" alt="thank"></p><p>æ’å¤§é˜Ÿï¼Œè™½è´¥çŠ¹è£ï¼</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/%E9%9A%8F%E8%AE%B0/">éšè®°</category>
      
      
      <category domain="https://wonderomg.github.io/tags/%E9%9A%8F%E8%AE%B0/">éšè®°</category>
      
      
      <comments>https://wonderomg.github.io/2017/09/12/%E6%81%92%E5%A4%A7%E4%B8%BB%E4%B8%8A%E6%B8%AF%E5%AE%A2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>linux-crontabå®šæ—¶æ‰§è¡Œä»»åŠ¡</title>
      <link>https://wonderomg.github.io/2017/07/25/linux-crontab%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1/</link>
      <guid>https://wonderomg.github.io/2017/07/25/linux-crontab%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1/</guid>
      <pubDate>Mon, 24 Jul 2017 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ã€€ã€€â±ï¸æœ€è¿‘ç¢°åˆ°ä¸€ä¸ªå…³äº&lt;code&gt;crontab&lt;/code&gt;çš„é—®é¢˜ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ã€€ã€€â±ï¸æœ€è¿‘ç¢°åˆ°ä¸€ä¸ªå…³äº<code>crontab</code>çš„é—®é¢˜ã€‚</p><span id="more"></span><h2 id="1-äº‹å› "><a href="#1-äº‹å› " class="headerlink" title="1. äº‹å› "></a><strong>1. äº‹å› </strong></h2><p>æœåŠ¡å™¨éƒ¨ç½²äº†ä¸€ä¸ª<code>C++</code>æŸ¥è¯¢æ•°æ®åº“è¯åº“çš„æœåŠ¡ï¼Œä»¥åŠ<code>Java</code>å‘é€ç›®æ ‡è¯çš„æœåŠ¡ï¼Œ<code>Java</code>æœåŠ¡é€šè¿‡<code>soket</code>é•¿è¿æ¥å‘<code>C++</code>æœåŠ¡å‘é€ç›®æ ‡å•è¯ï¼Œç„¶å<code>C++</code>æœåŠ¡è¿”å›æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨çš„ç»“æœã€‚</p><p>æœŸé—´ï¼Œç”±äºæ•°æ®åº“æœ‰æ—¶å¢åŠ å•è¯éœ€è¦é‡å¯æœåŠ¡ï¼Œæ‰‹å†™äº†ä¸ªå®šæ—¶è„šæœ¬æ¥é‡å¯è¯¥<code>C++</code>æœåŠ¡ã€‚</p><p>æŸä¸€æ¬¡ä¸ºäº†è°ƒè¯•ï¼ŒæŠŠæ”¹å®šæ—¶è„šæœ¬å…³äº†ï¼Œé€šè¿‡<code>ps -ef |grep xxx</code>å‘½ä»¤æŸ¥çœ‹æœåŠ¡çˆ¶å­è¿›ç¨‹æƒ…å†µï¼Œå‘ç°çˆ¶è¿›ç¨‹è¿˜æ˜¯æ¯éš”ååˆ†é’Ÿé€€å‡ºï¼ŒæœåŠ¡ä¼šé‡å¯ï¼Œæƒ³äº†è®¸ä¹…ä¸çŸ¥é“å“ªå‡ºäº†é—®é¢˜ã€‚</p><p>æœ€åè¯¢é—®è¿ç»´æ‰æƒ³èµ·ï¼Œä¹‹å‰è¿˜ç”¨äº†<code>linux</code>è‡ªå¸¦çš„<code>crontab</code>è®¾ç½®è¿‡æ¯éš”ååˆ†é’Ÿé‡å¯æœåŠ¡ï¼Œæ²¡æœ‰åˆ é™¤<code>crontab</code>é‡Œé¢çš„é‚£æ¡è®¾ç½®ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸€ä¸‹<code>linux</code>è‡ªå¸¦çš„å¯è®¾ç½®å®šæ—¶æŒ‡å®šä»»åŠ¡çš„<code>crontab</code>ã€‚</p><h2 id="2-åˆè¯†crontab"><a href="#2-åˆè¯†crontab" class="headerlink" title="2. åˆè¯†crontab"></a><strong>2. åˆè¯†crontab</strong></h2><p><code>cron</code>æ˜¯ä¸€ä¸ªæœåŠ¡è¿›ç¨‹ï¼Œ<code>cron</code>æœåŠ¡æä¾›<code>crontab</code>å‘½ä»¤æ¥è®¾å®š<code>cron</code>æœåŠ¡çš„ï¼Œä»¥ä¸‹æ˜¯è¿™ä¸ªå‘½ä»¤çš„ä¸€äº›å‚æ•°ä¸è¯´æ˜ï¼š</p><ul><li><code>crontab -u  //è®¾å®šæŸä¸ªç”¨æˆ·çš„cronæœåŠ¡ï¼Œä¸€èˆ¬rootç”¨æˆ·åœ¨æ‰§è¡Œè¿™ä¸ªå‘½ä»¤çš„æ—¶å€™éœ€è¦æ­¤å‚æ•° </code></li><li><code>crontab -l  //åˆ—å‡ºæŸä¸ªç”¨æˆ·cronæœåŠ¡çš„è¯¦ç»†å†…å®¹ </code></li><li><code>crontab -r  //åˆ é™¤æŸä¸ªç”¨æˆ·çš„cronæœåŠ¡ </code></li><li><code>crontab -e  //ç¼–è¾‘æŸä¸ªç”¨æˆ·çš„cronæœåŠ¡ </code></li></ul><h2 id="3-åŸºæœ¬ç”¨æ³•"><a href="#3-åŸºæœ¬ç”¨æ³•" class="headerlink" title="3. åŸºæœ¬ç”¨æ³•"></a><strong>3. åŸºæœ¬ç”¨æ³•</strong></h2><p>åŸºæœ¬æ ¼å¼ :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*   *   *   *   *   command</span><br></pre></td></tr></table></figure><p>â€‹    **åˆ†ã€€æ—¶ã€€æ—¥ã€€æœˆã€€å‘¨ã€€å‘½ä»¤ **</p><p>ç¬¬1åˆ—è¡¨ç¤ºåˆ†é’Ÿ1ï½59 æ¯åˆ†é’Ÿç”¨*æˆ–è€… */1è¡¨ç¤º ï¼›<br>ç¬¬2åˆ—è¡¨ç¤ºå°æ—¶1ï½23ï¼ˆ0è¡¨ç¤º0ç‚¹ï¼‰ ï¼›<br>ç¬¬3åˆ—è¡¨ç¤ºæ—¥æœŸ1ï½31 ï¼›<br>ç¬¬4åˆ—è¡¨ç¤ºæœˆä»½1ï½12 ï¼›<br>ç¬¬5åˆ—æ ‡è¯†å·æ˜ŸæœŸ0ï½6ï¼ˆ0è¡¨ç¤ºæ˜ŸæœŸå¤©ï¼‰ ï¼›<br>ç¬¬6åˆ—è¦è¿è¡Œçš„å‘½ä»¤ ã€‚</p><p><code>crontab</code>çš„ä¸€äº›ä½¿ç”¨ä¾‹å­:</p><p><code>*/10 * * * * (cd /opt/resin/bin; ./resin.sh restart)</code></p><p>è¡¨ç¤ºæ¯éš”10åˆ†é‡å¯<code>resin</code>æœåŠ¡ï¼›</p><p><code>30 1 * * * (cd /opt/resin/bin; ./resin.sh restart)</code></p><p>è¡¨ç¤ºæ¯å¤©1ç‚¹30åˆ†é‡å¯<code>resin</code>æœåŠ¡ï¼›</p><p><code>* 23-5/1 * * * (cd /opt/resin/bin; ./resin.sh restart)</code></p><p>è¡¨ç¤ºæ¯å¤©23ç‚¹åˆ°æ¬¡æ—¥5ç‚¹ä¹‹é—´æ¯éš”1å°æ—¶é‡å¯<code>resin</code>æœåŠ¡ï¼›</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/linux/">linux</category>
      
      
      <category domain="https://wonderomg.github.io/tags/crontab/">crontab</category>
      
      
      <comments>https://wonderomg.github.io/2017/07/25/linux-crontab%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ideaæ­å»ºspringdata+mongodb+maven+springmvc</title>
      <link>https://wonderomg.github.io/2017/06/06/idea%E6%90%AD%E5%BB%BAspringdata+mongodb+maven+springmvc/</link>
      <guid>https://wonderomg.github.io/2017/06/06/idea%E6%90%AD%E5%BB%BAspringdata+mongodb+maven+springmvc/</guid>
      <pubDate>Mon, 05 Jun 2017 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹SpringDataæ“ä½œMongoDBã€‚&lt;br&gt;é¡¹ç›®ç¯å¢ƒï¼šIntelliJ IDEA2017+maven3.5.0+MongoDB 3.2+JDK1.7+spring4.3.8</description>
      
      
      
      <content:encoded><![CDATA[<p>ä»Šå¤©æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹SpringDataæ“ä½œMongoDBã€‚<br>é¡¹ç›®ç¯å¢ƒï¼šIntelliJ IDEA2017+maven3.5.0+MongoDB 3.2+JDK1.7+spring4.3.8 <span id="more"></span></p><p>æ¨èç½‘ç«™ï¼ˆé€‚åˆå­¦ä¹ å„ç§çŸ¥è¯†çš„åŸºç¡€ï¼‰ï¼š<a href="http://www.runoob.com/">http://www.runoob.com/</a></p><p>mongoå®‰è£…è¯·å‚è€ƒï¼š<a href="http://www.runoob.com/mongodb/mongodb-window-install.html">http://www.runoob.com/mongodb/mongodb-window-install.html</a></p><h2 id="1-åˆ›å»ºmavenå·¥ç¨‹"><a href="#1-åˆ›å»ºmavenå·¥ç¨‹" class="headerlink" title="1. åˆ›å»ºmavenå·¥ç¨‹"></a><strong>1. åˆ›å»ºmavenå·¥ç¨‹</strong></h2><p>é¦–ç›¸åˆ›å»ºmavenå·¥ç¨‹ï¼ŒNew project:<br><img src="https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-1.png" alt="åˆ›å»ºmavenå·¥ç¨‹"></p><p><img src="https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-2.png" alt="è‡ªè¡Œå¡«å†™"></p><p>è¿™é‡Œä¸ä½¿ç”¨ideaè‡ªå¸¦mavenæ’ä»¶ï¼Œæ”¹ç”¨ä¸‹è½½å¥½çš„3.5.0ç‰ˆmavenï¼›</p><p>ç”±äºæœ€è¿‘osChinaçš„mavenä»“åº“æŒ‚æ‰ï¼Œæ¨èå¤§å®¶ä½¿ç”¨é˜¿é‡Œçš„é•œåƒï¼Œé€Ÿåº¦å¿«çš„é£èµ·<br><code>maven</code>é…ç½®ï¼š<code>D:\apache-maven-3.5.0\conf\setting.xml</code>ä¸­æ‰¾åˆ°<code>mirrors</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-3.png" alt="é€‰æ‹©ä¸‹å¥½çš„æœ¬åœ°maven3.5.0"></p><p><img src="https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-4.png" alt="next"></p><p>é¡¹ç›®ç»“æ„å¦‚ä¸‹å›¾ï¼Œæ‰‹åŠ¨åˆ›å»ºç›¸å…³æ–‡ä»¶å¤¹åŠæ–‡ä»¶ï¼Œå¹¶è®¾ç½®æ–‡ä»¶å¤¹çš„å¯¹åº”å±æ€§ï¼š</p><p><img src="https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-5.png" alt="å·¥ç¨‹ç›®å½•"></p><p><img src="https://raw.githubusercontent.com/wonderomg/SpringData-mongdb/master/images/create-6.png" alt="ç›®å½•ç»“æ„"></p><p>è‡³æ­¤ï¼Œmavenå·¥ç¨‹åˆ›å»ºå®Œæ¯•ã€‚</p><h2 id="2-è®¿é—®mongodbæ•°æ®æ–¹å¼"><a href="#2-è®¿é—®mongodbæ•°æ®æ–¹å¼" class="headerlink" title="2. è®¿é—®mongodbæ•°æ®æ–¹å¼"></a><strong>2. è®¿é—®mongodbæ•°æ®æ–¹å¼</strong></h2><p>è¿™é‡Œ<code>dao</code>ä¸<code>mongoDao</code>åˆ†åˆ«ä¸º<code>mongoDB</code>çš„ä¸¤ç§æŸ¥è¯¢æ–¹å¼ï¼š</p><blockquote><p>(1) <code>dao</code>ä¸º<code>JPA</code>çš„æŸ¥è¯¢æ–¹å¼ï¼ˆè¯·å‚è€ƒ<code>springdataJPA</code>ï¼‰ï¼›</p><p>(2) <code>mongoDao</code>ä½¿ç”¨<code>mongoTemplate</code>ï¼Œç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä½¿ç”¨çš„<code>jdbcTemplate</code>ã€‚</p></blockquote><h2 id="3-è¯¦ç»†ä»£ç "><a href="#3-è¯¦ç»†ä»£ç " class="headerlink" title="3. è¯¦ç»†ä»£ç "></a><strong>3. è¯¦ç»†ä»£ç </strong></h2><p>å…ˆçœ‹é…ç½®æ–‡ä»¶<br>spring-context.xmlä¸ºæœ€åŸºæœ¬çš„<code>spring</code>é…ç½®:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¼€å¯æ³¨è§£ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ‰«æserviceåŒ…å—²æ‰€æœ‰ä½¿ç”¨æ³¨è§£çš„ç±»å‹--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lewis.mongo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å¯¼å…¥mongodbçš„é…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-mongo.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>spring-web.xmlä¸º<code>springmvc</code>çš„åŸºæœ¬é…ç½®:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®springmvc--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1.å¼€å¯springmvcæ³¨è§£æ¨¡å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç®€åŒ–é…ç½®ï¼š</span></span><br><span class="line"><span class="comment">        (1)ä¸»åŠ¨æ³¨å†ŒDefaultAnnotationHandlerMapping,AnnotationMethodHandlerAdapter</span></span><br><span class="line"><span class="comment">        (2)æä¾›ä¸€ç³»åˆ—åŠŸèƒ½ï¼šæ•°æ®ç»‘å®šï¼Œæ•°å­—å’Œæ—¥æœŸçš„format @NumberFormt @DataTimeFormatï¼Œxml jsoné»˜è®¤çš„è¯»å†™æ”¯æŒ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--servlet-mapping--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2é™æ€èµ„æºé»˜è®¤çš„servleté…ç½®ï¼Œ</span></span><br><span class="line"><span class="comment">        ï¼ˆ1ï¼‰å…è®¸å¯¹é™æ€èµ„æºçš„å¤„ç†ï¼šjsï¼Œgif</span></span><br><span class="line"><span class="comment">        ï¼ˆ2ï¼‰å…è®¸ä½¿ç”¨â€œ/â€åšæ•´ä½“æ˜ å°„--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å®¹å™¨é»˜è®¤çš„DefaultServletHandlerå¤„ç† æ‰€æœ‰é™æ€å†…å®¹ä¸æ— RequestMappingå¤„ç†çš„URL--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--3:é…ç½®jsp æ˜¾ç¤ºviewResolver--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;viewClass&quot;</span> <span class="attr">value</span>=<span class="string">&quot;org.springframework.web.servlet.view.JstlView&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4è‡ªåŠ¨æ‰«æä¸”åªæ‰«æ@Controller --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lewis.mongo.controller&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- å®šä¹‰æ— éœ€Controllerçš„url&lt;-&gt;viewç›´æ¥æ˜ å°„ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:view-controller</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">view-name</span>=<span class="string">&quot;redirect:/hi/hello&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>spring-mongo.xmlä¸ºmongoé…ç½®:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mongo</span>=<span class="string">&quot;http://www.springframework.org/schema/data/mongo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/data/mongo</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/data/mongo/spring-mongo.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- åŠ è½½mongodbçš„å±æ€§é…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath*:mongo.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- springè¿æ¥mongodbæ•°æ®åº“çš„é…ç½® --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mongo:mongo-client</span> <span class="attr">replica-set</span>=<span class="string">&quot;$&#123;mongo.hostport&#125;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;mongo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mongo:client-options</span> <span class="attr">connections-per-host</span>=<span class="string">&quot;$&#123;mongo.connectionsPerHost&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">threads-allowed-to-block-for-connection-multiplier</span>=<span class="string">&quot;$&#123;mongo.threadsAllowedToBlockForConnectionMultiplier&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">connect-timeout</span>=<span class="string">&quot;$&#123;mongo.connectTimeout&#125;&quot;</span> <span class="attr">max-wait-time</span>=<span class="string">&quot;$&#123;mongo.maxWaitTime&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                              <span class="attr">socket-timeout</span>=<span class="string">&quot;$&#123;mongo.socketTimeout&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mongo:mongo-client</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mongoçš„å·¥å‚ï¼Œé€šè¿‡å®ƒæ¥å–å¾—mongoå®ä¾‹,dbnameä¸ºmongodbçš„æ•°æ®åº“åï¼Œæ²¡æœ‰çš„è¯ä¼šè‡ªåŠ¨åˆ›å»º --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mongo:db-factory</span> <span class="attr">id</span>=<span class="string">&quot;mongoDbFactory&quot;</span> <span class="attr">dbname</span>=<span class="string">&quot;mongoLewis&quot;</span> <span class="attr">mongo-ref</span>=<span class="string">&quot;mongo&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- åªè¦ä½¿ç”¨è¿™ä¸ªè°ƒç”¨ç›¸åº”çš„æ–¹æ³•æ“ä½œ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mongoTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.data.mongodb.core.MongoTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;mongoDbFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;mongoDbFactory&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mongodb beançš„ä»“åº“ç›®å½•ï¼Œä¼šè‡ªåŠ¨æ‰«ææ‰©å±•äº†MongoRepositoryæ¥å£çš„æ¥å£è¿›è¡Œæ³¨å…¥ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mongo:repositories</span> <span class="attr">base-package</span>=<span class="string">&quot;com.lewis.mongo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>mongo.properties:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mongo.hostport</span>=<span class="string">10.10.16.234:27017  </span></span><br><span class="line"><span class="meta">mongo.connectionsPerHost</span>=<span class="string">8  </span></span><br><span class="line"><span class="meta">mongo.threadsAllowedToBlockForConnectionMultiplier</span>=<span class="string">4  </span></span><br><span class="line"><span class="comment">#è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">mongo.connectTimeout</span>=<span class="string">1000  </span></span><br><span class="line"><span class="comment">#ç­‰å¾…æ—¶é—´</span></span><br><span class="line"><span class="meta">mongo.maxWaitTime</span>=<span class="string">1500  </span></span><br><span class="line"><span class="meta">mongo.autoConnectRetry</span>=<span class="string">true  </span></span><br><span class="line"><span class="meta">mongo.socketKeepAlive</span>=<span class="string">true  </span></span><br><span class="line"><span class="comment">#Socketè¶…æ—¶æ—¶é—´</span></span><br><span class="line"><span class="meta">mongo.socketTimeout</span>=<span class="string">1500  </span></span><br><span class="line"><span class="meta">mongo.slaveOk</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure><p>pom.xmlï¼Œè¿™é‡Œè¦æ³¨æ„çš„æ˜¯<code>junit</code>ç‰ˆæœ¬éœ€è¦4.12ä»¥ä¸Šï¼Œä¸ç„¶ideaä¼šæŠ¥é”™ï¼›<code>spring-data-mongodb</code>ç‰ˆæœ¬è¦1.10.1ä»¥ä¸Šï¼›</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring-framework-bom ç‰ˆæœ¬å·--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.3.8.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.liu<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mongo Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--ä½¿ç”¨junit4ï¼Œæ³¨è§£çš„æ–¹å¼æµ‹è¯•--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;junit&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;4.11&lt;/version&gt;</span></span><br><span class="line"><span class="comment">            &lt;scope&gt;test&lt;/scope&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--æ—¥å¿—--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ—¥å¿— slf4j,log4j,logback,common-logging--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--slf4jæ˜¯è§„èŒƒ/æ¥å£--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--log4j,logback,common-loggingæ˜¯æ—¥å¿—å®ç° æœ¬é¡¹ç›®ä½¿ç”¨slf4j + logback --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å®ç°slf4jå¹¶æ•´åˆ--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ•°æ®åº“ç›¸å…³--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--mavenå·¥ä½œèŒƒå›´ é©±åŠ¨åœ¨çœŸæ­£å·¥ä½œçš„æ—¶å€™ä½¿ç”¨ï¼Œæ•…ç”Ÿå‘½å‘¨æœŸæ”¹ä¸ºruntime--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--servlet webç›¸å…³ jstl1.2ä»¥ä¸Šç‰ˆæœ¬å°±ä¸éœ€è¦standardè¿™ä¸ªåŒ…äº†ï¼Œ</span></span><br><span class="line"><span class="comment">        ä¸ç„¶ä¼šæŠ¥é”™ï¼š TLD skipped. URI: http://java.sun.com/jstl/core_rt is already defined--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;taglibs&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;standard&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;1.1.2&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--spring--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--springæ ¸å¿ƒ--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-asm --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-asm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring dao--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;spring-data-mongodb&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;1.8.0.RELEASE&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.data/spring-data-mongodb --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.1.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mongodb<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mongo-java-driver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-aop --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring web--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring test--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-collections<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax/javaee-api --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javaee-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-framework-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sf.ehcache<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ehcache-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>mongo<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸¤ä¸ªå®ä½“ç±»ï¼š</p><p>Address.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lewis.mongo.entity;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by liu on 2017/6/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String street;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Address</span><span class="params">(String city, String street, <span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.city = city;</span><br><span class="line">        <span class="keyword">this</span>.street = street;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCity</span><span class="params">(String city)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.city = city;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> street;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStreet</span><span class="params">(String street)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.street = street;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNum</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Address&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;city=&#x27;&quot;</span> + city + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, street=&#x27;&quot;</span> + street + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, num=&quot;</span> + num + <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Person.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lewis.mongo.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.bson.types.ObjectId;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.annotation.Id;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by liu on 2017/6/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Document(collection = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> ObjectId id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age, Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObjectId <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(ObjectId id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> + <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, address=&quot;</span> + address + <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JPAçš„daoï¼Œæ³¨æ„è¿™é‡Œåªè¦ç»§æ‰¿MongoRepositoryä¸ç”¨å†™æ³¨è§£springå°±èƒ½è®¤è¯†è¿™æ˜¯ä¸ªRepositoryï¼ŒMongoRepositoryæä¾›äº†åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼Œä¸ç”¨å®ç°ä¾¿å¯ç›´æ¥è°ƒç”¨ï¼Œä¾‹å¦‚testMongoçš„personDao.save(persons);</p><p>PersonDao.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lewis.mongo.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lewis.mongo.entity.Person;</span><br><span class="line"><span class="keyword">import</span> org.bson.types.ObjectId;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.repository.Query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by liu on 2017/6/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonDao</span> <span class="keyword">extends</span> <span class="title">MongoRepository</span>&lt;<span class="title">Person</span>, <span class="title">ObjectId</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Query(value = &quot;&#123;&#x27;age&#x27; : &#123;&#x27;$gte&#x27; : ?0, &#x27;$lte&#x27; : ?1&#125;, &#x27;name&#x27; : ?2&#125;&quot;, fields = &quot;&#123;&#x27;name&#x27; : 1, &#x27;age&#x27; : 1&#125;&quot;)</span></span><br><span class="line">    <span class="function">List&lt;Person&gt; <span class="title">findByAge</span><span class="params">(<span class="keyword">int</span> age1, <span class="keyword">int</span> age2, String name)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>mongoTemplateçš„daoï¼ŒPersonMongoDao.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lewis.mongo.mongoDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lewis.mongo.entity.Person;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by liu on 2017/6/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonMongoDao</span> </span>&#123;</span><br><span class="line">    <span class="function">List&lt;Person&gt; <span class="title">findAll</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insertPerson</span><span class="params">(Person user)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removePerson</span><span class="params">(String userName)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updatePerson</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">List&lt;Person&gt; <span class="title">findForRequery</span><span class="params">(String userName)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PersonMongoImpl.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.lewis.mongo.mongoDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.lewis.mongo.entity.Person;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Query;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Update;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by liu on 2017/6/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository(&quot;personMongoImpl&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonMongoImpl</span> <span class="keyword">implements</span> <span class="title">PersonMongoDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mongoTemplate.findAll(Person.class, <span class="string">&quot;person&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertPerson</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">        mongoTemplate.insert(person, <span class="string">&quot;person&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removePerson</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        mongoTemplate.remove(Query.query(Criteria.where(<span class="string">&quot;name&quot;</span>).is(userName)), <span class="string">&quot;person&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updatePerson</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mongoTemplate.updateMulti(Query.query(Criteria.where(<span class="string">&quot;age&quot;</span>).gt(<span class="number">3</span>).lte(<span class="number">5</span>)), Update.update(<span class="string">&quot;age&quot;</span>, <span class="number">3</span>), <span class="string">&quot;person&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Person&gt; <span class="title">findForRequery</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mongoTemplate.find(Query.query(Criteria.where(<span class="string">&quot;name&quot;</span>).is(userName)), Person.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>JPAæŸ¥è¯¢çš„æµ‹è¯•ç±»ï¼ŒPersonDaoTest.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.lewis.mongo.dao.PersonDao;</span><br><span class="line"><span class="keyword">import</span> com.lewis.mongo.entity.Address;</span><br><span class="line"><span class="keyword">import</span> com.lewis.mongo.entity.Person;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by liu on 2017/6/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//å‘Šè¯‰junit springé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&#123;&quot;classpath:spring/spring-context.xml&quot;, &quot;classpath:spring/spring-mongo.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonDaoTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PersonDao personDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*å…ˆå¾€æ•°æ®åº“ä¸­æ’å…¥10ä¸ªperson*/</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMongo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;Person&gt; persons = <span class="keyword">new</span> ArrayList&lt;Person&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            persons.add(<span class="keyword">new</span> Person(<span class="string">&quot;name&quot;</span> + i, i, <span class="keyword">new</span> Address(<span class="string">&quot;å¹¿å·å¸‚&quot;</span>, <span class="string">&quot;å¤©æ²³åŒº&quot;</span>, i)));</span><br><span class="line">        &#125;</span><br><span class="line">        personDao.save(persons);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findMongo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(personDao.findByAge(<span class="number">2</span>, <span class="number">8</span>, <span class="string">&quot;name6&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mongoTemplateæŸ¥è¯¢çš„æµ‹è¯•ç±»ï¼ŒMongoTemplateTest.java:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.lewis.mongo.entity.Address;</span><br><span class="line"><span class="keyword">import</span> com.lewis.mongo.entity.Person;</span><br><span class="line"><span class="keyword">import</span> com.lewis.mongo.mongoDao.PersonMongoImpl;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by liu on 2017/6/7.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//å‘Šè¯‰junit springé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="meta">@ContextConfiguration(&#123;&quot;classpath:spring/spring-context.xml&quot;, &quot;classpath:spring/spring-mongo.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MongoTemplateTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> PersonMongoImpl personMongo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMongoTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//personMongo.insertPerson(new Person(&quot;Lewis&quot;,24,new Address(&quot;å¹¿å·&quot;,&quot;å¤©æ²³&quot;,20)));</span></span><br><span class="line">        personMongo.removePerson(<span class="string">&quot;name3&quot;</span>);</span><br><span class="line">        personMongo.updatePerson();</span><br><span class="line">        System.out.println(personMongo.findAll());</span><br><span class="line">        System.out.println(personMongo.findForRequery(<span class="string">&quot;Lewis&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„æµ‹è¯•å‰è¯·å…ˆé€šè¿‡<code>PersonDaoTest.java</code>ä¸­çš„<code>testMongo()</code>æ–¹æ³•å‘æ•°æ®åº“ä¸­æ’å…¥æ•°æ®ã€‚</strong></p></blockquote><ul><li><strong>é¡¹ç›®æºç Gitåœ°å€ï¼Œä»…ä¾›å­¦ä¹ ä½¿ç”¨</strong>ï¼š<a href="https://github.com/wonderomg/SpringData-mongdb">https://github.com/wonderomg/SpringData-mongdb</a></li><li>å‚è€ƒèµ„æ–™ï¼š<a href="http://docs.spring.io/spring-data/mongodb/docs/current/reference/html/">http://docs.spring.io/spring-data/mongodb/docs/current/reference/html/</a></li><li>å‚è€ƒæ–‡ç« ï¼š<a href="http://www.imooc.com/article/13777">http://www.imooc.com/article/13777</a></li></ul>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/Java/">Java</category>
      
      
      <category domain="https://wonderomg.github.io/tags/SpingMvc/">SpingMvc</category>
      
      <category domain="https://wonderomg.github.io/tags/MongoDB/">MongoDB</category>
      
      <category domain="https://wonderomg.github.io/tags/SpringData/">SpringData</category>
      
      <category domain="https://wonderomg.github.io/tags/idea/">idea</category>
      
      <category domain="https://wonderomg.github.io/tags/maven/">maven</category>
      
      
      <comments>https://wonderomg.github.io/2017/06/06/idea%E6%90%AD%E5%BB%BAspringdata+mongodb+maven+springmvc/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mybatisä¸­çš„#{}å’Œ${}çš„åŒºåˆ«</title>
      <link>https://wonderomg.github.io/2017/04/20/mybatis_operator/</link>
      <guid>https://wonderomg.github.io/2017/04/20/mybatis_operator/</guid>
      <pubDate>Wed, 19 Apr 2017 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ã€€ã€€åœ¨ä½¿ç”¨&lt;code&gt;mybatis&lt;/code&gt;æ—¶éƒ½ä¼šç”¨åˆ°&lt;code&gt;#&amp;#123;&amp;#125;&lt;/code&gt;å’Œ&lt;code&gt;$&amp;#123;&amp;#125;&lt;/code&gt;ç¬¦å·æ¥è¿›è¡Œä¼ å€¼ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸¤è€…çš„åŒºåˆ«ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<p>ã€€ã€€åœ¨ä½¿ç”¨<code>mybatis</code>æ—¶éƒ½ä¼šç”¨åˆ°<code>#&#123;&#125;</code>å’Œ<code>$&#123;&#125;</code>ç¬¦å·æ¥è¿›è¡Œä¼ å€¼ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸¤è€…çš„åŒºåˆ«ã€‚<span id="more"></span></p><h2 id="1-ç‰¹å¾"><a href="#1-ç‰¹å¾" class="headerlink" title="1. ç‰¹å¾"></a><strong>1. ç‰¹å¾</strong></h2><ol><li><code>#&#123;&#125;</code>å°†ä¼ å…¥çš„æ•°æ®éƒ½å½“æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šå¯¹è‡ªåŠ¨ä¼ å…¥çš„æ•°æ®åŠ ä¸€ä¸ªåŒå¼•å·ã€‚å¦‚ï¼š<code>order by #user_id#</code>ï¼Œå¦‚æœä¼ å…¥çš„å€¼æ˜¯111,é‚£ä¹ˆè§£ææˆsqlæ—¶çš„å€¼ä¸º<code>order by &quot;111&quot;</code>, å¦‚æœä¼ å…¥çš„å€¼æ˜¯idï¼Œåˆ™è§£ææˆçš„sqlä¸º<code>order by &quot;id&quot;</code> ã€‚</li></ol><ol start="2"><li><p><code>$&#123;&#125;</code>å°†ä¼ å…¥çš„æ•°æ®ç›´æ¥æ˜¾ç¤ºç”Ÿæˆåœ¨sqlä¸­ã€‚å¦‚ï¼š<code>order by $user_id$</code>ï¼Œå¦‚æœä¼ å…¥çš„å€¼æ˜¯111,é‚£ä¹ˆè§£ææˆsqlæ—¶çš„å€¼ä¸º<code>order by 111</code>,  å¦‚æœä¼ å…¥çš„å€¼æ˜¯idï¼Œåˆ™è§£ææˆçš„sqlä¸º<code>order by id</code>.</p></li><li><p><code>#&#123;&#125;</code>æ–¹å¼èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦é˜²æ­¢sqlæ³¨å…¥ã€‚</p></li><li><p><code>$&#123;&#125;</code>æ–¹å¼æ— æ³•é˜²æ­¢Sqlæ³¨å…¥ã€‚</p></li><li><p><code>$&#123;&#125;</code>æ–¹å¼ä¸€èˆ¬ç”¨äºä¼ å…¥æ•°æ®åº“å¯¹è±¡ï¼Œä¾‹å¦‚ä¼ å…¥è¡¨åã€‚</p></li><li><p>ä¸€èˆ¬èƒ½ç”¨<code>#&#123;&#125;</code>çš„å°±åˆ«ç”¨<code>$&#123;&#125;</code> ã€‚</p></li></ol><blockquote><p><code>mybatis</code>æ’åºæ—¶ä½¿ç”¨<code>order by </code>åŠ¨æ€å‚æ•°æ—¶éœ€è¦æ³¨æ„ï¼Œç”¨<code>$&#123;&#125;</code>è€Œä¸æ˜¯<code>#&#123;&#125;</code></p></blockquote><h2 id="2-å­—ç¬¦ä¸²æ›¿æ¢"><a href="#2-å­—ç¬¦ä¸²æ›¿æ¢" class="headerlink" title="2. å­—ç¬¦ä¸²æ›¿æ¢"></a><strong>2. å­—ç¬¦ä¸²æ›¿æ¢</strong></h2><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>#&#123;&#125;</code>æ ¼å¼çš„è¯­æ³•ä¼šå¯¼è‡´<code>mybatis</code>åˆ›å»ºé¢„å¤„ç†è¯­å¥å±æ€§å¹¶ä»¥å®ƒä¸ºèƒŒæ™¯è®¾ç½®å®‰å…¨çš„å€¼ï¼ˆæ¯”å¦‚?ï¼‰ã€‚è¿™æ ·åšå¾ˆå®‰å…¨ï¼Œå¾ˆè¿…é€Ÿä¹Ÿæ˜¯é¦–é€‰åšæ³•ï¼Œæœ‰æ—¶ä½ åªæ˜¯æƒ³ç›´æ¥åœ¨SQLè¯­å¥ä¸­æ’å…¥ä¸€ä¸ªä¸æ”¹å˜çš„å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼Œåƒ<code>ORDER BY</code>ï¼Œä½ å¯ä»¥è¿™æ ·æ¥ä½¿ç”¨ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> $&#123;columnName&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ<code>mybatis</code>ä¸ä¼šä¿®æ”¹æˆ–è½¬ä¹‰å­—ç¬¦ä¸²ã€‚</p><p><strong>é‡è¦ï¼šæ¥å—ä»ç”¨æˆ·è¾“å‡ºçš„å†…å®¹å¹¶æä¾›ç»™è¯­å¥ä¸­ä¸å˜çš„å­—ç¬¦ä¸²ï¼Œè¿™æ ·åšæ˜¯ä¸å®‰å…¨çš„ã€‚è¿™ä¼šå¯¼è‡´æ½œåœ¨çš„SQLæ³¨å…¥æ”»å‡»ï¼Œå› æ­¤ä½ ä¸åº”è¯¥å…è®¸ç”¨æˆ·è¾“å…¥è¿™äº›å­—æ®µï¼Œæˆ–è€…é€šå¸¸è‡ªè¡Œè½¬ä¹‰å¹¶æ£€æŸ¥ã€‚</strong></p><h2 id="3-mybatis-æœ¬èº«çš„è¯´æ˜"><a href="#3-mybatis-æœ¬èº«çš„è¯´æ˜" class="headerlink" title="3. mybatis æœ¬èº«çš„è¯´æ˜"></a><strong>3. mybatis æœ¬èº«çš„è¯´æ˜</strong></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">String Substitution</span><br><span class="line"></span><br><span class="line">By default, using the #&#123;&#125; syntax will cause MyBatis to generate PreparedStatement properties and set the values safely against the PreparedStatement parameters (e.g. ?). While this is safer, faster and almost always preferred, sometimes you just want to directly inject a string unmodified into the SQL Statement. For example, for ORDER BY, you might use something like this:</span><br><span class="line"></span><br><span class="line">ORDER BY $&#123;columnName&#125;</span><br><span class="line">Here MyBatis won&#x27;t modify or escape the string.</span><br><span class="line"></span><br><span class="line">NOTE It&#x27;s not safe to accept input from a user and supply it to a statement unmodified in this way. This leads to potential SQL Injection attacks and therefore you should either disallow user input in these fields, or always perform your own escapes and checks.</span><br></pre></td></tr></table></figure><p>ä»ä¸Šæ–‡å¯ä»¥çœ‹å‡ºï¼š</p><ol><li>ä½¿ç”¨<code>#&#123;&#125;</code>æ ¼å¼çš„è¯­æ³•åœ¨<code>mybatis</code>ä¸­ä½¿ç”¨<code>Preparement</code>è¯­å¥æ¥å®‰å…¨çš„è®¾ç½®å€¼ï¼Œæ‰§è¡Œsqlç±»ä¼¼ä¸‹é¢çš„ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PreparedStatement ps = conn.prepareStatement(sql);</span><br><span class="line">ps.setInt(<span class="number">1</span>,id);</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šæ›´å®‰å…¨ï¼Œæ›´è¿…é€Ÿï¼Œé€šå¸¸ä¹Ÿæ˜¯é¦–é€‰åšæ³•ã€‚</p><ol start="2"><li>ä¸è¿‡æœ‰æ—¶ä½ åªæ˜¯æƒ³ç›´æ¥åœ¨ SQL è¯­å¥ä¸­æ’å…¥ä¸€ä¸ªä¸æ”¹å˜çš„å­—ç¬¦ä¸²ã€‚æ¯”å¦‚ï¼Œåƒ <code>ORDER BY</code>ï¼Œä½ å¯ä»¥è¿™æ ·æ¥ä½¿ç”¨ï¼š</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ORDER BY $&#123;columnName&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶<code>mybatis</code> ä¸ä¼šä¿®æ”¹æˆ–è½¬ä¹‰å­—ç¬¦ä¸²ã€‚</p><p>è¿™ç§æ–¹å¼ç±»ä¼¼äºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Statement st = conn.createStatement();</span><br><span class="line">ResultSet rs = st.executeQuery(sql);</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ï¼š </p><p>ä»¥è¿™ç§æ–¹å¼æ¥å—ä»ç”¨æˆ·è¾“å‡ºçš„å†…å®¹å¹¶æä¾›ç»™è¯­å¥ä¸­ä¸å˜çš„å­—ç¬¦ä¸²æ˜¯ä¸å®‰å…¨çš„ï¼Œä¼šå¯¼è‡´æ½œåœ¨çš„ SQL æ³¨å…¥æ”»å‡»ï¼Œå› æ­¤è¦ä¹ˆä¸å…è®¸ç”¨æˆ·è¾“å…¥è¿™äº›å­—æ®µï¼Œè¦ä¹ˆè‡ªè¡Œè½¬ä¹‰å¹¶æ£€éªŒã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/mybatis/">mybatis</category>
      
      
      <category domain="https://wonderomg.github.io/tags/mybatis/">mybatis</category>
      
      
      <comments>https://wonderomg.github.io/2017/04/20/mybatis_operator/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>å‰åç«¯åˆ†ç¦»ï¼Œå‰ç«¯è·¨åŸŸè®¿é—®åå°çš„ä¸¤ç§æ–¹å¼</title>
      <link>https://wonderomg.github.io/2017/02/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E5%89%8D%E7%AB%AF%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AE%E5%90%8E%E5%8F%B0%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/</link>
      <guid>https://wonderomg.github.io/2017/02/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E5%89%8D%E7%AB%AF%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AE%E5%90%8E%E5%8F%B0%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/</guid>
      <pubDate>Mon, 27 Feb 2017 16:00:00 GMT</pubDate>
      
      <description>&lt;blockquote&gt;
&lt;p&gt;â€‹       åœ¨æˆ‘ä»¬åšwebé¡¹ç›®é¡¹ç›®æ—¶ï¼Œå‰ç«¯å’Œåç«¯éƒ½æ˜¯ä¸åŒçš„å¼€å‘äººå‘˜è´Ÿè´£ï¼Œåˆ°æŸä¸ªæ—¶é—´ç‚¹å¿…ç„¶è¦è¿›è¡Œå‰åç«¯æ•°æ®äº¤äº’ï¼Œè¿™æ—¶å€™å°±ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ã€‚è¿™é‡Œä»‹ç»ä¸¤ç§è§£å†³æ–¹å¼ã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description>
      
      
      
      <content:encoded><![CDATA[<blockquote><p>â€‹       åœ¨æˆ‘ä»¬åšwebé¡¹ç›®é¡¹ç›®æ—¶ï¼Œå‰ç«¯å’Œåç«¯éƒ½æ˜¯ä¸åŒçš„å¼€å‘äººå‘˜è´Ÿè´£ï¼Œåˆ°æŸä¸ªæ—¶é—´ç‚¹å¿…ç„¶è¦è¿›è¡Œå‰åç«¯æ•°æ®äº¤äº’ï¼Œè¿™æ—¶å€™å°±ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ã€‚è¿™é‡Œä»‹ç»ä¸¤ç§è§£å†³æ–¹å¼ã€‚</p></blockquote><span id="more"></span><h2 id="æ–¹å¼1ï¼šå¦‚æœå¼€å‘æ˜¯tomcatæœåŠ¡å™¨ï¼Œåœ¨å·¥ç¨‹çš„web-xmlæ·»åŠ è®¾ç½®"><a href="#æ–¹å¼1ï¼šå¦‚æœå¼€å‘æ˜¯tomcatæœåŠ¡å™¨ï¼Œåœ¨å·¥ç¨‹çš„web-xmlæ·»åŠ è®¾ç½®" class="headerlink" title="æ–¹å¼1ï¼šå¦‚æœå¼€å‘æ˜¯tomcatæœåŠ¡å™¨ï¼Œåœ¨å·¥ç¨‹çš„web.xmlæ·»åŠ è®¾ç½®"></a><strong>æ–¹å¼1ï¼šå¦‚æœå¼€å‘æ˜¯tomcatæœåŠ¡å™¨ï¼Œåœ¨å·¥ç¨‹çš„web.xmlæ·»åŠ è®¾ç½®</strong></h2><p>â€‹        ç¬¬ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡<code>CORS (Cross-Origin Resource Sharing)</code>è·¨åŸŸèµ„æºå…±äº«çš„æ–¹å¼å®ç°ã€‚</p><p>â€‹        åœ¨web.xmlæ–‡ä»¶ä¸­è®¾ç½®CORSå†…å®¹ï¼Œå¦‚æœåå°å¼€å‘äººç”¨çš„æ˜¯tomcatæœåŠ¡å™¨çš„è¯ï¼Œåˆ™åœ¨webå·¥ç¨‹çš„web.xmlæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸‹å†…å®¹å³å¯ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--è§£å†³tomcatéƒ¨ç½²è·¨åŸŸé—®é¢˜ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CORS<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.thetransactioncompany.cors.CORSFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.allowOrigin<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>*<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.supportedMethods<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>GET, POST, HEAD, PUT, DELETE<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.supportedHeaders<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>Accept, Origin, X-Requested-With, Content-Type, Last-Modified<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.exposedHeaders<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>Set-Cookie<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-name</span>&gt;</span>cors.supportsCredentials<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CORS<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯é€šè¿‡<code>CORS (Cross-Origin Resource Sharing)</code>è·¨åŸŸèµ„æºå…±äº«çš„æ–¹å¼å®ç°ã€‚è¿™ç§æ–¹å¼å¯¹chromeæµè§ˆå™¨è°ƒè¯•æœ‰ç‚¹é—®é¢˜ï¼ŒfirefoxåŠIEè°ƒè¯•æ­£å¸¸ã€‚</p><h2 id="æ–¹å¼2ï¼šé€šè¿‡ajaxå’Œè¿‡æ»¤å™¨å®ç°è·¨åŸŸ"><a href="#æ–¹å¼2ï¼šé€šè¿‡ajaxå’Œè¿‡æ»¤å™¨å®ç°è·¨åŸŸ" class="headerlink" title="æ–¹å¼2ï¼šé€šè¿‡ajaxå’Œè¿‡æ»¤å™¨å®ç°è·¨åŸŸ"></a><strong>æ–¹å¼2ï¼šé€šè¿‡ajaxå’Œè¿‡æ»¤å™¨å®ç°è·¨åŸŸ</strong></h2><p>â€‹        ç¬¬äºŒç§æ–¹å¼æ˜¯é€šè¿‡å¾€è¯·æ±‚æ¶ˆæ¯å¤´ä¸­åŠ <code>Access-Control-Allow-Origin</code>ã€‚</p><p>â€‹        <code>Access-Control-Allow-Origin</code>æ˜¯<code>HTML5 </code>æ·»åŠ çš„æ–°åŠŸèƒ½ï¼Œè®¾ç½®è¿™ä¸ªå±æ€§å€¼ä¸ºä½ å‰ç«¯æ‰€åœ¨æœåŠ¡å™¨çš„ipåœ°å€ã€‚</p><p>é¦–å…ˆåå°æ·»åŠ è¿‡æ»¤å™¨<code>AccessFilter.java</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterConfig;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**   </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Title</span>: AccessFilter.java </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: TODO(è®¾ç½®å…¶ä»–IPåœ°å€çš„æœºå™¨å¯ä»¥ç›´æ¥è®¿é—®æœ¬é¡¹ç›®Url--å·¥å…·filter) </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccessFilter</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> <span class="keyword">implements</span> <span class="title">Filter</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åºåˆ—IDï¼Œç”¨æ¥ç›‘æµ‹æ§åˆ¶ç‰ˆæœ¬æ›´æ–°çš„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.mavenspring.project.allow.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String projectDemoAllowOriginUrl;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;               </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®å…¶ä»–IPåœ°å€çš„æœºå™¨å¯ä»¥ç›´æ¥è®¿é—®åˆ°è¿™ä¸ªé¡¹ç›®çš„åç«¯</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response,</span></span></span><br><span class="line"><span class="params"><span class="function">            FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        </span><br><span class="line">        HttpServletResponse httpResponse = (HttpServletResponse) response;</span><br><span class="line">        httpResponse.setHeader(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, projectDemoAllowOriginUrl);</span><br><span class="line">        httpResponse.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>,<span class="string">&quot;Origin, X-Requested-With, Content-Type, Accept&quot;</span>);</span><br><span class="line">        httpResponse.setHeader(<span class="string">&quot;Access-Control-Allow-Credentials&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br><span class="line">        chain.doFilter(request, httpResponse);     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨å‰ç«¯jsçš„ajaxéƒ¨åˆ†æŒ‰ç…§ä¸‹é¢çš„æ–¹å¼è®¾ç½®ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$.ajaxSettings.xhrFields = &#123;</span><br><span class="line">    <span class="attr">withCredentials</span> : <span class="literal">true</span></span><br><span class="line">&#125;;</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">    <span class="attr">crossDomain</span> : <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">type</span> : <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span> : <span class="string">&#x27;http://...&#x27;</span>,</span><br><span class="line">    <span class="attr">dataType</span> : <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span> : <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">    <span class="comment">//å…¶ä»–å¤„ç†ä¸å˜</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹<code>widthCredentials</code>ä¸º<code>false</code>ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®<code>widthCredentials</code>ä¸º<code>true</code>ã€‚</p><p>æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œè®¾ç½®äº†<code>widthCredentials</code>ä¸º<code>true</code>çš„è¯·æ±‚ä¸­ä¼šåŒ…å«è¿œç¨‹åŸŸçš„æ‰€æœ‰<code>cookie</code>ï¼Œä½†è¿™äº›<code>cookie</code>ä»ç„¶éµå¾ªåŒæºç­–ç•¥ï¼Œæ‰€ä»¥ä½ æ˜¯è®¿é—®ä¸äº†è¿™äº›<code>cookie</code>çš„ã€‚<br>ä»¥ä¸Šæ˜¯æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ç”¨åˆ°çš„ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ–¹å¼ç”¨chromeè°ƒè¯•ä¼šæœ‰ç‚¹é—®é¢˜ï¼Œç¬¬äºŒç§æ–¹å¼å…¼å®¹æ€§è¾ƒå¥½ï¼Œä¸»æµæµè§ˆå™¨è°ƒè¯•æ­£å¸¸ã€‚</p><blockquote><p><strong>ä¸è¿‡ä¸€å®šè¦è®°å¾—ï¼Œè¿™ä¸ªä»…ä»…ä½œä¸ºå‰åç«¯äº¤äº’è°ƒè¯•ä¹‹ç”¨ï¼Œ</strong></p><p><strong>å¼€å‘å®Œæˆåè®°å¾—åˆ é™¤è¿™äº›è·¨åŸŸéƒ¨åˆ†ï¼Œ</strong></p><p><strong>é¿å…é¡¹ç›®ä¸Šçº¿ä¹‹åå‡ºç°å®‰å…¨é—®é¢˜ã€‚åˆ‡è®°ï¼</strong></p></blockquote>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/Web/">Web</category>
      
      
      <category domain="https://wonderomg.github.io/tags/Java/">Java</category>
      
      <category domain="https://wonderomg.github.io/tags/Web/">Web</category>
      
      <category domain="https://wonderomg.github.io/tags/%E8%B7%A8%E5%9F%9F/">è·¨åŸŸ</category>
      
      
      <comments>https://wonderomg.github.io/2017/02/28/%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%EF%BC%8C%E5%89%8D%E7%AB%AF%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AE%E5%90%8E%E5%8F%B0%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mongodbå­¦ä¹ ç¬”è®°--$elemMatchæ“ä½œç¬¦çš„ä½¿ç”¨</title>
      <link>https://wonderomg.github.io/2017/02/21/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--$elemMatch%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8/</link>
      <guid>https://wonderomg.github.io/2017/02/21/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--$elemMatch%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8/</guid>
      <pubDate>Mon, 20 Feb 2017 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ã€€ã€€mongodbæä¾›äº†å¾ˆå¤šæ“ä½œç¬¦ä»¥ä¾¿æ›´åŠ æ–¹ä¾¿å¿«æ·åœ°æ“ä½œæ•°æ®ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹æŸ¥è¯¢æ“ä½œç¬¦&lt;code&gt;$elemMatch&lt;/code&gt;ï¼Œ&lt;code&gt;$elemMatch&lt;/code&gt;æŠ•å½±æ“ä½œç¬¦å°†é™åˆ¶æŸ¥è¯¢è¿”å›çš„æ•°ç»„å­—æ®µçš„å†…å®¹åªåŒ…å«åŒ¹é…&lt;code&gt;$elemMatch&lt;/code&gt;æ¡ä»¶çš„æ•°ç»„å…ƒç´ ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ã€€ã€€mongodbæä¾›äº†å¾ˆå¤šæ“ä½œç¬¦ä»¥ä¾¿æ›´åŠ æ–¹ä¾¿å¿«æ·åœ°æ“ä½œæ•°æ®ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹æŸ¥è¯¢æ“ä½œç¬¦<code>$elemMatch</code>ï¼Œ<code>$elemMatch</code>æŠ•å½±æ“ä½œç¬¦å°†é™åˆ¶æŸ¥è¯¢è¿”å›çš„æ•°ç»„å­—æ®µçš„å†…å®¹åªåŒ…å«åŒ¹é…<code>$elemMatch</code>æ¡ä»¶çš„æ•°ç»„å…ƒç´ ã€‚</p><span id="more"></span><blockquote><p>æ³¨æ„ï¼š</p><ul><li>æ•°ç»„ä¸­å…ƒç´ æ˜¯å†…åµŒæ–‡æ¡£ã€‚</li><li>å¦‚æœå¤šä¸ªå…ƒç´ åŒ¹é…<code>$elemMatch</code>æ¡ä»¶ï¼Œæ“ä½œç¬¦è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…æ¡ä»¶çš„å…ƒç´ ã€‚</li></ul></blockquote><h2 id="1-é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•æ–‡æ¡£"><a href="#1-é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•æ–‡æ¡£" class="headerlink" title="1.é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•æ–‡æ¡£"></a><strong>1.é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•æ–‡æ¡£</strong></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.insert(&#123;<span class="string">&quot;id&quot;</span>:<span class="number">1</span>, <span class="string">&quot;members&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">27</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;M&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver2&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">23</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;F&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver3&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">21</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;M&quot;</span>&#125;]&#125;);</span><br></pre></td></tr></table></figure><h2 id="2-ä½¿ç”¨å¤šç§æ–¹å¼å°è¯•æŸ¥è¯¢"><a href="#2-ä½¿ç”¨å¤šç§æ–¹å¼å°è¯•æŸ¥è¯¢" class="headerlink" title="2.ä½¿ç”¨å¤šç§æ–¹å¼å°è¯•æŸ¥è¯¢"></a><strong>2.ä½¿ç”¨å¤šç§æ–¹å¼å°è¯•æŸ¥è¯¢</strong></h2><p>(1) ä½¿ç”¨<code>db.test.find(&#123;&quot;members&quot;:&#123;&quot;name&quot;:&quot;BuleRiver1&quot;&#125;&#125;);</code>è¿›è¡ŒæŸ¥è¯¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>&#125;&#125;);</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢çš„ç»“æœæ˜¯ç©ºé›†ã€‚</p><p>(2) åªæœ‰å®Œå…¨åŒ¹é…ä¸€ä¸ªçš„æ—¶å€™æ‰èƒ½è·å–åˆ°ç»“æœï¼Œå› æ­¤ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">27</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;M&quot;</span>&#125;&#125;);</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°ç»“æœã€‚</p><p>(3) å¦‚æœæŠŠé”®å€¼è¿›è¡Œé¢ å€’,ä¹Ÿå¾—ä¸åˆ°ç»“æœï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>:<span class="number">27</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;M&quot;</span>&#125;&#125;);</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœæ˜¯ç©ºé›†ã€‚</p><p>(4) æˆ‘ä»¬è¿™æ ·æŸ¥è¯¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members.name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>&#125;);</span><br></pre></td></tr></table></figure><p>æ˜¯å¯ä»¥æŸ¥è¯¢å‡ºç»“æœçš„ã€‚</p><p>(5) å¦‚æœéœ€è¦ä¸¤ä¸ªå±æ€§ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members.name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;members.age&quot;</span>:<span class="number">27</span>&#125;);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŸ¥è¯¢å‡ºç»“æœã€‚</p><p>(6) æˆ‘ä»¬å†è¿›è¡Œç ´åæ€§å°è¯•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members.name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;members.age&quot;</span>:<span class="number">23</span>&#125;);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŸ¥è¯¢å‡ºç»“æœã€‚</p><p>ä¸è¿‡æˆ‘ä»¬åº”è¯¥æ³¨æ„åˆ°ï¼š<code>BuleRiver1</code>æ˜¯æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„é”®å€¼ï¼Œè€Œ23æ˜¯æ•°ç»„ä¸­ç¬¬äºŒä¸ªå…ƒç´ çš„é”®å€¼ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æŸ¥è¯¢å‡ºç»“æœã€‚</p><h2 id="3-ä½¿ç”¨-elemMatchæ“ä½œç¬¦æŸ¥è¯¢"><a href="#3-ä½¿ç”¨-elemMatchæ“ä½œç¬¦æŸ¥è¯¢" class="headerlink" title="3.ä½¿ç”¨$elemMatchæ“ä½œç¬¦æŸ¥è¯¢"></a><strong>3.ä½¿ç”¨$elemMatchæ“ä½œç¬¦æŸ¥è¯¢</strong></h2><p>ã€€ã€€å¯¹äºæˆ‘ä»¬çš„ä¸€äº›åº”ç”¨æ¥è¯´ï¼Œä»¥ä¸Šç»“æœæ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä½¿ç”¨<code>$elemMatch</code>æ“ä½œç¬¦:</p><p>(1)``$elemMatch+åŒä¸€ä¸ªå…ƒç´ ä¸­çš„é”®å€¼ç»„åˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;$elemMatch&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">27</span>&#125;&#125;&#125;);</span><br></pre></td></tr></table></figure><p>å¯ä»¥æŸ¥è¯¢å‡ºç»“æœï¼›</p><p>(2)<code>$elemMatch</code>+ä¸åŒå…ƒç´ çš„é”®å€¼ç»„åˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;$elemMatch&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">23</span>&#125;&#125;&#125;);</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ä¸å‡ºç»“æœã€‚</p><p>å› æ­¤ï¼Œ(1)å±•ç¤ºçš„åµŒå¥—æŸ¥è¯¢æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„æŸ¥è¯¢æ–¹å¼ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/mongodb/">mongodb</category>
      
      
      <category domain="https://wonderomg.github.io/tags/elemMatch%E6%9D%A1%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%AC%A6/">elemMatchæ¡ä»¶æ“ä½œç¬¦</category>
      
      
      <comments>https://wonderomg.github.io/2017/02/21/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--$elemMatch%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mongodbå­¦ä¹ ç¬”è®°--$elemMatchæ“ä½œç¬¦çš„ä½¿ç”¨</title>
      <link>https://wonderomg.github.io/2017/02/21/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0elemMatch%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8/</link>
      <guid>https://wonderomg.github.io/2017/02/21/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0elemMatch%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8/</guid>
      <pubDate>Mon, 20 Feb 2017 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ã€€ã€€mongodbæä¾›äº†å¾ˆå¤šæ“ä½œç¬¦ä»¥ä¾¿æ›´åŠ æ–¹ä¾¿å¿«æ·åœ°æ“ä½œæ•°æ®ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹æŸ¥è¯¢æ“ä½œç¬¦&lt;code&gt;$elemMatch&lt;/code&gt;ï¼Œ&lt;code&gt;$elemMatch&lt;/code&gt;æŠ•å½±æ“ä½œç¬¦å°†é™åˆ¶æŸ¥è¯¢è¿”å›çš„æ•°ç»„å­—æ®µçš„å†…å®¹åªåŒ…å«åŒ¹é…&lt;code&gt;$elemMatch&lt;/code&gt;æ¡ä»¶çš„æ•°ç»„å…ƒç´ ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ã€€ã€€mongodbæä¾›äº†å¾ˆå¤šæ“ä½œç¬¦ä»¥ä¾¿æ›´åŠ æ–¹ä¾¿å¿«æ·åœ°æ“ä½œæ•°æ®ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®¤è¯†ä¸€ä¸‹æŸ¥è¯¢æ“ä½œç¬¦<code>$elemMatch</code>ï¼Œ<code>$elemMatch</code>æŠ•å½±æ“ä½œç¬¦å°†é™åˆ¶æŸ¥è¯¢è¿”å›çš„æ•°ç»„å­—æ®µçš„å†…å®¹åªåŒ…å«åŒ¹é…<code>$elemMatch</code>æ¡ä»¶çš„æ•°ç»„å…ƒç´ ã€‚</p><span id="more"></span><blockquote><p>æ³¨æ„ï¼š</p><ul><li>æ•°ç»„ä¸­å…ƒç´ æ˜¯å†…åµŒæ–‡æ¡£ã€‚</li><li>å¦‚æœå¤šä¸ªå…ƒç´ åŒ¹é…<code>$elemMatch</code>æ¡ä»¶ï¼Œæ“ä½œç¬¦è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…æ¡ä»¶çš„å…ƒç´ ã€‚</li></ul></blockquote><h2 id="1-é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•æ–‡æ¡£"><a href="#1-é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•æ–‡æ¡£" class="headerlink" title="1.é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•æ–‡æ¡£"></a><strong>1.é¦–å…ˆåˆ›å»ºä¸€ä¸ªç®€å•æ–‡æ¡£</strong></h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.insert(&#123;<span class="string">&quot;id&quot;</span>:<span class="number">1</span>, <span class="string">&quot;members&quot;</span>:[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">27</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;M&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver2&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">23</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;F&quot;</span>&#125;, &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver3&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">21</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;M&quot;</span>&#125;]&#125;);</span><br></pre></td></tr></table></figure><h2 id="2-ä½¿ç”¨å¤šç§æ–¹å¼å°è¯•æŸ¥è¯¢"><a href="#2-ä½¿ç”¨å¤šç§æ–¹å¼å°è¯•æŸ¥è¯¢" class="headerlink" title="2.ä½¿ç”¨å¤šç§æ–¹å¼å°è¯•æŸ¥è¯¢"></a><strong>2.ä½¿ç”¨å¤šç§æ–¹å¼å°è¯•æŸ¥è¯¢</strong></h2><p>(1) ä½¿ç”¨<code>db.test.find(&#123;&quot;members&quot;:&#123;&quot;name&quot;:&quot;BuleRiver1&quot;&#125;&#125;);</code>è¿›è¡ŒæŸ¥è¯¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>&#125;&#125;);</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢çš„ç»“æœæ˜¯ç©ºé›†ã€‚</p><p>(2) åªæœ‰å®Œå…¨åŒ¹é…ä¸€ä¸ªçš„æ—¶å€™æ‰èƒ½è·å–åˆ°ç»“æœï¼Œå› æ­¤ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">27</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;M&quot;</span>&#125;&#125;);</span><br></pre></td></tr></table></figure><p>å¯ä»¥å¾—åˆ°ç»“æœã€‚</p><p>(3) å¦‚æœæŠŠé”®å€¼è¿›è¡Œé¢ å€’,ä¹Ÿå¾—ä¸åˆ°ç»“æœï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>:<span class="number">27</span>, <span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;gender&quot;</span>:<span class="string">&quot;M&quot;</span>&#125;&#125;);</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ç»“æœæ˜¯ç©ºé›†ã€‚</p><p>(4) æˆ‘ä»¬è¿™æ ·æŸ¥è¯¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members.name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>&#125;);</span><br></pre></td></tr></table></figure><p>æ˜¯å¯ä»¥æŸ¥è¯¢å‡ºç»“æœçš„ã€‚</p><p>(5) å¦‚æœéœ€è¦ä¸¤ä¸ªå±æ€§ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members.name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;members.age&quot;</span>:<span class="number">27</span>&#125;);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŸ¥è¯¢å‡ºç»“æœã€‚</p><p>(6) æˆ‘ä»¬å†è¿›è¡Œç ´åæ€§å°è¯•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members.name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;members.age&quot;</span>:<span class="number">23</span>&#125;);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æŸ¥è¯¢å‡ºç»“æœã€‚</p><p>ä¸è¿‡æˆ‘ä»¬åº”è¯¥æ³¨æ„åˆ°ï¼š<code>BuleRiver1</code>æ˜¯æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„é”®å€¼ï¼Œè€Œ23æ˜¯æ•°ç»„ä¸­ç¬¬äºŒä¸ªå…ƒç´ çš„é”®å€¼ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥æŸ¥è¯¢å‡ºç»“æœã€‚</p><h2 id="3-ä½¿ç”¨-elemMatchæ“ä½œç¬¦æŸ¥è¯¢"><a href="#3-ä½¿ç”¨-elemMatchæ“ä½œç¬¦æŸ¥è¯¢" class="headerlink" title="3.ä½¿ç”¨$elemMatchæ“ä½œç¬¦æŸ¥è¯¢"></a><strong>3.ä½¿ç”¨$elemMatchæ“ä½œç¬¦æŸ¥è¯¢</strong></h2><p>ã€€ã€€å¯¹äºæˆ‘ä»¬çš„ä¸€äº›åº”ç”¨æ¥è¯´ï¼Œä»¥ä¸Šç»“æœæ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥ä½¿ç”¨<code>$elemMatch</code>æ“ä½œç¬¦:</p><p>(1)``$elemMatch+åŒä¸€ä¸ªå…ƒç´ ä¸­çš„é”®å€¼ç»„åˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;$elemMatch&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">27</span>&#125;&#125;&#125;);</span><br></pre></td></tr></table></figure><p>å¯ä»¥æŸ¥è¯¢å‡ºç»“æœï¼›</p><p>(2)<code>$elemMatch</code>+ä¸åŒå…ƒç´ çš„é”®å€¼ç»„åˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.test.find(&#123;<span class="string">&quot;members&quot;</span>:&#123;<span class="string">&quot;$elemMatch&quot;</span>:&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;BuleRiver1&quot;</span>, <span class="string">&quot;age&quot;</span>:<span class="number">23</span>&#125;&#125;&#125;);</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢ä¸å‡ºç»“æœã€‚</p><p>å› æ­¤ï¼Œ(1)å±•ç¤ºçš„åµŒå¥—æŸ¥è¯¢æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„æŸ¥è¯¢æ–¹å¼ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/mongodb/">mongodb</category>
      
      
      <category domain="https://wonderomg.github.io/tags/elemMatch%E6%9D%A1%E4%BB%B6%E6%93%8D%E4%BD%9C%E7%AC%A6/">elemMatchæ¡ä»¶æ“ä½œç¬¦</category>
      
      
      <comments>https://wonderomg.github.io/2017/02/21/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0elemMatch%E6%93%8D%E4%BD%9C%E7%AC%A6%E7%9A%84%E4%BD%BF%E7%94%A8/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Socket sendå‡½æ•°å’Œrecvå‡½æ•°è¯¦è§£</title>
      <link>https://wonderomg.github.io/2017/01/10/Socket_send%E5%87%BD%E6%95%B0%E5%92%8Crecv%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/</link>
      <guid>https://wonderomg.github.io/2017/01/10/Socket_send%E5%87%BD%E6%95%B0%E5%92%8Crecv%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/</guid>
      <pubDate>Mon, 09 Jan 2017 16:00:00 GMT</pubDate>
      
      <description>&lt;hr&gt;
&lt;h2 id=&quot;1-send-å‡½æ•°&quot;&gt;&lt;a href=&quot;#1-send-å‡½æ•°&quot; class=&quot;headerlink&quot; title=&quot;1. send å‡½æ•°&quot;&gt;&lt;/a&gt;&lt;strong&gt;1. send å‡½æ•°&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;**int send( SOCKET s, const char FAR *buf, int len, int flags ); ** &lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<hr><h2 id="1-send-å‡½æ•°"><a href="#1-send-å‡½æ•°" class="headerlink" title="1. send å‡½æ•°"></a><strong>1. send å‡½æ•°</strong></h2><p>**int send( SOCKET s, const char FAR *buf, int len, int flags ); ** </p><span id="more"></span><p>ä¸è®ºæ˜¯å®¢æˆ·è¿˜æ˜¯æœåŠ¡å™¨åº”ç”¨ç¨‹åºéƒ½ç”¨sendå‡½æ•°æ¥å‘TCPè¿æ¥çš„å¦ä¸€ç«¯å‘é€æ•°æ®ã€‚å®¢æˆ·ç¨‹åºä¸€èˆ¬ç”¨sendå‡½æ•°å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨åˆ™é€šå¸¸ç”¨sendå‡½æ•°æ¥å‘å®¢æˆ·ç¨‹åºå‘é€åº”ç­”ã€‚</p><p>â€‹    è¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šå‘é€ç«¯å¥—æ¥å­—æè¿°ç¬¦ï¼›</p><p>â€‹    ç¬¬äºŒä¸ªå‚æ•°æŒ‡æ˜ä¸€ä¸ªå­˜æ”¾åº”ç”¨ç¨‹åºè¦å‘é€æ•°æ®çš„ç¼“å†²åŒºï¼›</p><p>â€‹    ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡æ˜å®é™…è¦å‘é€çš„æ•°æ®çš„å­—èŠ‚æ•°ï¼›</p><p>â€‹    ç¬¬å››ä¸ªå‚æ•°ä¸€èˆ¬ç½®0ã€‚ </p><p>â€‹    è¿™é‡Œåªæè¿°<strong>åŒæ­¥Socketçš„sendå‡½æ•°çš„æ‰§è¡Œæµç¨‹</strong>ã€‚å½“è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œ</p><p>   ï¼ˆ1ï¼‰sendå…ˆæ¯”è¾ƒå¾…å‘é€æ•°æ®çš„é•¿åº¦lenå’Œå¥—æ¥å­—sçš„å‘é€ç¼“å†²çš„é•¿åº¦ï¼Œ å¦‚æœlenå¤§äºsçš„å‘é€ç¼“å†²åŒºçš„é•¿åº¦ï¼Œè¯¥å‡½æ•°è¿”å›<code>SOCKET_ERROR</code>ï¼›</p><p>   ï¼ˆ2ï¼‰å¦‚æœlenå°äºæˆ–è€…ç­‰äºsçš„å‘é€ç¼“å†²åŒºçš„é•¿åº¦ï¼Œé‚£ä¹ˆsendå…ˆæ£€æŸ¥åè®®æ˜¯å¦æ­£åœ¨å‘é€sçš„å‘é€ç¼“å†²ä¸­çš„æ•°æ®ï¼Œå¦‚æœæ˜¯å°±ç­‰å¾…åè®®æŠŠæ•°æ®å‘é€å®Œï¼Œå¦‚æœåè®®è¿˜æ²¡æœ‰å¼€å§‹å‘é€sçš„å‘é€ç¼“å†²ä¸­çš„æ•°æ®æˆ–è€…sçš„å‘é€ç¼“å†²ä¸­æ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆsendå°±æ¯”è¾ƒsçš„å‘é€ç¼“å†²åŒºçš„å‰©ä½™ç©ºé—´å’Œlen</p><p>   ï¼ˆ3ï¼‰å¦‚æœlenå¤§äºå‰©ä½™ç©ºé—´å¤§å°ï¼Œsendå°±ä¸€ç›´ç­‰å¾…åè®®æŠŠsçš„å‘é€ç¼“å†²ä¸­çš„æ•°æ®å‘é€å®Œ</p><p>   ï¼ˆ4ï¼‰å¦‚æœlenå°äºå‰©ä½™ ç©ºé—´å¤§å°ï¼Œsendå°±ä»…ä»…æŠŠbufä¸­çš„æ•°æ®copyåˆ°å‰©ä½™ç©ºé—´é‡Œï¼ˆ<strong>æ³¨æ„å¹¶ä¸æ˜¯sendæŠŠsçš„å‘é€ç¼“å†²ä¸­çš„æ•°æ®ä¼ åˆ°è¿æ¥çš„å¦ä¸€ç«¯çš„ï¼Œè€Œæ˜¯åè®®ä¼ çš„ï¼Œsendä»…ä»…æ˜¯æŠŠbufä¸­çš„æ•°æ®copyåˆ°sçš„å‘é€ç¼“å†²åŒºçš„å‰©ä½™ç©ºé—´é‡Œ</strong>ï¼‰ã€‚</p><p>â€‹        å¦‚æœsendå‡½æ•°copyæ•°æ®æˆåŠŸï¼Œå°±è¿”å›å®é™…copyçš„å­—èŠ‚æ•°ï¼Œå¦‚æœsendåœ¨copyæ•°æ®æ—¶å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆsendå°±è¿”å›SOCKET_ERRORï¼›å¦‚æœsendåœ¨ç­‰å¾…åè®®ä¼ é€æ•°æ®æ—¶ç½‘ç»œæ–­å¼€çš„è¯ï¼Œé‚£ä¹ˆsendå‡½æ•°ä¹Ÿè¿”å›SOCKET_ERRORã€‚</p><p>â€‹       <strong>è¦æ³¨æ„sendå‡½æ•°æŠŠbufä¸­çš„æ•°æ®æˆåŠŸcopyåˆ°sçš„å‘é€ç¼“å†²çš„å‰©ä½™ç©ºé—´é‡Œåå®ƒå°±è¿”å›äº†ï¼Œä½†æ˜¯æ­¤æ—¶è¿™äº›æ•°æ®å¹¶ä¸ä¸€å®šé©¬ä¸Šè¢«ä¼ åˆ°è¿æ¥çš„å¦ä¸€ç«¯</strong>ã€‚å¦‚æœåè®®åœ¨åç»­çš„ä¼ é€è¿‡ç¨‹ä¸­å‡ºç°ç½‘ç»œé”™è¯¯çš„è¯ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªSocketå‡½æ•°å°±ä¼šè¿”å›SOCKET_ERRORã€‚ï¼ˆæ¯ä¸€ä¸ªé™¤sendå¤–çš„Socketå‡½æ•°åœ¨æ‰§ è¡Œçš„æœ€å¼€å§‹æ€»è¦å…ˆç­‰å¾…å¥—æ¥å­—çš„å‘é€ç¼“å†²ä¸­çš„æ•°æ®è¢«åè®®ä¼ é€å®Œæ¯•æ‰èƒ½ç»§ç»­ï¼Œå¦‚æœåœ¨ç­‰å¾…æ—¶å‡ºç°ç½‘ç»œé”™è¯¯ï¼Œé‚£ä¹ˆè¯¥Socketå‡½æ•°å°±è¿”å› SOCKET_ERRORï¼‰</p><blockquote><p><strong>æ³¨æ„ï¼šåœ¨Unixç³»ç»Ÿä¸‹ï¼Œå¦‚æœsendåœ¨ç­‰å¾…åè®®ä¼ é€æ•°æ®æ—¶ç½‘ç»œæ–­å¼€çš„è¯ï¼Œè°ƒç”¨sendçš„è¿›ç¨‹ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªSIGPIPEä¿¡å·ï¼Œè¿›ç¨‹å¯¹è¯¥ä¿¡å·çš„é»˜è®¤å¤„ç†æ˜¯è¿›ç¨‹ç»ˆæ­¢ã€‚</strong></p></blockquote><p>é€šè¿‡æµ‹è¯•å‘ç°ï¼Œå¼‚æ­¥socketçš„sendå‡½æ•°åœ¨ç½‘ç»œåˆšåˆšæ–­å¼€æ—¶è¿˜èƒ½å‘é€è¿”å›ç›¸åº”çš„å­—èŠ‚æ•°ï¼ŒåŒæ—¶ä½¿ç”¨selectæ£€æµ‹ä¹Ÿæ˜¯å¯å†™çš„ï¼Œä½†æ˜¯è¿‡å‡ ç§’é’Ÿä¹‹åï¼Œå†sendå°±ä¼šå‡ºé”™äº†ï¼Œè¿”å›-1ã€‚selectä¹Ÿä¸èƒ½æ£€æµ‹å‡ºå¯å†™äº†ã€‚</p><h2 id="2-recvå‡½æ•°"><a href="#2-recvå‡½æ•°" class="headerlink" title="2. recvå‡½æ•°"></a><strong>2. recvå‡½æ•°</strong></h2><blockquote><p><strong>int recv( SOCKET s, char FAR *buf, int len, int flags);</strong></p></blockquote><p>ä¸è®ºæ˜¯å®¢æˆ·è¿˜æ˜¯æœåŠ¡å™¨åº”ç”¨ç¨‹åºéƒ½ç”¨recvå‡½æ•°ä»TCPè¿æ¥çš„å¦ä¸€ç«¯æ¥æ”¶æ•°æ®ã€‚è¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šæ¥æ”¶ç«¯å¥—æ¥å­—æè¿°ç¬¦ï¼›</p><p>â€‹    ç¬¬äºŒä¸ªå‚æ•°æŒ‡æ˜ä¸€ä¸ªç¼“å†²åŒºï¼Œè¯¥ç¼“å†²åŒºç”¨æ¥å­˜æ”¾recvå‡½æ•°æ¥æ”¶åˆ°çš„æ•°æ®ï¼›</p><p>â€‹    ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡æ˜bufçš„é•¿åº¦ï¼›</p><p>â€‹    ç¬¬å››ä¸ªå‚æ•°ä¸€èˆ¬ç½®0ã€‚</p><p>â€‹    è¿™é‡Œåªæè¿°<strong>åŒæ­¥Socketçš„recvå‡½æ•°çš„æ‰§è¡Œæµç¨‹</strong>ã€‚å½“åº”ç”¨ç¨‹åºè°ƒç”¨recvå‡½æ•°æ—¶ï¼Œ</p><p>â€‹    ï¼ˆ1ï¼‰recvå…ˆç­‰å¾…sçš„å‘é€ç¼“å†²ä¸­çš„æ•°æ®è¢«åè®®ä¼ é€å®Œæ¯•ï¼Œå¦‚æœåè®®åœ¨ä¼ é€sçš„å‘é€ç¼“å†²ä¸­çš„æ•°æ®æ—¶å‡ºç°ç½‘ç»œé”™è¯¯ï¼Œé‚£ä¹ˆrecvå‡½æ•°è¿”å›<code>SOCKET_ERROR</code> ï¼›</p><p>â€‹    ï¼ˆ2ï¼‰å¦‚æœsçš„å‘é€ç¼“å†²ä¸­æ²¡æœ‰æ•°æ®æˆ–è€…æ•°æ®è¢«åè®®æˆåŠŸå‘é€å®Œæ¯•åï¼Œrecvå…ˆæ£€æŸ¥å¥—æ¥å­—sçš„æ¥æ”¶ç¼“å†²åŒºï¼Œå¦‚æœsæ¥æ”¶ç¼“å†²åŒºä¸­æ²¡æœ‰æ•°æ®æˆ–è€…åè®®æ­£åœ¨æ¥æ”¶æ•°æ®ï¼Œé‚£ä¹ˆrecvå°±ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°åè®®æŠŠæ•°æ®æ¥æ”¶å®Œæ¯•ã€‚å½“åè®®æŠŠæ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œrecvå‡½æ•°å°±æŠŠsçš„æ¥æ”¶ç¼“å†²ä¸­çš„æ•°æ®copyåˆ°bufä¸­ï¼ˆ<strong>æ³¨æ„åè®®æ¥æ”¶åˆ°çš„æ•°æ®å¯èƒ½å¤§äºbufçš„é•¿åº¦ï¼Œæ‰€ä»¥ åœ¨è¿™ç§æƒ…å†µä¸‹è¦è°ƒç”¨å‡ æ¬¡recvå‡½æ•°æ‰èƒ½æŠŠsçš„æ¥æ”¶ç¼“å†²ä¸­çš„æ•°æ®copyå®Œã€‚recvå‡½æ•°ä»…ä»…æ˜¯copyæ•°æ®ï¼ŒçœŸæ­£çš„æ¥æ”¶æ•°æ®æ˜¯åè®®æ¥å®Œæˆçš„</strong>ï¼‰ï¼›</p><p>â€‹    recvå‡½æ•°è¿”å›å…¶å®é™…copyçš„å­—èŠ‚æ•°ã€‚å¦‚æœrecvåœ¨copyæ—¶å‡ºé”™ï¼Œé‚£ä¹ˆå®ƒè¿”å›<code>SOCKET_ERROR</code>ï¼›å¦‚æœrecvå‡½æ•°åœ¨ç­‰å¾…åè®®æ¥æ”¶æ•°æ®æ—¶ç½‘ç»œä¸­æ–­äº†ï¼Œé‚£ä¹ˆå®ƒè¿”å›0ã€‚</p><blockquote><p><strong>æ³¨æ„ï¼šåœ¨Unixç³»ç»Ÿä¸‹ï¼Œå¦‚æœrecvå‡½æ•°åœ¨ç­‰å¾…åè®®æ¥æ”¶æ•°æ®æ—¶ç½‘ç»œæ–­å¼€äº†ï¼Œé‚£ä¹ˆè°ƒç”¨recvçš„è¿›ç¨‹ä¼šæ¥æ”¶åˆ°ä¸€ä¸ªSIGPIPEä¿¡å·ï¼Œè¿›ç¨‹å¯¹è¯¥ä¿¡å·çš„é»˜è®¤å¤„ç†æ˜¯è¿›ç¨‹ç»ˆæ­¢ã€‚</strong></p></blockquote>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/C/">C++</category>
      
      <category domain="https://wonderomg.github.io/categories/C/Socket/">Socket</category>
      
      
      <category domain="https://wonderomg.github.io/tags/socket/">socket</category>
      
      <category domain="https://wonderomg.github.io/tags/C/">C++</category>
      
      
      <comments>https://wonderomg.github.io/2017/01/10/Socket_send%E5%87%BD%E6%95%B0%E5%92%8Crecv%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mongodbå­¦ä¹ ç¬”è®°--C++æ“ä½œmongodb</title>
      <link>https://wonderomg.github.io/2016/11/10/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--C++%E6%93%8D%E4%BD%9Cmongodb/</link>
      <guid>https://wonderomg.github.io/2016/11/10/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--C++%E6%93%8D%E4%BD%9Cmongodb/</guid>
      <pubDate>Wed, 09 Nov 2016 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ã€€ã€€åœ¨å­¦ä¹ mongodbè¿‡ç¨‹å½“ä¸­ï¼Œå¿…é¡»å­¦ä¹ çš„å°±æ˜¯ç”¨C++ï¼ˆJavaã€PHPã€C#ç­‰ï¼‰æ“ä½œmongodbï¼Œè¿™é‡Œè®²è¿°C++æ“ä½œmongodbï¼Œåœ¨å®˜æ–¹æä¾›çš„mongo-cxx-driveré©±åŠ¨ä¸­æœ‰ç›¸å…³çš„æ“ä½œä¾‹å­ï¼Œå¯ä»¥ç»“åˆä¾‹å­å­¦ä¹ ï¼Œç›®å½•æ˜¯&lt;code&gt;mongo-cxx-driver-legacy-1.0.0-rc0\src\mongo\client\examples&lt;/code&gt;ï¼Œè¿™é‡Œé’ˆå¯¹å‡ ä¸ªé‡è¦çš„ç‚¹è®²è¿°ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ã€€ã€€åœ¨å­¦ä¹ mongodbè¿‡ç¨‹å½“ä¸­ï¼Œå¿…é¡»å­¦ä¹ çš„å°±æ˜¯ç”¨C++ï¼ˆJavaã€PHPã€C#ç­‰ï¼‰æ“ä½œmongodbï¼Œè¿™é‡Œè®²è¿°C++æ“ä½œmongodbï¼Œåœ¨å®˜æ–¹æä¾›çš„mongo-cxx-driveré©±åŠ¨ä¸­æœ‰ç›¸å…³çš„æ“ä½œä¾‹å­ï¼Œå¯ä»¥ç»“åˆä¾‹å­å­¦ä¹ ï¼Œç›®å½•æ˜¯<code>mongo-cxx-driver-legacy-1.0.0-rc0\src\mongo\client\examples</code>ï¼Œè¿™é‡Œé’ˆå¯¹å‡ ä¸ªé‡è¦çš„ç‚¹è®²è¿°ã€‚</p><span id="more"></span><p>##<strong>1. C++è¿æ¥mongodb</strong></p><p><strong>ï¼ˆ1ï¼‰<font color=#0000FF>æœ‰æ— å¯†ç éƒ½é€‚ç”¨</font></strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mongo::client::GlobalInstance instance;</span><br><span class="line"><span class="keyword">if</span> (!instance.<span class="built_in">initialized</span>()) &#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;failed to initialize the client driver: &quot;</span> &lt;&lt; instance.<span class="built_in">status</span>() &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::string uri = <span class="string">&quot;mongodb://username:password@127.0.0.1:27017&quot;</span>;</span><br><span class="line">std::string errmsg;</span><br><span class="line"></span><br><span class="line">ConnectionString cs = ConnectionString::<span class="built_in">parse</span>(uri, errmsg);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!cs.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Error parsing connection string &quot;</span> &lt;&lt; uri &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; errmsg &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">boost::scoped_ptr&lt;DBClientBase&gt; <span class="title">conn</span><span class="params">(cs.connect(errmsg))</span></span>;</span><br><span class="line"><span class="keyword">if</span> (!conn) &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;couldn&#x27;t connect : &quot;</span> &lt;&lt; errmsg &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€<font color=#0000FF>è¿™ç§æ–¹å¼æœ‰å¯†ç å’Œæ— å¯†ç çš„æƒ…å†µéƒ½é€‚ç”¨ï¼Œ<code>&quot;username&quot;</code>ä¸ºç™»å½•åï¼Œ<code>&quot;password&quot;</code>ä¸ºç™»å½•å¯†ç ï¼›æ— å¯†ç æ—¶å»æ‰<code>&quot;username:password@&quot;</code>å³å¯è¿æ¥ï¼Œè¿™æ ·è¿æ¥æ–¹å¼æ¯”è¾ƒå¸¸ç”¨ã€‚</font></p><p><strong>ï¼ˆ2ï¼‰å¸¸è§„è¿æ¥æ“ä½œï¼ˆä¸å¸¦å¯†ç è¿æ¥ï¼‰</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mongo::DBClientConnection conn; </span><br><span class="line">mongo::Status status = mongo::client::<span class="built_in">initialize</span>();</span><br><span class="line"><span class="keyword">if</span> (!status.<span class="built_in">isOK</span>()) &#123;</span><br><span class="line"><span class="function">MongoException <span class="title">m</span><span class="params">(<span class="number">-1</span>, <span class="string">&quot;failed to initialize the client driver: &quot;</span> + status.toString())</span></span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">string url = <span class="string">&quot;localhost:27017&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!conn.<span class="built_in">connect</span>(url, errmsg)) &#123;</span><br><span class="line"><span class="function">MongoException <span class="title">m</span><span class="params">(<span class="number">0</span>, <span class="string">&quot;couldnâ€™t connect : &quot;</span> + errmsg)</span></span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼å¯å»ºç«‹ä¸mongodbçš„è¿æ¥ï¼Œä½†æ˜¯æ˜¯æœªå¸¦æƒé™çš„è¿æ¥ã€‚</p><p><strong>ï¼ˆ3ï¼‰å¸¦å¯†ç è¿æ¥</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.<span class="built_in">auth</span>( <span class="string">&quot;admin&quot;</span> , <span class="string">&quot;username&quot;</span> , <span class="string">&quot;password&quot;</span> , errmsg );</span><br></pre></td></tr></table></figure><p>ã€€ã€€å…¶ä¸­<code>&quot;admin&quot;</code>ä¸ºéªŒè¯ç”¨æˆ·çš„æ‰€åœ¨æ•°æ®åº“ï¼Œä¸€èˆ¬åœ¨<code>&quot;test.system.users&quot;</code>æˆ–<code>&quot;admin.system.users&quot;</code>è¡¨ä¸­ï¼Œæ‰€ä»¥å¡«åº“å<code>&quot;test&quot;</code>æˆ–<code>&quot;admin&quot;</code>ï¼Œ<code>&quot;username&quot;</code>ä¸ºç™»å½•åï¼Œ<code>&quot;password&quot;</code>ä¸ºç™»å½•å¯†ç ã€‚<br>æˆ–è€…ä¸‹é¢çš„authæ–¹å¼ä¹Ÿå¯ä»¥ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conn.<span class="built_in">auth</span>(<span class="built_in">BSON</span>(</span><br><span class="line"><span class="string">&quot;user&quot;</span> &lt;&lt; <span class="string">&quot;root&quot;</span> &lt;&lt; <span class="string">&quot;db&quot;</span> &lt;&lt; <span class="string">&quot;admin&quot;</span> &lt;&lt;</span><br><span class="line"><span class="string">&quot;pwd&quot;</span> &lt;&lt; <span class="string">&quot;password&quot;</span> &lt;&lt; <span class="string">&quot;mechanism&quot;</span> &lt;&lt; <span class="string">&quot;DEFAULT&quot;</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure><p>æ ¹æ®mongodbçš„è®¾ç½®æ›´æ”¹ä¼ é€’ç»™å‡½æ•°<code>conn.auth</code>çš„å‚æ•°å€¼ã€‚</p><p>##<strong>2. C++æŸ¥è¯¢æ•°æ®</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()); <span class="comment">//æŸ¥è¯¢ä¸€æ¡æ•°æ®</span></span><br><span class="line">conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>()); <span class="comment">//æ¡ä»¶æŸ¥è¯¢</span></span><br></pre></td></tr></table></figure><p>##<strong>3. C++æ’å…¥æ•°æ®</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">conn-&gt;<span class="built_in">insert</span>(ns, <span class="built_in">BSON</span>(<span class="string">&quot;name&quot;</span> &lt;&lt; <span class="string">&quot;joe&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;pwd&quot;</span> &lt;&lt; <span class="string">&quot;123456&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">20</span>));</span><br></pre></td></tr></table></figure><p>##<strong>4. C++åˆ é™¤æ•°æ®</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">conn-&gt;<span class="built_in">remove</span>(ns, <span class="built_in">BSONObj</span>()); <span class="comment">//åˆ é™¤æ‰€æœ‰</span></span><br><span class="line">conn-&gt;<span class="built_in">remove</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>()); <span class="comment">//åˆ é™¤æŒ‡å®šæ–‡æ¡£</span></span><br></pre></td></tr></table></figure><p>##<strong>5. C++æ›´æ–°æ•°æ®</strong></p><p><strong>(1) åœ¨åŸæ•°æ®åŸºç¡€ä¸Šå¢åŠ å±æ€§</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">BSONObj res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>());</span><br><span class="line">BSONObj after = <span class="built_in">BSONObjBuilder</span>().<span class="built_in">appendElements</span>(res).<span class="built_in">append</span>(<span class="string">&quot;name2&quot;</span>, <span class="string">&quot;h&quot;</span>).<span class="built_in">obj</span>();</span><br><span class="line">conn-&gt;<span class="built_in">update</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;jeo2&quot;</span>).<span class="built_in">obj</span>(), after);<span class="comment">//åœ¨åŸæ•°æ®ä¸Šå¢åŠ å±æ€§</span></span><br></pre></td></tr></table></figure><p>è¿™ç§updateæ–¹å¼åªæ˜¯åœ¨åŸæ•°æ®åŸºç¡€ä¸Šå¢åŠ å±æ€§ï¼Œå¹¶ä¸ä¼šæ”¹å˜æŒ‡å®šå±æ€§å€¼ã€‚<br><strong>(2) æ›´æ”¹æŒ‡å®šçš„æŸä¸ªå±æ€§å€¼</strong><br>**<font color=red>æƒ³è¦updateæŒ‡å®šå±æ€§çš„å€¼ï¼Œéœ€è¦ç”¨åˆ°â€$setâ€æŒ‡ä»¤</font>**ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BSONObj res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>());</span><br><span class="line"><span class="comment">//æ›´æ”¹æŒ‡å®šçš„æŸä¸ªå±æ€§å€¼</span></span><br><span class="line">conn-&gt;<span class="built_in">update</span>(<span class="string">&quot;test.first&quot;</span>, res, <span class="built_in">BSON</span>(<span class="string">&quot;$set&quot;</span> &lt;&lt; <span class="built_in">BSON</span>(<span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">11</span>)));</span><br></pre></td></tr></table></figure><p><font color=#0000FF>ä¸»è¦æƒ³å¼ºè°ƒä¸‹updateæ›´æ”¹æŒ‡å®šçš„æŸä¸ªå±æ€§å€¼çš„æ–¹å¼ï¼Œæ¯”è¾ƒå¸¸ç”¨ã€‚</font></p><p>##<strong>6. C++æ“ä½œä¾‹å­</strong><br>(1) simple_client_test.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#if defined(_WIN32)</span></span><br><span class="line"><span class="comment">#include &lt;winsock2.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;windows.h&gt;</span></span><br><span class="line"><span class="comment">#endif*/</span></span><br><span class="line"><span class="comment">//g++ simple_client_test.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o simple_client_test</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;mongo/client/dbclient.h&quot;</span>  <span class="comment">// the mongo c++ driver</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> verify</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> verify(x) MONGO_verify(x)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> mongo;</span><br><span class="line"><span class="comment">//using mongo::BSONObj;</span></span><br><span class="line"><span class="comment">//using mongo::BSONObjBuilder;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; [MONGODB_URI]&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mongo::client::GlobalInstance instance;</span><br><span class="line">    <span class="keyword">if</span> (!instance.<span class="built_in">initialized</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;failed to initialize the client driver: &quot;</span> &lt;&lt; instance.<span class="built_in">status</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::string uri = argc == <span class="number">2</span> ? argv[<span class="number">1</span>] : <span class="string">&quot;mongodb://127.0.0.1:27017&quot;</span>;</span><br><span class="line">    std::string errmsg;</span><br><span class="line"></span><br><span class="line">    ConnectionString cs = ConnectionString::<span class="built_in">parse</span>(uri, errmsg);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!cs.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Error parsing connection string &quot;</span> &lt;&lt; uri &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; errmsg &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">boost::scoped_ptr&lt;DBClientBase&gt; <span class="title">conn</span><span class="params">(cs.connect(errmsg))</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!conn) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;couldn&#x27;t connect : &quot;</span> &lt;&lt; errmsg &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line"></span><br><span class="line">    conn-&gt;<span class="built_in">dropCollection</span>(ns);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//clean up old data from any previous tesets</span></span><br><span class="line">    conn-&gt;<span class="built_in">remove</span>(ns, <span class="built_in">BSONObj</span>());</span><br><span class="line">    <span class="built_in">verify</span>(conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()).<span class="built_in">isEmpty</span>()); <span class="comment">//verifyé€»è¾‘è¡¨è¾¾å¼ï¼Œåˆ¤æ–­æ˜¯å¦è¿˜å­˜åœ¨test.firstï¼Œæ˜¯å¦clenn upæˆåŠŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//test insert</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(1) test insert----&quot;</span> &lt;&lt; endl;</span><br><span class="line">    conn-&gt;<span class="built_in">insert</span>(ns, </span><br><span class="line">                 <span class="built_in">BSON</span>(<span class="string">&quot;name&quot;</span> &lt;&lt; <span class="string">&quot;joe&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;pwd&quot;</span> &lt;&lt; <span class="string">&quot;123456&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">20</span>));</span><br><span class="line">    <span class="built_in">verify</span>(!conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()).<span class="built_in">isEmpty</span>());     <span class="comment">//åˆ¤æ–­æ˜¯å¦æ·»åŠ æˆåŠŸ</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;insert data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;insert success!&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// test remove</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(2) test remove----&quot;</span> &lt;&lt; endl;</span><br><span class="line">    conn-&gt;<span class="built_in">remove</span>(ns, <span class="built_in">BSONObj</span>());</span><br><span class="line">    <span class="built_in">verify</span>(conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()).<span class="built_in">isEmpty</span>());</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;remove success!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// insert, findOne testing</span></span><br><span class="line">    conn-&gt;<span class="built_in">insert</span>(ns, </span><br><span class="line">                 <span class="built_in">BSON</span>(<span class="string">&quot;name&quot;</span> &lt;&lt; <span class="string">&quot;joe&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;pwd&quot;</span> &lt;&lt; <span class="string">&quot;234567&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">21</span>));</span><br><span class="line">    &#123;</span><br><span class="line">        BSONObj res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>());</span><br><span class="line">        <span class="built_in">verify</span>(<span class="built_in">strstr</span>(res.<span class="built_in">getStringField</span>(<span class="string">&quot;name&quot;</span>), <span class="string">&quot;joe&quot;</span>));</span><br><span class="line">        <span class="built_in">verify</span>(!<span class="built_in">strstr</span>(res.<span class="built_in">getStringField</span>(<span class="string">&quot;name2&quot;</span>), <span class="string">&quot;joe&quot;</span>));</span><br><span class="line">        <span class="built_in">verify</span>(<span class="number">21</span> == res.<span class="built_in">getIntField</span>(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;insert data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()) &lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// test update</span></span><br><span class="line">    &#123;</span><br><span class="line">        BSONObj res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>());</span><br><span class="line">        <span class="built_in">verify</span>(!<span class="built_in">strstr</span>(res.<span class="built_in">getStringField</span>(<span class="string">&quot;name2&quot;</span>), <span class="string">&quot;jeo&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        BSONObj after = <span class="built_in">BSONObjBuilder</span>().<span class="built_in">appendElements</span>(res).<span class="built_in">append</span>(<span class="string">&quot;name2&quot;</span>, <span class="string">&quot;w&quot;</span>).<span class="built_in">obj</span>();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;(3) test update name joe add name2 name3----&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="comment">//upsert type1 update method</span></span><br><span class="line">        conn-&gt;<span class="built_in">update</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>(), after);</span><br><span class="line">        <span class="comment">//res = conn-&gt;findOne(ns, BSONObjBuilder().append(&quot;name2&quot;, &quot;w&quot;).obj());</span></span><br><span class="line">        <span class="built_in">verify</span>(!<span class="built_in">strstr</span>(res.<span class="built_in">getStringField</span>(<span class="string">&quot;name2&quot;</span>), <span class="string">&quot;joe&quot;</span>));</span><br><span class="line">        <span class="built_in">verify</span>(conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe2&quot;</span>).<span class="built_in">obj</span>()).<span class="built_in">isEmpty</span>());</span><br><span class="line">        <span class="comment">//cout &lt;&lt; &quot; update1 data: &quot; &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; endl;</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; update1 data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">Query</span>(<span class="string">&quot;&#123;name2:&#x27;w&#x27;&#125;&quot;</span>)) &lt;&lt; endl;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//upsert type2 update method æ›´æ”¹æŒ‡å®šçš„æŸä¸ªå±æ€§å€¼ </span></span><br><span class="line">        <span class="keyword">const</span> string TEST_NS = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">        conn-&gt;<span class="built_in">update</span>(<span class="string">&quot;test.first&quot;</span>, res, <span class="built_in">BSON</span>(<span class="string">&quot;$set&quot;</span> &lt;&lt; <span class="built_in">BSON</span>(<span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">11</span>)));</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; update2 data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()) &lt;&lt; endl;</span><br><span class="line">        res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//upsert type3 update method</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            after = <span class="built_in">BSONObjBuilder</span>().<span class="built_in">appendElements</span>(res).<span class="built_in">append</span>(<span class="string">&quot;name3&quot;</span>, <span class="string">&quot;h&quot;</span>).<span class="built_in">obj</span>();</span><br><span class="line">            conn-&gt;<span class="built_in">update</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>(), after);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in"><span class="keyword">catch</span></span> (OperationException&amp;)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot; update error: &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">getLastErrorDetailed</span>().<span class="built_in">toString</span>() &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">verify</span>(!conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>()).<span class="built_in">isEmpty</span>());</span><br><span class="line">        <span class="comment">//cout &lt;&lt; &quot; update3 data: &quot; &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; endl;</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; update3 data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">Query</span>(<span class="string">&quot;&#123;name3:&#x27;h&#x27;&#125;&quot;</span>)) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;(4) test query-----&quot;</span> &lt;&lt; <span class="string">&quot;\n query data : &quot;</span> </span><br><span class="line">            &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>()) &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; Query data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">Query</span>(<span class="string">&quot;&#123;name:&#x27;joe&#x27;&#125;&quot;</span>)) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(2) makefileæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CC = g++</span><br><span class="line">TEST = simple_client_test</span><br><span class="line"></span><br><span class="line">$(TEST):</span><br><span class="line">$(CC) $@.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o $@</span><br><span class="line">./$(TEST)</span><br><span class="line">rm -f $(TEST)</span><br><span class="line">run:</span><br><span class="line">./$(TEST)</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">rm -f $(TEST)</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/C/">C++</category>
      
      <category domain="https://wonderomg.github.io/categories/C/MongoDB/">MongoDB</category>
      
      
      <category domain="https://wonderomg.github.io/tags/C/">C++</category>
      
      <category domain="https://wonderomg.github.io/tags/mongodb/">mongodb</category>
      
      
      <comments>https://wonderomg.github.io/2016/11/10/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0--C++%E6%93%8D%E4%BD%9Cmongodb/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>mongodbå­¦ä¹ ç¬”è®°--C++æ“ä½œmongodb</title>
      <link>https://wonderomg.github.io/2016/11/10/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0C++%E6%93%8D%E4%BD%9Cmongodb/</link>
      <guid>https://wonderomg.github.io/2016/11/10/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0C++%E6%93%8D%E4%BD%9Cmongodb/</guid>
      <pubDate>Wed, 09 Nov 2016 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ã€€ã€€åœ¨å­¦ä¹ mongodbè¿‡ç¨‹å½“ä¸­ï¼Œå¿…é¡»å­¦ä¹ çš„å°±æ˜¯ç”¨C++ï¼ˆJavaã€PHPã€C#ç­‰ï¼‰æ“ä½œmongodbï¼Œè¿™é‡Œè®²è¿°C++æ“ä½œmongodbï¼Œåœ¨å®˜æ–¹æä¾›çš„mongo-cxx-driveré©±åŠ¨ä¸­æœ‰ç›¸å…³çš„æ“ä½œä¾‹å­ï¼Œå¯ä»¥ç»“åˆä¾‹å­å­¦ä¹ ï¼Œç›®å½•æ˜¯&lt;code&gt;mongo-cxx-driver-legacy-1.0.0-rc0\src\mongo\client\examples&lt;/code&gt;ï¼Œè¿™é‡Œé’ˆå¯¹å‡ ä¸ªé‡è¦çš„ç‚¹è®²è¿°ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<p>ã€€ã€€åœ¨å­¦ä¹ mongodbè¿‡ç¨‹å½“ä¸­ï¼Œå¿…é¡»å­¦ä¹ çš„å°±æ˜¯ç”¨C++ï¼ˆJavaã€PHPã€C#ç­‰ï¼‰æ“ä½œmongodbï¼Œè¿™é‡Œè®²è¿°C++æ“ä½œmongodbï¼Œåœ¨å®˜æ–¹æä¾›çš„mongo-cxx-driveré©±åŠ¨ä¸­æœ‰ç›¸å…³çš„æ“ä½œä¾‹å­ï¼Œå¯ä»¥ç»“åˆä¾‹å­å­¦ä¹ ï¼Œç›®å½•æ˜¯<code>mongo-cxx-driver-legacy-1.0.0-rc0\src\mongo\client\examples</code>ï¼Œè¿™é‡Œé’ˆå¯¹å‡ ä¸ªé‡è¦çš„ç‚¹è®²è¿°ã€‚</p><span id="more"></span><h2 id="1-C-è¿æ¥mongodb"><a href="#1-C-è¿æ¥mongodb" class="headerlink" title="1. C++è¿æ¥mongodb"></a><strong>1. C++è¿æ¥mongodb</strong></h2><p><strong>ï¼ˆ1ï¼‰<font color=#0000FF>æœ‰æ— å¯†ç éƒ½é€‚ç”¨</font></strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mongo::client::GlobalInstance instance;</span><br><span class="line"><span class="keyword">if</span> (!instance.<span class="built_in">initialized</span>()) &#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;failed to initialize the client driver: &quot;</span> &lt;&lt; instance.<span class="built_in">status</span>() &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">std::string uri = <span class="string">&quot;mongodb://username:password@127.0.0.1:27017&quot;</span>;</span><br><span class="line">std::string errmsg;</span><br><span class="line"></span><br><span class="line">ConnectionString cs = ConnectionString::<span class="built_in">parse</span>(uri, errmsg);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!cs.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;Error parsing connection string &quot;</span> &lt;&lt; uri &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; errmsg &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">boost::scoped_ptr&lt;DBClientBase&gt; <span class="title">conn</span><span class="params">(cs.connect(errmsg))</span></span>;</span><br><span class="line"><span class="keyword">if</span> (!conn) &#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;couldn&#x27;t connect : &quot;</span> &lt;&lt; errmsg &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€<font color=#0000FF>è¿™ç§æ–¹å¼æœ‰å¯†ç å’Œæ— å¯†ç çš„æƒ…å†µéƒ½é€‚ç”¨ï¼Œ<code>&quot;username&quot;</code>ä¸ºç™»å½•åï¼Œ<code>&quot;password&quot;</code>ä¸ºç™»å½•å¯†ç ï¼›æ— å¯†ç æ—¶å»æ‰<code>&quot;username:password@&quot;</code>å³å¯è¿æ¥ï¼Œè¿™æ ·è¿æ¥æ–¹å¼æ¯”è¾ƒå¸¸ç”¨ã€‚</font></p><p><strong>ï¼ˆ2ï¼‰å¸¸è§„è¿æ¥æ“ä½œï¼ˆä¸å¸¦å¯†ç è¿æ¥ï¼‰</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mongo::DBClientConnection conn; </span><br><span class="line">mongo::Status status = mongo::client::<span class="built_in">initialize</span>();</span><br><span class="line"><span class="keyword">if</span> (!status.<span class="built_in">isOK</span>()) &#123;</span><br><span class="line"><span class="function">MongoException <span class="title">m</span><span class="params">(<span class="number">-1</span>, <span class="string">&quot;failed to initialize the client driver: &quot;</span> + status.toString())</span></span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">string url = <span class="string">&quot;localhost:27017&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!conn.<span class="built_in">connect</span>(url, errmsg)) &#123;</span><br><span class="line"><span class="function">MongoException <span class="title">m</span><span class="params">(<span class="number">0</span>, <span class="string">&quot;couldnâ€™t connect : &quot;</span> + errmsg)</span></span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™ç§æ–¹å¼å¯å»ºç«‹ä¸mongodbçš„è¿æ¥ï¼Œä½†æ˜¯æ˜¯æœªå¸¦æƒé™çš„è¿æ¥ã€‚</p><p><strong>ï¼ˆ3ï¼‰å¸¦å¯†ç è¿æ¥</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conn.<span class="built_in">auth</span>( <span class="string">&quot;admin&quot;</span> , <span class="string">&quot;username&quot;</span> , <span class="string">&quot;password&quot;</span> , errmsg );</span><br></pre></td></tr></table></figure><p>ã€€ã€€å…¶ä¸­<code>&quot;admin&quot;</code>ä¸ºéªŒè¯ç”¨æˆ·çš„æ‰€åœ¨æ•°æ®åº“ï¼Œä¸€èˆ¬åœ¨<code>&quot;test.system.users&quot;</code>æˆ–<code>&quot;admin.system.users&quot;</code>è¡¨ä¸­ï¼Œæ‰€ä»¥å¡«åº“å<code>&quot;test&quot;</code>æˆ–<code>&quot;admin&quot;</code>ï¼Œ<code>&quot;username&quot;</code>ä¸ºç™»å½•åï¼Œ<code>&quot;password&quot;</code>ä¸ºç™»å½•å¯†ç ã€‚<br>æˆ–è€…ä¸‹é¢çš„authæ–¹å¼ä¹Ÿå¯ä»¥ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conn.<span class="built_in">auth</span>(<span class="built_in">BSON</span>(</span><br><span class="line"><span class="string">&quot;user&quot;</span> &lt;&lt; <span class="string">&quot;root&quot;</span> &lt;&lt; <span class="string">&quot;db&quot;</span> &lt;&lt; <span class="string">&quot;admin&quot;</span> &lt;&lt;</span><br><span class="line"><span class="string">&quot;pwd&quot;</span> &lt;&lt; <span class="string">&quot;password&quot;</span> &lt;&lt; <span class="string">&quot;mechanism&quot;</span> &lt;&lt; <span class="string">&quot;DEFAULT&quot;</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure><p>æ ¹æ®mongodbçš„è®¾ç½®æ›´æ”¹ä¼ é€’ç»™å‡½æ•°<code>conn.auth</code>çš„å‚æ•°å€¼ã€‚</p><h2 id="2-C-æŸ¥è¯¢æ•°æ®"><a href="#2-C-æŸ¥è¯¢æ•°æ®" class="headerlink" title="2. C++æŸ¥è¯¢æ•°æ®"></a><strong>2. C++æŸ¥è¯¢æ•°æ®</strong></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()); <span class="comment">//æŸ¥è¯¢ä¸€æ¡æ•°æ®</span></span><br><span class="line">conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>()); <span class="comment">//æ¡ä»¶æŸ¥è¯¢</span></span><br></pre></td></tr></table></figure><h2 id="3-C-æ’å…¥æ•°æ®"><a href="#3-C-æ’å…¥æ•°æ®" class="headerlink" title="3. C++æ’å…¥æ•°æ®"></a><strong>3. C++æ’å…¥æ•°æ®</strong></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">conn-&gt;<span class="built_in">insert</span>(ns, <span class="built_in">BSON</span>(<span class="string">&quot;name&quot;</span> &lt;&lt; <span class="string">&quot;joe&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;pwd&quot;</span> &lt;&lt; <span class="string">&quot;123456&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">20</span>));</span><br></pre></td></tr></table></figure><h2 id="4-C-åˆ é™¤æ•°æ®"><a href="#4-C-åˆ é™¤æ•°æ®" class="headerlink" title="4. C++åˆ é™¤æ•°æ®"></a><strong>4. C++åˆ é™¤æ•°æ®</strong></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">conn-&gt;<span class="built_in">remove</span>(ns, <span class="built_in">BSONObj</span>()); <span class="comment">//åˆ é™¤æ‰€æœ‰</span></span><br><span class="line">conn-&gt;<span class="built_in">remove</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>()); <span class="comment">//åˆ é™¤æŒ‡å®šæ–‡æ¡£</span></span><br></pre></td></tr></table></figure><h2 id="5-C-æ›´æ–°æ•°æ®"><a href="#5-C-æ›´æ–°æ•°æ®" class="headerlink" title="5. C++æ›´æ–°æ•°æ®"></a><strong>5. C++æ›´æ–°æ•°æ®</strong></h2><p><strong>(1) åœ¨åŸæ•°æ®åŸºç¡€ä¸Šå¢åŠ å±æ€§</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">BSONObj res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>());</span><br><span class="line">BSONObj after = <span class="built_in">BSONObjBuilder</span>().<span class="built_in">appendElements</span>(res).<span class="built_in">append</span>(<span class="string">&quot;name2&quot;</span>, <span class="string">&quot;h&quot;</span>).<span class="built_in">obj</span>();</span><br><span class="line">conn-&gt;<span class="built_in">update</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;jeo2&quot;</span>).<span class="built_in">obj</span>(), after);<span class="comment">//åœ¨åŸæ•°æ®ä¸Šå¢åŠ å±æ€§</span></span><br></pre></td></tr></table></figure><p>è¿™ç§updateæ–¹å¼åªæ˜¯åœ¨åŸæ•°æ®åŸºç¡€ä¸Šå¢åŠ å±æ€§ï¼Œå¹¶ä¸ä¼šæ”¹å˜æŒ‡å®šå±æ€§å€¼ã€‚<br><strong>(2) æ›´æ”¹æŒ‡å®šçš„æŸä¸ªå±æ€§å€¼</strong><br>**<font color=red>æƒ³è¦updateæŒ‡å®šå±æ€§çš„å€¼ï¼Œéœ€è¦ç”¨åˆ°â€$setâ€æŒ‡ä»¤</font>**ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BSONObj res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>());</span><br><span class="line"><span class="comment">//æ›´æ”¹æŒ‡å®šçš„æŸä¸ªå±æ€§å€¼</span></span><br><span class="line">conn-&gt;<span class="built_in">update</span>(<span class="string">&quot;test.first&quot;</span>, res, <span class="built_in">BSON</span>(<span class="string">&quot;$set&quot;</span> &lt;&lt; <span class="built_in">BSON</span>(<span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">11</span>)));</span><br></pre></td></tr></table></figure><p><font color=#0000FF>ä¸»è¦æƒ³å¼ºè°ƒä¸‹updateæ›´æ”¹æŒ‡å®šçš„æŸä¸ªå±æ€§å€¼çš„æ–¹å¼ï¼Œæ¯”è¾ƒå¸¸ç”¨ã€‚</font></p><h2 id="6-C-æ“ä½œä¾‹å­"><a href="#6-C-æ“ä½œä¾‹å­" class="headerlink" title="6. C++æ“ä½œä¾‹å­"></a><strong>6. C++æ“ä½œä¾‹å­</strong></h2><p>(1) simple_client_test.cpp</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">#if defined(_WIN32)</span></span><br><span class="line"><span class="comment">#include &lt;winsock2.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;windows.h&gt;</span></span><br><span class="line"><span class="comment">#endif*/</span></span><br><span class="line"><span class="comment">//g++ simple_client_test.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o simple_client_test</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;mongo/client/dbclient.h&quot;</span>  <span class="comment">// the mongo c++ driver</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> verify</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> verify(x) MONGO_verify(x)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> mongo;</span><br><span class="line"><span class="comment">//using mongo::BSONObj;</span></span><br><span class="line"><span class="comment">//using mongo::BSONObjBuilder;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;usage: &quot;</span> &lt;&lt; argv[<span class="number">0</span>] &lt;&lt; <span class="string">&quot; [MONGODB_URI]&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    mongo::client::GlobalInstance instance;</span><br><span class="line">    <span class="keyword">if</span> (!instance.<span class="built_in">initialized</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;failed to initialize the client driver: &quot;</span> &lt;&lt; instance.<span class="built_in">status</span>() &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::string uri = argc == <span class="number">2</span> ? argv[<span class="number">1</span>] : <span class="string">&quot;mongodb://127.0.0.1:27017&quot;</span>;</span><br><span class="line">    std::string errmsg;</span><br><span class="line"></span><br><span class="line">    ConnectionString cs = ConnectionString::<span class="built_in">parse</span>(uri, errmsg);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!cs.<span class="built_in">isValid</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Error parsing connection string &quot;</span> &lt;&lt; uri &lt;&lt; <span class="string">&quot;: &quot;</span> &lt;&lt; errmsg &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">boost::scoped_ptr&lt;DBClientBase&gt; <span class="title">conn</span><span class="params">(cs.connect(errmsg))</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!conn) &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;couldn&#x27;t connect : &quot;</span> &lt;&lt; errmsg &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* ns = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line"></span><br><span class="line">    conn-&gt;<span class="built_in">dropCollection</span>(ns);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//clean up old data from any previous tesets</span></span><br><span class="line">    conn-&gt;<span class="built_in">remove</span>(ns, <span class="built_in">BSONObj</span>());</span><br><span class="line">    <span class="built_in">verify</span>(conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()).<span class="built_in">isEmpty</span>()); <span class="comment">//verifyé€»è¾‘è¡¨è¾¾å¼ï¼Œåˆ¤æ–­æ˜¯å¦è¿˜å­˜åœ¨test.firstï¼Œæ˜¯å¦clenn upæˆåŠŸ</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//test insert</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(1) test insert----&quot;</span> &lt;&lt; endl;</span><br><span class="line">    conn-&gt;<span class="built_in">insert</span>(ns, </span><br><span class="line">                 <span class="built_in">BSON</span>(<span class="string">&quot;name&quot;</span> &lt;&lt; <span class="string">&quot;joe&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;pwd&quot;</span> &lt;&lt; <span class="string">&quot;123456&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">20</span>));</span><br><span class="line">    <span class="built_in">verify</span>(!conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()).<span class="built_in">isEmpty</span>());     <span class="comment">//åˆ¤æ–­æ˜¯å¦æ·»åŠ æˆåŠŸ</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;insert data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()) &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;insert success!&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// test remove</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;(2) test remove----&quot;</span> &lt;&lt; endl;</span><br><span class="line">    conn-&gt;<span class="built_in">remove</span>(ns, <span class="built_in">BSONObj</span>());</span><br><span class="line">    <span class="built_in">verify</span>(conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()).<span class="built_in">isEmpty</span>());</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;remove success!&quot;</span> &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// insert, findOne testing</span></span><br><span class="line">    conn-&gt;<span class="built_in">insert</span>(ns, </span><br><span class="line">                 <span class="built_in">BSON</span>(<span class="string">&quot;name&quot;</span> &lt;&lt; <span class="string">&quot;joe&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;pwd&quot;</span> &lt;&lt; <span class="string">&quot;234567&quot;</span> </span><br><span class="line">                      &lt;&lt; <span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">21</span>));</span><br><span class="line">    &#123;</span><br><span class="line">        BSONObj res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>());</span><br><span class="line">        <span class="built_in">verify</span>(<span class="built_in">strstr</span>(res.<span class="built_in">getStringField</span>(<span class="string">&quot;name&quot;</span>), <span class="string">&quot;joe&quot;</span>));</span><br><span class="line">        <span class="built_in">verify</span>(!<span class="built_in">strstr</span>(res.<span class="built_in">getStringField</span>(<span class="string">&quot;name2&quot;</span>), <span class="string">&quot;joe&quot;</span>));</span><br><span class="line">        <span class="built_in">verify</span>(<span class="number">21</span> == res.<span class="built_in">getIntField</span>(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;insert data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()) &lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// test update</span></span><br><span class="line">    &#123;</span><br><span class="line">        BSONObj res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>());</span><br><span class="line">        <span class="built_in">verify</span>(!<span class="built_in">strstr</span>(res.<span class="built_in">getStringField</span>(<span class="string">&quot;name2&quot;</span>), <span class="string">&quot;jeo&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        BSONObj after = <span class="built_in">BSONObjBuilder</span>().<span class="built_in">appendElements</span>(res).<span class="built_in">append</span>(<span class="string">&quot;name2&quot;</span>, <span class="string">&quot;w&quot;</span>).<span class="built_in">obj</span>();</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;(3) test update name joe add name2 name3----&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="comment">//upsert type1 update method</span></span><br><span class="line">        conn-&gt;<span class="built_in">update</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>(), after);</span><br><span class="line">        <span class="comment">//res = conn-&gt;findOne(ns, BSONObjBuilder().append(&quot;name2&quot;, &quot;w&quot;).obj());</span></span><br><span class="line">        <span class="built_in">verify</span>(!<span class="built_in">strstr</span>(res.<span class="built_in">getStringField</span>(<span class="string">&quot;name2&quot;</span>), <span class="string">&quot;joe&quot;</span>));</span><br><span class="line">        <span class="built_in">verify</span>(conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe2&quot;</span>).<span class="built_in">obj</span>()).<span class="built_in">isEmpty</span>());</span><br><span class="line">        <span class="comment">//cout &lt;&lt; &quot; update1 data: &quot; &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; endl;</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; update1 data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">Query</span>(<span class="string">&quot;&#123;name2:&#x27;w&#x27;&#125;&quot;</span>)) &lt;&lt; endl;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//upsert type2 update method æ›´æ”¹æŒ‡å®šçš„æŸä¸ªå±æ€§å€¼ </span></span><br><span class="line">        <span class="keyword">const</span> string TEST_NS = <span class="string">&quot;test.first&quot;</span>;</span><br><span class="line">        conn-&gt;<span class="built_in">update</span>(<span class="string">&quot;test.first&quot;</span>, res, <span class="built_in">BSON</span>(<span class="string">&quot;$set&quot;</span> &lt;&lt; <span class="built_in">BSON</span>(<span class="string">&quot;age&quot;</span> &lt;&lt; <span class="number">11</span>)));</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; update2 data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObj</span>()) &lt;&lt; endl;</span><br><span class="line">        res = conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//upsert type3 update method</span></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            after = <span class="built_in">BSONObjBuilder</span>().<span class="built_in">appendElements</span>(res).<span class="built_in">append</span>(<span class="string">&quot;name3&quot;</span>, <span class="string">&quot;h&quot;</span>).<span class="built_in">obj</span>();</span><br><span class="line">            conn-&gt;<span class="built_in">update</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>(), after);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in"><span class="keyword">catch</span></span> (OperationException&amp;)</span><br><span class="line">        &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot; update error: &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">getLastErrorDetailed</span>().<span class="built_in">toString</span>() &lt;&lt; endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">verify</span>(!conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>()).<span class="built_in">isEmpty</span>());</span><br><span class="line">        <span class="comment">//cout &lt;&lt; &quot; update3 data: &quot; &lt;&lt; conn-&gt;findOne(ns, BSONObj()) &lt;&lt; endl;</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; update3 data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">Query</span>(<span class="string">&quot;&#123;name3:&#x27;h&#x27;&#125;&quot;</span>)) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;(4) test query-----&quot;</span> &lt;&lt; <span class="string">&quot;\n query data : &quot;</span> </span><br><span class="line">            &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">BSONObjBuilder</span>().<span class="built_in">append</span>(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;joe&quot;</span>).<span class="built_in">obj</span>()) &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot; Query data : &quot;</span> &lt;&lt; conn-&gt;<span class="built_in">findOne</span>(ns, <span class="built_in">Query</span>(<span class="string">&quot;&#123;name:&#x27;joe&#x27;&#125;&quot;</span>)) &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(2) makefileæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CC = g++</span><br><span class="line">TEST = simple_client_test</span><br><span class="line"></span><br><span class="line">$(TEST):</span><br><span class="line">$(CC) $@.cpp -pthread -lmongoclient -lboost_thread -lboost_system -lboost_regex -o $@</span><br><span class="line">./$(TEST)</span><br><span class="line">rm -f $(TEST)</span><br><span class="line">run:</span><br><span class="line">./$(TEST)</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">rm -f $(TEST)</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/C/">C++</category>
      
      <category domain="https://wonderomg.github.io/categories/C/MongoDB/">MongoDB</category>
      
      
      <category domain="https://wonderomg.github.io/tags/C/">C++</category>
      
      <category domain="https://wonderomg.github.io/tags/mongodb/">mongodb</category>
      
      
      <comments>https://wonderomg.github.io/2016/11/10/mongodb%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0C++%E6%93%8D%E4%BD%9Cmongodb/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>å…³äº=nullå’Œclear()é—®é¢˜ï¼ˆJavaæ€§èƒ½ä¼˜åŒ–ï¼‰</title>
      <link>https://wonderomg.github.io/2016/04/19/%E5%85%B3%E4%BA%8E=null%E5%92%8Cclear()%E9%97%AE%E9%A2%98(Java%E6%80%A7%E8%83%BD%E7%AF%87)/</link>
      <guid>https://wonderomg.github.io/2016/04/19/%E5%85%B3%E4%BA%8E=null%E5%92%8Cclear()%E9%97%AE%E9%A2%98(Java%E6%80%A7%E8%83%BD%E7%AF%87)/</guid>
      <pubDate>Mon, 18 Apr 2016 16:00:00 GMT</pubDate>
      
      <description>&lt;p&gt;ã€€ã€€ä»¥ArrayListä¸ºä¾‹ï¼Œæ ¹æ®æƒ…å†µæ¥çœ‹å§ï¼Œ&lt;strong&gt;ArrayListå†…éƒ¨ç»´æŠ¤çš„æ˜¯ä¸€ä¸ªæ•°ç»„&lt;/strong&gt;ã€‚</description>
      
      
      
      <content:encoded><![CDATA[<p>ã€€ã€€ä»¥ArrayListä¸ºä¾‹ï¼Œæ ¹æ®æƒ…å†µæ¥çœ‹å§ï¼Œ<strong>ArrayListå†…éƒ¨ç»´æŠ¤çš„æ˜¯ä¸€ä¸ªæ•°ç»„</strong>ã€‚<span id="more"></span></p><h2 id="1-list-null"><a href="#1-list-null" class="headerlink" title="1. list = null"></a><strong>1. list = null</strong></h2><blockquote><p>é‚£ä¹ˆä½ <strong>list = null; ** å°±æ˜¯</strong>é‡Šæ”¾è¿™ä¸ªæ•°ç»„å¯¹è±¡ï¼Œå½“ç„¶é‡Œé¢æ‰€å¼•ç”¨çš„å¯¹è±¡ä¹Ÿå°±é‡Šæ”¾äº†**ã€‚</p></blockquote><h2 id="2-list-clear"><a href="#2-list-clear" class="headerlink" title="2. list.clear()"></a><strong>2. list.clear()</strong></h2><blockquote><p>å¦‚æœ<strong>list.clear();</strong> çœ‹çœ‹æºä»£ç å°±çŸ¥é“äº†ï¼Œæ˜¯<strong>æŠŠlisté‡Œé¢å¯¹è±¡éå†èµ‹å€¼ä¸ºnull</strong>ï¼Œæ„æ€å°±æ˜¯<strong>é‡Šæ”¾listé‡Œé¢æ‰€æœ‰å¯¹è±¡</strong>ã€‚</p></blockquote><p>ã€€ã€€è¿™æ ·å°±å¾ˆæ¸…æ¥šäº†ï¼Œå¦‚æœä½ è¿™ä¸ªlistè¿˜éœ€è¦ä½¿ç”¨ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨clearå»é‡Šæ”¾æ‰listé‡Œé¢æ‰€æœ‰çš„æ•°æ®ï¼ŒGCåœ¨å›æ”¶çš„æ—¶å€™å°±æœ‰å¯èƒ½å›æ”¶æ‰åŸlisté‡Œé¢çš„è¿™äº›æ•°æ®äº†ã€‚å¦‚æœä½ éƒ½ä¸éœ€è¦äº†ï¼Œé‚£ä¹ˆä½ å°±ç”¨=nullè¿™æ ·GCå°±æœ‰å¯èƒ½æŠŠlistä»¥åŠé‡Œé¢å…³è”çš„ä¸€äº›æ•°æ®ä¹Ÿéƒ½å›æ”¶äº†ã€‚</p><h2 id="3-å’±ä»¬æ¥çœ‹ä¸‹clear-æºç "><a href="#3-å’±ä»¬æ¥çœ‹ä¸‹clear-æºç " class="headerlink" title="3. å’±ä»¬æ¥çœ‹ä¸‹clear()æºç "></a><strong>3. å’±ä»¬æ¥çœ‹ä¸‹clear()æºç </strong></h2><p><code>clear()</code>æºç è§£æï¼š<br>If we take an <code>ArrayList</code> as an example, the <code>clear()</code> method does this:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123; </span><br><span class="line">    modCount++;  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Let gc do its work </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)  </span><br><span class="line">        elementData[i] = <span class="keyword">null</span>;  </span><br><span class="line">        </span><br><span class="line">    size = <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ã€€ã€€Basically, if elements of a List are not referenced anywhere else in the code there is really no need (or at least you do not gain anything) to call <code>clear()</code>. You also do not need to assign <code>null</code> to the List because it will be garbage collected as soon as it falls out of scope.<br><strong>è¯‘æ–‡ï¼š</strong><br>ã€€ã€€åŸºæœ¬ä¸Šï¼Œå¦‚æœListä¸­çš„å…ƒç´ æ²¡æœ‰è¢«å¼•ç”¨åˆ°ä»£ç ä¸­çš„å…¶ä»–åœ°æ–¹ï¼Œé‚£ä¹ˆç¡®å®æ²¡æœ‰å¿…è¦ï¼ˆæˆ–è‡³å°‘ä½ æ²¡æœ‰è·å¾—ä»»ä½•ä¸œè¥¿ï¼‰æ¥è°ƒç”¨<code>clear()</code>ã€‚ æ‚¨ä¹Ÿä¸éœ€è¦ä¸ºListæŒ‡å®š<code>null</code>ï¼Œå› ä¸ºå®ƒä¼šåœ¨è¶…å‡ºèŒƒå›´çš„æƒ…å†µä¸‹è¢«åƒåœ¾å›æ”¶ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/Java/">Java</category>
      
      
      <category domain="https://wonderomg.github.io/tags/Java/">Java</category>
      
      <category domain="https://wonderomg.github.io/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">æ€§èƒ½ä¼˜åŒ–</category>
      
      
      <comments>https://wonderomg.github.io/2016/04/19/%E5%85%B3%E4%BA%8E=null%E5%92%8Cclear()%E9%97%AE%E9%A2%98(Java%E6%80%A7%E8%83%BD%E7%AF%87)/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>C++ä¸­sprintfå‡½æ•°çš„ç”¨æ³•</title>
      <link>https://wonderomg.github.io/2015/07/21/C++%E4%B8%ADsprintf%E5%87%BD%E6%95%B0%E7%9A%84%E7%94%A8%E6%B3%95/</link>
      <guid>https://wonderomg.github.io/2015/07/21/C++%E4%B8%ADsprintf%E5%87%BD%E6%95%B0%E7%9A%84%E7%94%A8%E6%B3%95/</guid>
      <pubDate>Mon, 20 Jul 2015 16:00:00 GMT</pubDate>
      
      <description>&lt;h2 id=&quot;1-å¸¸ç”¨æ–¹å¼&quot;&gt;&lt;a href=&quot;#1-å¸¸ç”¨æ–¹å¼&quot; class=&quot;headerlink&quot; title=&quot;1.å¸¸ç”¨æ–¹å¼&quot;&gt;&lt;/a&gt;&lt;strong&gt;1.å¸¸ç”¨æ–¹å¼&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;ã€€ã€€ &lt;code&gt;sprintf&lt;/code&gt;å‡½æ•°çš„åŠŸèƒ½ä¸&lt;code&gt;printf&lt;/code&gt;å‡½æ•°çš„åŠŸèƒ½åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯å®ƒæŠŠç»“æœè¾“å‡ºåˆ°æŒ‡å®šçš„å­—ç¬¦ä¸²ä¸­äº†ï¼Œçœ‹ä¸ªä¾‹å­å°±æ˜ç™½äº†ï¼š&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="1-å¸¸ç”¨æ–¹å¼"><a href="#1-å¸¸ç”¨æ–¹å¼" class="headerlink" title="1.å¸¸ç”¨æ–¹å¼"></a><strong>1.å¸¸ç”¨æ–¹å¼</strong></h2><p>ã€€ã€€ <code>sprintf</code>å‡½æ•°çš„åŠŸèƒ½ä¸<code>printf</code>å‡½æ•°çš„åŠŸèƒ½åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯å®ƒæŠŠç»“æœè¾“å‡ºåˆ°æŒ‡å®šçš„å­—ç¬¦ä¸²ä¸­äº†ï¼Œçœ‹ä¸ªä¾‹å­å°±æ˜ç™½äº†ï¼š</p><span id="more"></span><p>ä¾‹ï¼šå°†<code>&quot;test,1,2&quot;</code>å†™å…¥æ•°ç»„sä¸­</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *avgv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">40</span>];</span><br><span class="line">    <span class="built_in">sprintf</span>(s,<span class="string">&quot;%s%d%c&quot;</span>,<span class="string">&quot;test&quot;</span>,<span class="number">1</span>,<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    <span class="comment">/*ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æŒ‡å‘è¦å†™å…¥çš„é‚£ä¸ªå­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œå‰©ä¸‹çš„å°±å’Œprintf()ä¸€æ ·äº†</span></span><br><span class="line"><span class="comment">    ä½ å¯ä»¥æ¯”è¾ƒä¸€ä¸‹ï¼Œè¿™æ˜¯å‘å±å¹•è¾“å…¥*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s%d%c&quot;</span>,<span class="string">&quot;test&quot;</span>,<span class="number">1</span>,<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ï¼š</p><blockquote><p>g++ sprinftest.cpp -o sprinftest &amp;&amp; ./sprinftest</p></blockquote><p>è¾“å‡ºç»“æœï¼š</p><blockquote><p>sprintftest12<br>sprintftest12</p></blockquote><h2 id="2-è‹¥â€-sâ€ç­‰è¾“å‡ºç¬¦åœ¨å­—ç¬¦ä¸²ä¸­"><a href="#2-è‹¥â€-sâ€ç­‰è¾“å‡ºç¬¦åœ¨å­—ç¬¦ä¸²ä¸­" class="headerlink" title="2.è‹¥â€%sâ€ç­‰è¾“å‡ºç¬¦åœ¨å­—ç¬¦ä¸²ä¸­"></a><strong>2.è‹¥â€%sâ€ç­‰è¾“å‡ºç¬¦åœ¨å­—ç¬¦ä¸²ä¸­</strong></h2><p>ä¾‹ï¼šè¡¥å…¨å­—ç¬¦ä¸²strçš„ç¼ºçœå†…å®¹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *avgv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[] = <span class="string">&quot;hel%co wo%sd! sp%stf test%d&quot;</span>;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="built_in">strlen</span>(str)];</span><br><span class="line">    <span class="built_in">sprintf</span>(buf, str, <span class="string">&#x27;l&#x27;</span>, <span class="string">&quot;rl&quot;</span>, <span class="string">&quot;rin&quot;</span>, <span class="number">1</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;str = &quot;</span>&lt;&lt; buf &lt;&lt; <span class="string">&quot;\nlen = &quot;</span> &lt;&lt;  <span class="built_in">strlen</span>(buf) &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ï¼š</p><blockquote><p>g++ sprinftest.cpp -o sprinftest &amp;&amp; ./sprinftest</p></blockquote><p>è¾“å‡ºç»“æœï¼š</p><blockquote><p>str = hello world! sprintf test1<br>len = 27</p></blockquote><p>è¿™ç§å½¢å¼ä¹Ÿå¯ä»¥å°†å¤šä¸ªå­—ç¬¦å€¼æˆ–å­—ç¬¦ä¸²å€¼èµ‹å€¼åˆ°å­—ç¬¦ä¸²strä¸­ï¼Œæœ‰å¤šå°‘ä¸ªè¾“å‡ºç¬¦å°±åé¢å°±åŠ å¤šå°‘ä¸ªå‚æ•°ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/C/">C++</category>
      
      
      <category domain="https://wonderomg.github.io/tags/sprintf/">sprintf</category>
      
      
      <comments>https://wonderomg.github.io/2015/07/21/C++%E4%B8%ADsprintf%E5%87%BD%E6%95%B0%E7%9A%84%E7%94%A8%E6%B3%95/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>TCPé•¿è¿æ¥ä¸çŸ­è¿æ¥çš„åŒºåˆ«</title>
      <link>https://wonderomg.github.io/2015/02/20/TCP%E9%95%BF%E8%BF%9E%E6%8E%A5%E4%B8%8E%E7%9F%AD%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%8C%BA%E5%88%AB/</link>
      <guid>https://wonderomg.github.io/2015/02/20/TCP%E9%95%BF%E8%BF%9E%E6%8E%A5%E4%B8%8E%E7%9F%AD%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%8C%BA%E5%88%AB/</guid>
      <pubDate>Thu, 19 Feb 2015 16:00:00 GMT</pubDate>
      
      <description>&lt;h2 id=&quot;1-TCPè¿æ¥&quot;&gt;&lt;a href=&quot;#1-TCPè¿æ¥&quot; class=&quot;headerlink&quot; title=&quot;1. TCPè¿æ¥&quot;&gt;&lt;/a&gt;&lt;strong&gt;1. TCPè¿æ¥&lt;/strong&gt;&lt;/h2&gt;&lt;p&gt;â€‹        å½“ç½‘ç»œé€šä¿¡æ—¶é‡‡ç”¨TCPåè®®æ—¶ï¼Œåœ¨çœŸæ­£çš„è¯»å†™æ“ä½œä¹‹å‰ï¼Œ&lt;code&gt;server&lt;/code&gt;ä¸&lt;code&gt;client&lt;/code&gt;ä¹‹é—´å¿…é¡»å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œå½“è¯»å†™æ“ä½œå®Œæˆåï¼ŒåŒæ–¹ä¸å†éœ€è¦è¿™ä¸ªè¿æ¥æ—¶å®ƒä»¬å¯ä»¥é‡Šæ”¾è¿™ä¸ªè¿æ¥ï¼Œè¿æ¥çš„å»ºç«‹æ˜¯éœ€è¦ä¸‰æ¬¡æ¡æ‰‹çš„ï¼Œè€Œé‡Šæ”¾åˆ™éœ€è¦4æ¬¡æ¡æ‰‹ï¼Œæ‰€ä»¥è¯´æ¯ä¸ªè¿æ¥çš„å»ºç«‹éƒ½æ˜¯éœ€è¦èµ„æºæ¶ˆè€—å’Œæ—¶é—´æ¶ˆè€—çš„ã€‚&lt;/p&gt;</description>
      
      
      
      <content:encoded><![CDATA[<h2 id="1-TCPè¿æ¥"><a href="#1-TCPè¿æ¥" class="headerlink" title="1. TCPè¿æ¥"></a><strong>1. TCPè¿æ¥</strong></h2><p>â€‹        å½“ç½‘ç»œé€šä¿¡æ—¶é‡‡ç”¨TCPåè®®æ—¶ï¼Œåœ¨çœŸæ­£çš„è¯»å†™æ“ä½œä¹‹å‰ï¼Œ<code>server</code>ä¸<code>client</code>ä¹‹é—´å¿…é¡»å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œå½“è¯»å†™æ“ä½œå®Œæˆåï¼ŒåŒæ–¹ä¸å†éœ€è¦è¿™ä¸ªè¿æ¥æ—¶å®ƒä»¬å¯ä»¥é‡Šæ”¾è¿™ä¸ªè¿æ¥ï¼Œè¿æ¥çš„å»ºç«‹æ˜¯éœ€è¦ä¸‰æ¬¡æ¡æ‰‹çš„ï¼Œè€Œé‡Šæ”¾åˆ™éœ€è¦4æ¬¡æ¡æ‰‹ï¼Œæ‰€ä»¥è¯´æ¯ä¸ªè¿æ¥çš„å»ºç«‹éƒ½æ˜¯éœ€è¦èµ„æºæ¶ˆè€—å’Œæ—¶é—´æ¶ˆè€—çš„ã€‚</p><span id="more"></span><p>ç»å…¸çš„ä¸‰æ¬¡æ¡æ‰‹ç¤ºæ„å›¾ï¼š</p><p><img src="http://pic002.cnblogs.com/images/2011/305779/2011062613192683.jpg" alt="ä¸‰æ¬¡æ¡æ‰‹"></p><p>ç»å…¸çš„å››æ¬¡æ¡æ‰‹å…³é—­å›¾ï¼š</p><p><img src="http://pic002.cnblogs.com/images/2011/305779/2011062613210341.jpg" alt="å››æ¬¡æ¡æ‰‹"></p><h2 id="2-TCPçŸ­è¿æ¥"><a href="#2-TCPçŸ­è¿æ¥" class="headerlink" title="2. TCPçŸ­è¿æ¥"></a><strong>2. TCPçŸ­è¿æ¥</strong></h2><p>â€‹        æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸‹TCPçŸ­è¿æ¥çš„æƒ…å†µï¼Œ<strong>clientå‘serverå‘èµ·è¿æ¥è¯·æ±‚ï¼Œserveræ¥åˆ°è¯·æ±‚ï¼Œç„¶ååŒæ–¹å»ºç«‹è¿æ¥ã€‚clientå‘serverå‘é€æ¶ˆæ¯ï¼Œserverå›åº”clientï¼Œç„¶åä¸€æ¬¡è¯»å†™å°±å®Œæˆäº†ï¼Œè¿™æ—¶å€™åŒæ–¹ä»»ä½•ä¸€ä¸ªéƒ½å¯ä»¥å‘èµ·closeæ“ä½œï¼Œä¸è¿‡ä¸€èˆ¬éƒ½æ˜¯clientå…ˆå‘èµ·closeæ“ä½œã€‚</strong></p><p><strong>ä¸ºä»€ä¹ˆå‘¢ï¼Œä¸€èˆ¬çš„serverä¸ä¼šå›å¤å®Œclientåç«‹å³å…³é—­è¿æ¥çš„ï¼Œå½“ç„¶ä¸æ’é™¤æœ‰ç‰¹æ®Šçš„æƒ…å†µã€‚</strong></p><p>ä»ä¸Šé¢çš„æè¿°çœ‹ï¼ŒçŸ­è¿æ¥ä¸€èˆ¬åªä¼šåœ¨<code>client/server</code>é—´ä¼ é€’ä¸€æ¬¡è¯»å†™æ“ä½œã€‚</p><blockquote><p><strong>çŸ­è¿æ¥çš„ä¼˜ç‚¹æ˜¯ï¼šç®¡ç†èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå­˜åœ¨çš„è¿æ¥éƒ½æ˜¯æœ‰ç”¨çš„è¿æ¥ï¼Œä¸éœ€è¦é¢å¤–çš„æ§åˆ¶æ‰‹æ®µã€‚</strong></p></blockquote><h2 id="3-TCPé•¿è¿æ¥"><a href="#3-TCPé•¿è¿æ¥" class="headerlink" title="3. TCPé•¿è¿æ¥"></a><strong>3. TCPé•¿è¿æ¥</strong></h2><p>â€‹       æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¨¡æ‹Ÿä¸€ä¸‹é•¿è¿æ¥çš„æƒ…å†µï¼Œ<strong>clientå‘serverå‘èµ·è¿æ¥ï¼Œserveræ¥å—clientè¿æ¥ï¼ŒåŒæ–¹å»ºç«‹è¿æ¥ã€‚Clientä¸serverå®Œæˆä¸€æ¬¡è¯»å†™ä¹‹åï¼Œå®ƒä»¬ä¹‹é—´çš„è¿æ¥å¹¶ä¸ä¼šä¸»åŠ¨å…³é—­ï¼Œåç»­çš„è¯»å†™æ“ä½œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸ªè¿æ¥ã€‚</strong></p><p>â€‹       é¦–å…ˆè¯´ä¸€ä¸‹TCP/IPè¯¦è§£ä¸Šè®²åˆ°çš„TCPä¿æ´»åŠŸèƒ½ï¼Œä¿æ´»åŠŸèƒ½ä¸»è¦ä¸ºæœåŠ¡å™¨åº”ç”¨æä¾›ï¼ŒæœåŠ¡å™¨åº”ç”¨å¸Œæœ›çŸ¥é“å®¢æˆ·ä¸»æœºæ˜¯å¦å´©æºƒï¼Œä»è€Œå¯ä»¥ä»£è¡¨å®¢æˆ·ä½¿ç”¨èµ„æºã€‚å¦‚æœå®¢æˆ·å·²ç»æ¶ˆå¤±ï¼Œä½¿å¾—æœåŠ¡å™¨ä¸Šä¿ç•™ä¸€ä¸ªåŠå¼€æ”¾çš„è¿æ¥ï¼Œè€ŒæœåŠ¡å™¨åˆåœ¨ç­‰å¾…æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®ï¼Œåˆ™æœåŠ¡å™¨å°†åº”è¿œç­‰å¾…å®¢æˆ·ç«¯çš„æ•°æ®ï¼Œä¿æ´»åŠŸèƒ½å°±æ˜¯è¯•å›¾åœ¨æœåŠ¡å™¨ç«¯æ£€æµ‹åˆ°è¿™ç§åŠå¼€æ”¾çš„è¿æ¥ã€‚</p><blockquote><p>å¦‚æœä¸€ä¸ªç»™å®šçš„è¿æ¥åœ¨ä¸¤å°æ—¶å†…æ²¡æœ‰ä»»ä½•çš„åŠ¨ä½œï¼Œåˆ™æœåŠ¡å™¨å°±å‘å®¢æˆ·å‘ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œå®¢æˆ·ä¸»æœºå¿…é¡»å¤„äºä»¥ä¸‹4ä¸ªçŠ¶æ€ä¹‹ä¸€ï¼š</p><ol><li>å®¢æˆ·ä¸»æœºä¾ç„¶æ­£å¸¸è¿è¡Œï¼Œå¹¶ä»æœåŠ¡å™¨å¯è¾¾ã€‚å®¢æˆ·çš„TCPå“åº”æ­£å¸¸ï¼Œè€ŒæœåŠ¡å™¨ä¹ŸçŸ¥é“å¯¹æ–¹æ˜¯æ­£å¸¸çš„ï¼ŒæœåŠ¡å™¨åœ¨ä¸¤å°æ—¶åå°†ä¿æ´»å®šæ—¶å™¨å¤ä½ã€‚</li><li>å®¢æˆ·ä¸»æœºå·²ç»å´©æºƒï¼Œå¹¶ä¸”å…³é—­æˆ–è€…æ­£åœ¨é‡æ–°å¯åŠ¨ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·çš„TCPéƒ½æ²¡æœ‰å“åº”ã€‚æœåŠ¡ç«¯å°†ä¸èƒ½æ”¶åˆ°å¯¹æ¢æµ‹çš„å“åº”ï¼Œå¹¶åœ¨75ç§’åè¶…æ—¶ã€‚æœåŠ¡å™¨æ€»å…±å‘é€10ä¸ªè¿™æ ·çš„æ¢æµ‹ ï¼Œæ¯ä¸ªé—´éš”75ç§’ã€‚å¦‚æœæœåŠ¡å™¨æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå“åº”ï¼Œå®ƒå°±è®¤ä¸ºå®¢æˆ·ä¸»æœºå·²ç»å…³é—­å¹¶ç»ˆæ­¢è¿æ¥ã€‚</li><li>å®¢æˆ·ä¸»æœºå´©æºƒå¹¶å·²ç»é‡æ–°å¯åŠ¨ã€‚æœåŠ¡å™¨å°†æ”¶åˆ°ä¸€ä¸ªå¯¹å…¶ä¿æ´»æ¢æµ‹çš„å“åº”ï¼Œè¿™ä¸ªå“åº”æ˜¯ä¸€ä¸ªå¤ä½ï¼Œä½¿å¾—æœåŠ¡å™¨ç»ˆæ­¢è¿™ä¸ªè¿æ¥ã€‚</li><li>å®¢æˆ·æœºæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸å¯è¾¾ï¼Œè¿™ç§æƒ…å†µä¸2ç±»ä¼¼ï¼ŒTCPèƒ½å‘ç°çš„å°±æ˜¯æ²¡æœ‰æ”¶åˆ°æ¢æŸ¥çš„å“åº”ã€‚</li></ol></blockquote><p>â€‹        ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒTCPä¿æ´»åŠŸèƒ½ä¸»è¦ä¸ºæ¢æµ‹é•¿è¿æ¥çš„å­˜æ´»çŠ¶å†µï¼Œä¸è¿‡è¿™é‡Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå­˜æ´»åŠŸèƒ½çš„æ¢æµ‹å‘¨æœŸå¤ªé•¿ï¼Œè¿˜æœ‰å°±æ˜¯å®ƒåªæ˜¯æ¢æµ‹TCPè¿æ¥çš„å­˜æ´»ï¼Œå±äºæ¯”è¾ƒæ–¯æ–‡çš„åšæ³•ï¼Œé‡åˆ°æ¶æ„çš„è¿æ¥æ—¶ï¼Œä¿æ´»åŠŸèƒ½å°±ä¸å¤Ÿä½¿äº†ã€‚</p><blockquote><p><strong>åœ¨é•¿è¿æ¥çš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œclientç«¯ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å…³é—­å®ƒä»¬ä¹‹é—´çš„è¿æ¥ï¼Œclientä¸serverä¹‹é—´çš„è¿æ¥å¦‚æœä¸€ç›´ä¸å…³é—­çš„è¯ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œéšç€å®¢æˆ·ç«¯è¿æ¥è¶Šæ¥è¶Šå¤šï¼Œserveræ—©æ™šæœ‰æ‰›ä¸ä½çš„æ—¶å€™ï¼Œè¿™æ—¶å€™serverç«¯éœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥ï¼Œ</strong></p><ol><li>å¦‚å…³é—­ä¸€äº›é•¿æ—¶é—´æ²¡æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿçš„è¿æ¥ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›æ¶æ„è¿æ¥å¯¼è‡´serverç«¯æœåŠ¡å—æŸï¼›</li><li>å¦‚æœæ¡ä»¶å†å…è®¸å°±å¯ä»¥ä»¥å®¢æˆ·ç«¯æœºå™¨ä¸ºé¢—ç²’åº¦ï¼Œé™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯çš„æœ€å¤§é•¿è¿æ¥æ•°ï¼Œè¿™æ ·å¯ä»¥å®Œå…¨é¿å…æŸä¸ªè›‹ç–¼çš„å®¢æˆ·ç«¯è¿ç´¯åç«¯æœã€‚</li></ol></blockquote><blockquote><p>é•¿è¿æ¥å’ŒçŸ­è¿æ¥çš„äº§ç”Ÿåœ¨äºclientå’Œserveré‡‡å–çš„å…³é—­ç­–ç•¥ï¼Œå…·ä½“çš„åº”ç”¨åœºæ™¯é‡‡ç”¨å…·ä½“çš„ç­–ç•¥ï¼Œæ²¡æœ‰åå…¨åç¾çš„é€‰æ‹©ï¼Œåªæœ‰åˆé€‚çš„é€‰æ‹©ã€‚</p></blockquote>]]></content:encoded>
      
      
      <category domain="https://wonderomg.github.io/categories/tcp/">tcp</category>
      
      
      <category domain="https://wonderomg.github.io/tags/tcp/">tcp</category>
      
      
      <comments>https://wonderomg.github.io/2015/02/20/TCP%E9%95%BF%E8%BF%9E%E6%8E%A5%E4%B8%8E%E7%9F%AD%E8%BF%9E%E6%8E%A5%E7%9A%84%E5%8C%BA%E5%88%AB/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
